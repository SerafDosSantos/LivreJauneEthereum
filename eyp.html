<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-1">
<h2 id="_ethereum_a_secure_decentralised_generalised_transaction_ledger">ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER</h2>
<div class="sectionbody">
<div class="quoteblock data-line-3">
<blockquote>
<div class="paragraph data-line-4">
<p><strong>BERLIN VERSION 630ed56 – 2022-02-13</strong></p>
</div>
<div class="paragraph data-line-6">
<p>DR. GAVIN WOOD FOUNDER, ETHEREUM &amp; PARITY</p>
</div>
<div class="paragraph data-line-8">
<p><a href="mailto:GAVIN@PARITY.IO" data-href="mailto:GAVIN@PARITY.IO">GAVIN@PARITY.IO</a></p>
</div>
<div class="paragraph data-line-10">
<p>Abstract. The blockchain paradigm when coupled with cryptographically-secured transactions has demonstrated its utility through a number of projects, with Bitcoin being one of the most notable ones. Each such project can be seen as a simple application on a decentralised, but singleton, compute resource. We can call this paradigm a transactional singleton machine with shared-state.</p>
</div>
<div class="paragraph data-line-12">
<p>Ethereum implements this paradigm in a generalised manner. Furthermore it provides a plurality of such resources, each with a distinct state and operating code but able to interact through a message-passing framework with others. We discuss its design, implementation issues, the opportunities it provides and the future hurdles we envisage.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-16">
<ol class="arabic">
<li class="data-line-16">
<p>Introduction</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-18">
<blockquote>
<div class="paragraph data-line-19">
<p>With ubiquitous internet connections in most places of the world, global information transmission has become incredibly cheap. Technology-rooted movements like Bit- coin have demonstrated through the power of the default, consensus mechanisms, and voluntary respect of the social contract, that it is possible to use the internet to make a decentralised value-transfer system that can be shared across the world and virtually free to use. This system can be said to be a very specialised version of a cryptographi- cally secure, transaction-based state machine. Follow-up systems such as Namecoin adapted this original “currency application” of the technology into other applications albeit rather simplistic ones.</p>
</div>
<div class="paragraph data-line-21">
<p>Ethereum is a project which attempts to build the gen- eralised technology; technology on which all transaction- based state machine concepts may be built. Moreover it aims to provide to the end-developer a tightly integrated end-to-end system for building software on a hitherto un- explored compute paradigm in the mainstream: a trustful object messaging compute framework.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-25">
<ol class="arabic">
<li class="data-line-25">
<p><strong>Driving Factors.</strong> There are many goals of this project; one key goal is to facilitate transactions between consenting individuals who would otherwise have no means to trust one another. This may be due to geographical separation, interfacing difficulty, or perhaps the incompati- bility, incompetence, unwillingness, expense, uncertainty, inconvenience, or corruption of existing legal systems. By specifying a state-change system through a rich and unam- biguous language, and furthermore architecting a system such that we can reasonably expect that an agreement will be thus enforced autonomously, we can provide a means to this end.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-27">
<blockquote>
<div class="paragraph data-line-28">
<p>Dealings in this proposed system would have several attributes not often found in the real world. The incorrupt- ibility of judgement, often difficult to find, comes naturally from a disinterested algorithmic interpreter. Transparency, or being able to see exactly how a state or judgement came about through the transaction log and rules or instructional codes, never happens perfectly in human-based systems since natural language is necessarily vague, information</p>
</div>
<div class="paragraph data-line-30">
<p>is often lacking, and plain old prejudices are difficult to shake.</p>
</div>
<div class="paragraph data-line-32">
<p>Overall, we wish to provide a system such that users can be guaranteed that no matter with which other indi- viduals, systems or organisations they interact, they can do so with absolute confidence in the possible outcomes and how those outcomes might come about.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-36">
<ol class="arabic" start="2">
<li class="data-line-36">
<p><strong>Previous Work.</strong> <a href="#_bookmark73" data-href="#_bookmark73">Buterin [2013a</a>] first proposed the kernel of this work in late November, 2013. Though now evolved in many ways, the key functionality of a block- chain with a Turing-complete language and an effectively unlimited inter-transaction storage capability remains un- changed.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-38">
<blockquote>
<div class="paragraph data-line-39">
<p><a href="#<em>bookmark91" data-href="#<em>bookmark91">Dwork and Naor [1992</a>] provided the first work into the usage of a cryptographic proof of computational expendi- ture (“proof-of-work”) as a means of transmitting a value signal over the Internet. The value-signal was utilised here as a spam deterrence mechanism rather than any kind of currency, but critically demonstrated the potential for a basic data channel to carry a _strong economic signal</em>, allowing a receiver to make a physical assertion without having to rely upon <em>trust</em>. <a href="#_bookmark69" data-href="#_bookmark69">Back</a> <a href="#_bookmark69" data-href="#_bookmark69">[2002</a>] later produced a system in a similar vein.</p>
</div>
<div class="paragraph data-line-41">
<p>The first example of utilising the proof-of-work as a strong economic signal to secure a currency was by <a href="#_bookmark107" data-href="#_bookmark107">Vish-</a> <a href="#_bookmark107" data-href="#_bookmark107">numurthy et al.</a> <a href="#_bookmark107" data-href="#_bookmark107">[2003</a>.] In this instance, the token was used to keep peer-to-peer file trading in check, providing “consumers” with the ability to make micro-payments to “suppliers” for their services. The security model afforded by the proof-of-work was augmented with digital signatures and a ledger in order to ensure that the historical record couldn’t be corrupted and that malicious actors could not spoof payment or unjustly complain about service deliv- ery. Five years later, <a href="#_bookmark87" data-href="#_bookmark87">Nakamoto [2008</a>] introduced another such proof-of-work-secured value token, somewhat wider in scope. The fruits of this project, Bitcoin, became the first widely adopted global decentralised transaction ledger.</p>
</div>
<div class="paragraph data-line-43">
<p>Other projects built on Bitcoin’s success; the alt-coins introduced numerous other currencies through alteration to the protocol. Some of the best known are Litecoin and Primecoin, discussed by <a href="#_bookmark101" data-href="#_bookmark101">Sprankel [2013</a>.] Other projects sought to take the core value content mechanism of the pro- tocol and repurpose it; <a href="#_bookmark70" data-href="#_bookmark70">Aron [2012</a>] discusses, for example,</p>
</div>
<div class="paragraph data-line-45">
<p>1</p>
</div>
<div class="paragraph data-line-47">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 2</p>
</div>
<div class="paragraph data-line-49">
<p>the Namecoin project which aims to provide a decentralised name-resolution system.</p>
</div>
<div class="paragraph data-line-51">
<p>Other projects still aim to build upon the Bitcoin net- work itself, leveraging the large amount of value placed in the system and the vast amount of computation that goes into the consensus mechanism. The Mastercoin project, first proposed by <a href="#_bookmark109" data-href="#_bookmark109">Willett</a> <a href="#_bookmark109" data-href="#_bookmark109">[2013</a>,] aims to build a richer protocol involving many additional high-level features on top of the Bitcoin protocol through utilisation of a number of auxiliary parts to the core protocol. The Coloured Coins</p>
</div>
<div class="paragraph data-line-53">
<p>itself—that would be far too big). They also punctuate the transaction series with incentives for nodes to <em>mine</em>. This incentivisation takes place as a state-transition function, adding value to a nominated account.</p>
</div>
<div class="paragraph data-line-55">
<p>Mining is the process of dedicating effort (working) to bolster one series of transactions (a block) over any other potential competitor block. It is achieved thanks to a cryptographically secure proof. This scheme is known as a proof-of-work and is discussed in detail in section <a href="#11.5._Mining_Proof-of-Work" data-href="#11.5._Mining_Proof-of-Work">11.5.</a></p>
</div>
<div class="paragraph data-line-57">
<p>Formally, we expand to:</p>
</div>
<div class="paragraph data-line-59">
<p>project, proposed by <a href="#_bookmark89" data-href="#_bookmark89">Rosenfeld et al. [2012</a>,] takes a similar but more simplified strategy, embellishing the rules of a transaction in order to break the fungibility of Bitcoin’s base currency and allow the creation and tracking of tokens through a special “chroma-wallet”-protocol-aware piece of</p>
</div>
<div class="paragraph data-line-61">
<p>(2)</p>
</div>
<div class="paragraph data-line-63">
<p>(3)</p>
</div>
<div class="paragraph data-line-65">
<p>(4)</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-68">
<p><em><strong>σ</strong>t</em>+1 ≡ <a href="#<em>bookmark67" data-href="#<em>bookmark67">Π(</a></em><strong>σ</strong>t, B_)</p>
</div>
<div class="paragraph data-line-70">
<p><em>B</em> ≡ (<em>&#8230;&#8203;,</em> (<em>T</em>0<em>, T</em>1<em>, &#8230;&#8203;</em>)<em>, &#8230;&#8203;</em>)</p>
</div>
<div class="paragraph data-line-72">
<p>Π(<em>*σ*, B</em>) ≡ <a href="#<em>bookmark65" data-href="#<em>bookmark65">Ω(</a>_B,</em> link:#<em>bookmark0<em class="Υ(Υ(">*σ*, T</em>0)<em>, T</em>1)</em>&#8230;&#8203;_)</p>
</div>
<div class="paragraph data-line-74">
<p>Where <a href="#_bookmark65" data-href="#_bookmark65">Ω</a> is the block-finalisation state transition func-</p>
</div>
<div class="quoteblock data-line-76">
<blockquote>
<div class="paragraph data-line-77">
<p>software.</p>
</div>
<div class="paragraph data-line-79">
<p>Additional work has been done in the area with discard- ing the decentralisation foundation; Ripple, discussed by <a href="#_bookmark74" data-href="#_bookmark74">Boutellier and Heinzen [2014</a>,] has sought to create a “fed- erated” system for currency exchange, effectively creating a new financial clearing system. It has demonstrated that high efficiency gains can be made if the decentralisation premise is discarded.</p>
</div>
<div class="paragraph data-line-81">
<p>Early work on smart contracts has been done by <a href="#<em>bookmark103" data-href="#<em>bookmark103">Szabo</a> <a href="#_bookmark103" data-href="#_bookmark103">[1997</a>] and <a href="#_bookmark86" data-href="#_bookmark86">Miller [1997</a>.] Around the 1990s it became clear that algorithmic enforcement of agreements could become a significant force in human cooperation. Though no specific system was proposed to implement such a system, it was proposed that the future of law would be heavily affected by such systems. In this light, Ethereum may be seen as a general implementation of such a _crypto-law</em> system.</p>
</div>
<div class="paragraph data-line-83">
<p>For a list of terms used in this paper, refer to Appen- dix <a href="#Appendix_A._Terminology" data-href="#Appendix_A._Terminology">A.</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-87">
<ol class="arabic" start="2">
<li class="data-line-87">
<p></p>
<div class="quoteblock data-line-89">
<blockquote>
<div class="paragraph data-line-90">
<p>The Blockchain Paradigm</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-93">
<blockquote>
<div class="paragraph data-line-94">
<p>Ethereum, taken as a whole, can be viewed as a transaction-based state machine: we begin with a gen- esis state and incrementally execute transactions to morph it into some current state. It is this current state which we accept as the canonical “version” of the world of Ethereum. The state can include such information as account bal- ances, reputations, trust arrangements, data pertaining to information of the physical world; in short, anything that can currently be represented by a computer is admis- sible. Transactions thus represent a valid arc between two states; the ‘valid’ part is important—there exist far more invalid state changes than valid state changes. Invalid state changes might, e.g., be things such as reducing an account balance without an equal and opposite increase elsewhere. A valid state transition is one which comes about through a transaction. Formally:</p>
</div>
<div class="paragraph data-line-96">
<p>tion (a function that rewards a nominated party); <a href="#4.3.<em>The_Block" data-href="#4.3.<em>The_Block">_B</em></a> is this block, which includes a series of transactions amongst some other components; and <a href="#_bookmark67" data-href="#_bookmark67">Π</a> is the block-level state-transition function.</p>
</div>
<div class="paragraph data-line-98">
<p>This is the basis of the blockchain paradigm, a model that forms the backbone of not only Ethereum, but all decentralised consensus-based transaction systems to date.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-102">
<ol class="arabic">
<li class="data-line-102">
<p><strong>Value.</strong> In order to incentivise computation within the network, there needs to be an agreed method for transmit- ting value. To address this issue, Ethereum has an intrinsic currency, Ether, known also as ETH and sometimes referred to by the Old English ¯D. The smallest subdenomination of Ether, and thus the one in which all integer values of the currency are counted, is the Wei. One Ether is defined as being 10<sup>18</sup> Wei. There exist other subdenominations of Ether:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-104">
<blockquote>
<div class="paragraph data-line-105">
<p>Multiplier Name</p>
</div>
<div class="paragraph data-line-107">
<p>100 Wei</p>
</div>
<div class="paragraph data-line-109">
<p>10<sup>12</sup> Szabo</p>
</div>
<div class="paragraph data-line-111">
<p>10<sup>15</sup> Finney</p>
</div>
<div class="paragraph data-line-113">
<p>10<sup>18</sup> Ether</p>
</div>
<div class="paragraph data-line-115">
<p>Throughout the present work, any reference to value, in the context of Ether, currency, a balance or a payment, should be assumed to be counted in Wei.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-119">
<ol class="arabic" start="2">
<li class="data-line-119">
<p><strong>Which History?</strong> Since the system is decentralised and all parties have an opportunity to create a new block on some older pre-existing block, the resultant structure is necessarily a tree of blocks. In order to form a consensus as to which path, from root <a href="#<em>bookmark153" data-href="#<em>bookmark153">(the genesis bloc</a>k) to leaf (the block containing the most recent transactions) through this tree structure, known as the blockchain, there must be an agreed-upon scheme. If there is ever a disagreement between nodes as to which root-to-leaf path down the block tree is the ‘best’ blockchain, then a _fork</em> occurs.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-121">
<blockquote>
<div class="paragraph data-line-122">
<p>(1) [<mark><em>bookmark0 .anchor]</mark>#<strong>_σ</em></strong></p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-125">
<p><em>t</em>+1</p>
</div>
<div class="quoteblock data-line-127">
<blockquote>
<div class="paragraph data-line-128">
<p>≡ Υ(<em><strong>σ</strong>t, T</em> )</p>
</div>
<div class="paragraph data-line-130">
<p>This would mean that past a given point in time (block), multiple states of the system may coexist: some nodes be-</p>
</div>
<div class="paragraph data-line-132">
<p>where Υ is the Ethereum state transition function. In Ethereum, Υ, together with <strong><em>σ</em></strong> are considerably more pow- erful than any existing comparable system; Υ allows com- ponents to carry out arbitrary computation, while <strong><em>σ</em></strong> allows components to store arbitrary state between transactions. Transactions are collated into blocks; blocks are chained together using a cryptographic hash as a means of refer- ence. Blocks function as a journal, recording a series of transactions together with the previous block and an iden- tifier for the final state (though do not store the final state</p>
</div>
<div class="paragraph data-line-134">
<p>lieving one block to contain the canonical transactions, other nodes believing some other block to be canonical, potentially containing radically different or incompatible transactions. This is to be avoided at all costs as the un- certainty that would ensue would likely kill all confidence in the entire system.</p>
</div>
<div class="paragraph data-line-136">
<p>The scheme we use in order to generate consensus is a simplified version of the GHOST protocol introduced by <a href="#_bookmark100" data-href="#_bookmark100">Sompolinsky and Zohar [2013</a>.] This process is described in detail in section <a href="#10._Blocktree_to_Blockchain" data-href="#10._Blocktree_to_Blockchain">10.</a></p>
</div>
<div class="paragraph data-line-138">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 3</p>
</div>
<div class="paragraph data-line-140">
<p>Sometimes, a path follows a new protocol from a par- ticular height (block number). This document describes one version of the protocol, namely the <em>Berlin</em> version defined by <a href="#_bookmark72" data-href="#_bookmark72">Beiko et al. [2021b</a>.] In order to follow back the history of a path, one must reference multiple versions of this document. Here are the block numbers of protocol updates on the Ethereum main network:</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-144">
<colgroup>
<col style="width: 45%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
Name
</em>_</em></th>
<th class="tableblock halign-left valign-top">First Block Number</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>Homestead</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1150000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>TangerineWhistle</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2463000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>SpuriousDragon</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2675000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>Byzantium</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4370000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>Constantinople</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7280000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>Petersburg</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7280000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>Istanbul</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9069000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>MuirGlacier</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9200000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>Berlin</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12244000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>London</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12965000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>F</em>ArrowGlacier</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13773000</p></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-219">
<blockquote>
<div class="paragraph data-line-220">
<p>Occasionally actors do not agree on a protocol change, and a permanent fork occurs. In order to distinguish be- tween diverged blockchains, EIP-155 by <a href="#<em>bookmark79" data-href="#<em>bookmark79">Buterin</a> <a href="#_bookmark79" data-href="#_bookmark79">[2016b</a>] introduced the concept of chain ID, which we denote by _β</em>.</p>
</div>
<div class="paragraph data-line-222">
<p>For the Ethereum main network</p>
</div>
<div class="paragraph data-line-224">
<p>(5) [<mark><em>bookmark1 .anchor]</mark>#_β</em> = 1</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-228">
<ol class="arabic" start="3">
<li class="data-line-228">
<p></p>
<div class="quoteblock data-line-230">
<blockquote>
<div class="paragraph data-line-231">
<p>Conventions</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-234">
<blockquote>
<div class="paragraph data-line-235">
<p>We use a number of typographical conventions for the formal notation, some of which are quite particular to the present work:</p>
</div>
<div class="paragraph data-line-237">
<p>The two sets of highly structured, ‘top-level’, state val- ues, are denoted with bold lowercase Greek letters. They fall into those of world-state, which are denoted <strong><em>σ</em></strong> (or a variant thereupon) and those of machine-state, <strong><em>µ</em></strong>.</p>
</div>
<div class="paragraph data-line-239">
<p>Functions operating on highly structured values are denoted with an upper-case Greek letter, e.g. <a href="#_bookmark0" data-href="#_bookmark0">Υ,</a> the Ethereum state transition function.</p>
</div>
<div class="paragraph data-line-241">
<p>For most functions, an uppercase letter is used, e.g. <em>C</em>, the general cost function. These may be subscripted to denote specialised variants, e.g. <a href="#_bookmark146" data-href="#_bookmark146"><em>C</em>SSTORE</a>, the cost func- tion for the <a href="#_bookmark145" data-href="#_bookmark145">SSTORE</a> operation. For specialised and possibly</p>
</div>
<div class="paragraph data-line-243">
<p>externally defined functions, we may format as typewriter text, e.g. the Keccak-256 hash function (as per version 3 of the winning entry to the SHA-3 contest by <a href="#_bookmark75" data-href="#_bookmark75">Bertoni</a> <a href="#_bookmark75" data-href="#_bookmark75">et al. [2011</a>,] rather than the final SHA-3 specification), is</p>
</div>
<div class="paragraph data-line-245">
<p>denoted KEC (and generally referred to as plain Keccak). Also, KEC512 refers to the Keccak-512 hash function.</p>
</div>
<div class="paragraph data-line-247">
<p>Tuples are typically denoted with an upper-case letter,</p>
</div>
<div class="paragraph data-line-249">
<p>e.g. <em>T</em> , is used to denote an Ethereum transaction. This symbol may, if accordingly defined, be subscripted to refer to an individual component, e.g. <a href="#_bookmark40" data-href="#_bookmark40"><em>T</em>n</a>, denotes the nonce of said transaction. The form of the subscript is used to</p>
</div>
<div class="paragraph data-line-251">
<p>denote its type; e.g. uppercase subscripts refer to tuples with subscriptable components.</p>
</div>
<div class="paragraph data-line-253">
<p>Scalars and fixed-size byte sequences (or, synonymously, arrays) are denoted with a normal lower-case letter, e.g. <em>n</em> is used in the document to denote a <a href="#_bookmark40" data-href="#_bookmark40">transaction nonce.</a> Those with a particularly special meaning may be Greek,</p>
</div>
<div class="paragraph data-line-255">
<p>e.g. <em>δ</em>, the number of items required on the stack for a given operation.</p>
</div>
<div class="paragraph data-line-257">
<p>Arbitrary-length sequences are typically denoted as a bold lower-case letter, e.g. <strong>o</strong> is used to denote the byte sequence given as the output data of a message call. For particularly important values, a bold uppercase letter may be used.</p>
</div>
<div class="paragraph data-line-259">
<p>Throughout, we assume scalars are non-negative inte- gers and thus belong to the set N. The set of all byte sequences is B, formally defined in Appendix <a href="#Appendix_B._Recursive_Length_Prefix" data-href="#Appendix_B._Recursive_Length_Prefix">B.</a> If such a set of sequences is restricted to those of a particular length, it is denoted with a subscript, thus the set of all</p>
</div>
<div class="paragraph data-line-261">
<p>byte sequences of length 32 is named B32 and the set of all non-negative integers smaller than 2<sup>256</sup> is named N256. This is formally defined in section <a href="#4.3._The_Block" data-href="#4.3._The_Block">4.3.</a></p>
</div>
<div class="paragraph data-line-263">
<p>Square brackets are used to index into and reference individual components or subsequences of sequences, e.g. <strong><em>µ</em>s</strong>[0] denotes the first item on the machine’s stack. For subsequences, ellipses are used to specify the intended range, to include elements at both limits, e.g. <strong><em>µ</em>m</strong>[0<em>..</em>31] denotes the first 32 items of the machine’s memory.</p>
</div>
<div class="paragraph data-line-265">
<p>In the case of the global state <strong><em>σ</em></strong>, which is a sequence of accounts, themselves tuples, the square brackets are used to reference an individual account.</p>
</div>
<div class="paragraph data-line-267">
<p>When considering variants of existing values, we follow the rule that within a given scope for definition, if we assume that the unmodified ‘input’ value be denoted by the placeholder then the modified and utilisable value is</p>
</div>
<div class="paragraph data-line-269">
<p>denoted as , and intermediate values would be ∗, ∗∗</p>
</div>
<div class="paragraph data-line-271">
<p>&amp;c. On very particular occasions, in order to maximise readability and only if unambiguous in meaning, we may use alpha-numeric subscripts to denote intermediate values, especially those of particular note.</p>
</div>
<div class="paragraph data-line-273">
<p>When considering the use of existing functions, given a function <em>f</em> , the function <a href="#<em>bookmark27" data-href="#<em>bookmark27">_f</em> <sup>∗</sup></a> denotes a similar, element-wise version of the function mapping instead between sequences. It is formally defined in section <a href="#4.3._The_Block" data-href="#4.3._The_Block">4.3.</a></p>
</div>
<div class="paragraph data-line-275">
<p>We define a number of useful functions throughout. <span id="<em>bookmark2 " class="anchor">#</span>#One of the more common is _.€</em>, which evaluates to the last item in the given sequence:</p>
</div>
<div class="paragraph data-line-277">
<p>(6) <em>.€</em>(<strong>x</strong>) ≡ <strong>x</strong>[ll<strong>x</strong>ll − 1]</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-281">
<ol class="arabic" start="4">
<li class="data-line-281">
<p></p>
<div class="quoteblock data-line-283">
<blockquote>
<div class="paragraph data-line-284">
<p>Blocks, State and Transactions</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-287">
<blockquote>
<div class="paragraph data-line-288">
<p>Having introduced the basic concepts behind Ethereum, we will discuss the meaning of a transaction, a block and the state in more detail.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-292">
<ol class="arabic">
<li class="data-line-292">
<p><strong>World State.</strong> The world state (<em>state</em>), is a map- ping between addresses (160-bit identifiers) and account states (a data structure serialised as RLP, see Appendix <a href="#Appendix_B.<em>Recursive_Length_Prefix" data-href="#Appendix_B.<em>Recursive_Length_Prefix">B).</a> Though not stored on the blockchain, it is assumed that the implementation will maintain this mapping in a modi- fied Merkle Patricia tree (_trie</em>, see Appendix <a href="#Appendix_D._Modified_Merkle_Patricia_Tre" data-href="#Appendix_D._Modified_Merkle_Patricia_Tre">D).</a> The trie requires a simple database backend that maintains a map- ping of byte arrays to byte arrays; we name this underlying database the state database. This has a number of benefits; firstly the root node of this structure is cryptographically dependent on all internal data and as such its hash can be used as a secure identity for the entire system state. Secondly, being an immutable data structure, it allows any previous state (whose root hash is known) to be recalled by simply altering the root hash accordingly. Since we store all such root hashes in the blockchain, we are able to trivially revert to old states.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-294">
<blockquote>
<div class="paragraph data-line-295">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 4</p>
</div>
<div class="paragraph data-line-297">
<p>The account state, <strong><em>σ</em></strong>[<em>a</em>], comprises the following four fields:</p>
</div>
<div class="paragraph data-line-299">
<p>[<mark><em>bookmark3 .anchor]</mark>#<strong>nonce:</strong> A scalar value equal to the number of trans- actions sent from this address or, in the case of accounts with associated code, the number of contract-creations made by this account. For ac- count of address _a</em> in state <strong><em>σ</em></strong>, this would be for- mally denoted <strong><em>σ</em></strong>[<em>a</em>]n.</p>
</div>
<div class="paragraph data-line-301">
<p><strong>balance:</strong> A scalar value equal to the number of Wei</p>
</div>
<div class="paragraph data-line-303">
<p>owned by this address. Formally denoted <strong><em>σ</em></strong><sub class="<em>a</em>">b</sub>.</p>
</div>
<div class="paragraph data-line-305">
<p><strong>storageRoot:</strong> A 256-bit hash of the root node of a Merkle Patricia tree that encodes the storage con- tents of the account (a mapping between 256-bit integer values), encoded into the trie as a mapping from the Keccak 256-bit hash of the 256-bit integer keys to the RLP-encoded 256-bit integer values. The hash is formally denoted <strong><em>σ</em></strong>[<em>a</em>]s.</p>
</div>
<div class="paragraph data-line-307">
<p><strong>codeHash:</strong> The hash of the EVM code of this</p>
</div>
<div class="paragraph data-line-309">
<p>account—this is the code that gets executed should this address receive a message call; it is immutable and thus, unlike all other fields, cannot be changed after construction. All such code fragments are contained in the state database under their corre- sponding hashes for later retrieval. This hash is formally denoted <strong><em>σ</em></strong>[<em>a</em>]c, and thus the code may be</p>
</div>
<div class="paragraph data-line-311">
<p>denoted as <strong>b</strong>, given that KEC(<strong>b</strong>) = <strong><em>σ</em></strong>[<em>a</em>]c.</p>
</div>
<div class="paragraph data-line-313">
<p>Since we typically wish to refer not to the trie’s root hash but to the underlying set of key/value pairs stored within, we define a convenient equivalence:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-317">
<ol class="arabic" start="7">
<li class="data-line-317">
<p>TRIE <em>L</em><sup>∗</sup><sub>I</sub> (<strong><em>σ</em></strong>[<em>a</em>]<strong><sub>s</sub></strong>) ≡ <strong><em>σ</em></strong><sub class="<em>a</em>">s</sub></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-319">
<blockquote>
<div class="paragraph data-line-320">
<p>The collapse function for the set of key/value pairs in the trie, <em>L</em><sup>∗</sup><sub>I</sub> , is defined as the element-wise transformation of the base function <em>L</em>I, given as:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-324">
<ol class="arabic" start="8">
<li class="data-line-324">
<p><em>L</em>I (<em>k, v</em>) ≡ KEC(<em>k</em>)<em>,</em> RLP(<em>v</em>) where:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-326">
<blockquote>
<div class="paragraph data-line-327">
<p>(9) <em>k</em> ∈ B32 ∧ <em>v</em> ∈ N</p>
</div>
<div class="paragraph data-line-329">
<p>It shall be understood that <strong><em>σ</em></strong>[<em>a</em>]<strong>s</strong> is not a ‘physical’ member of the account and does not contribute to its later serialisation.</p>
</div>
<div class="paragraph data-line-331">
<p>If the <strong>codeHash</strong> field is the Keccak-256 hash of the empty string, i.e. <strong><em>σ</em></strong>[<em>a</em>]c = KEC () , then the node represents a simple account, sometimes referred to as a “non-contract” account.</p>
</div>
<div class="paragraph data-line-333">
<p>Thus we may define a world-state collapse function <em>L</em>S:</p>
</div>
<div class="paragraph data-line-335">
<p>(10) <em>L</em>S(<strong><em>σ</em></strong>) ≡ \{<em>p</em>(<em>a</em>) : <strong><em>σ</em></strong>[<em>a</em>] ∅}</p>
</div>
<div class="paragraph data-line-337">
<p>where</p>
</div>
<div class="paragraph data-line-339">
<p>(11) <em>p</em>(<em>a</em>) ≡ KEC(<em>a</em>)<em>,</em> RLP (<strong><em>σ</em></strong><sub class="<em>a</em>">n</sub><em>, *σ*</em><sub class="<em>a</em>">b</sub><em>, *σ*</em><sub class="<em>a</em>">s</sub><em>, *σ*</em><sub class="<em>a</em>">c</sub>)</p>
</div>
<div class="paragraph data-line-341">
<p>This function, <em>L</em>S, is used alongside the trie function to provide a short identity (hash) of the world state. We assume:</p>
</div>
<div class="paragraph data-line-343">
<p>(12) ∀<em>a</em> : <strong><em>σ</em></strong>[<em>a</em>] = ∅ ∨ (<em>a</em> ∈ B20 ∧ <em>v</em>(<strong><em>σ</em></strong>[<em>a</em>])) where <em>v</em> is the account validity function:</p>
</div>
<div class="paragraph data-line-345">
<p>(13) _v_(_x_) ≡ <em>x</em><sub>n</sub> ∈ N<sub>256</sub>∧<em>x</em><sub>b</sub> ∈ N<sub>256</sub>∧<em>x</em><sub>s</sub> ∈ B<sub>32</sub>∧<em>x</em><sub>c</sub> ∈ B<sub>32</sub></p>
</div>
<div class="paragraph data-line-347">
<p>An account is <em>empty</em> when it has no code, zero nonce and zero balance:</p>
</div>
<div class="paragraph data-line-349">
<p>(14)</p>
</div>
<div class="paragraph data-line-351">
<p>EMPTY(<em>*σ*, a</em>) ≡ <strong><em>σ</em></strong><sub class="<em>a</em>">c</sub> = KEC () ∧<strong><em>σ</em></strong><sub class="<em>a</em>">n</sub> = 0∧<strong><em>σ</em></strong><sub class="<em>a</em>">b</sub> = 0</p>
</div>
<div class="paragraph data-line-353">
<p>Even callable precompiled contracts can have an empty account state. This is because their account states do not usually contain the code describing its behavior.</p>
</div>
<div class="paragraph data-line-355">
<p>An account is <em>dead</em> when its account state is non-existent or empty:</p>
</div>
<div class="paragraph data-line-357">
<p>(15) DEAD(<em>*σ*, a</em>) ≡ <strong><em>σ</em></strong>[<em>a</em>] = ∅ ∨ EMPTY(<em>*σ*, a</em>)</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-361">
<ol class="arabic">
<li class="data-line-361">
<p><strong>The Transaction.</strong> A transaction (formally, <em>T</em> ) is a single cryptographically-signed instruction constructed by an actor externally to the scope of Ethereum. The sender of a transaction cannot be a contract. While it is assumed that the ultimate external actor will be human in nature, software tools will be used in its construction and dissemi- nation<a href="#_bookmark10" data-href="#_bookmark10"><sup>1</sup></a>. EIP-2718 by <a href="#_bookmark110" data-href="#_bookmark110">Zoltu [2020</a>] introduced the notion of different transaction types. As of the Berlin version of the protocol, there are two transaction types: 0 (legacy) and 1 (EIP-2930 by <a href="#_bookmark80" data-href="#_bookmark80">Buterin and Swende [2020b</a>).] Further, there are two subtypes of transactions: those which result in message calls and those which result in the creation of new accounts with associated code (known informally as ‘contract creation’). All transaction types specify a number of common fields:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-363">
<blockquote>
<div class="paragraph data-line-364">
<p>[<mark>_bookmark4 .anchor]</mark>#<strong>type:</strong> EIP-2718 transaction type; formally <em>T</em>x.</p>
</div>
<div class="paragraph data-line-366">
<p><strong>nonce:</strong> A scalar value equal to the number of trans- <span id="_bookmark5 " class="anchor">#</span>#actions sent by the sender; formally <em>T</em>n.</p>
</div>
<div class="paragraph data-line-368">
<p><strong>gasPrice:</strong> A scalar value equal to the number of</p>
</div>
<div class="paragraph data-line-370">
<p>Wei to be paid per unit of <em>gas</em> for all computation costs incurred as a result of the execution of this <span id="_bookmark6 " class="anchor">#</span>#transaction; formally <em>T</em>p.</p>
</div>
<div class="paragraph data-line-372">
<p><strong>gasLimit:</strong> A scalar value equal to the maximum</p>
</div>
<div class="paragraph data-line-374">
<p>amount of gas that should be used in executing this transaction. This is paid up-front, before any computation is done and may not be increased later; formally <em>T</em>g.</p>
</div>
<div class="paragraph data-line-376">
<p><strong>to:</strong> The 160-bit address of the message call’s recipi-</p>
</div>
<div class="paragraph data-line-378">
<p>ent or, for a contract creation transaction, ∅, used here to denote the only member of B0 ; formally [<mark>_bookmark7 .anchor]</mark>#<em>T</em>t.</p>
</div>
<div class="paragraph data-line-380">
<p><strong>value:</strong> A scalar value equal to the number of Wei to</p>
</div>
<div class="paragraph data-line-382">
<p>be transferred to the message call’s recipient or, in the case of contract creation, as an endowment <span id="_bookmark8 " class="anchor">#</span>#to the newly created account; formally <em>T</em>v.</p>
</div>
<div class="paragraph data-line-384">
<p><strong>r, s:</strong> Values corresponding to the signature of the</p>
</div>
<div class="paragraph data-line-386">
<p>transaction and used to determine the sender of the transaction; formally <em>T</em>r and <em>T</em>s. This is ex- panded in Appendix <a href="#Appendix_F._Signing_Transactions" data-href="#Appendix_F._Signing_Transactions">F.</a></p>
</div>
<div class="paragraph data-line-388">
<p>EIP-2930 (type 1) transactions also have:</p>
</div>
<div class="paragraph data-line-390">
<p><strong>accessList:</strong> <span id="<em>bookmark9 " class="anchor">#</span>#List of access entries to warm up; for- mally _T</em>*<sub>A</sub>*. Each access list entry <em>E</em> is a tuple of an account address and a list of storage keys:</p>
</div>
<div class="paragraph data-line-392">
<p><em>E</em> ≡ (<em>E</em>a<em>, E</em>*s*).</p>
</div>
<div class="paragraph data-line-394">
<p><strong>chainId:</strong> Chain ID; formally <em>T</em>c. Must be equal to the network chain ID <a href="#<em>bookmark1" data-href="#<em>bookmark1">_β</em></a>.</p>
</div>
<div class="paragraph data-line-396">
<p><strong>yParity:</strong> Signature Y parity; formally <em>T</em>y.</p>
</div>
<div class="paragraph data-line-398">
<p>1[<mark>_bookmark10 .anchor]</mark>###Notably, such ‘tools’ could ultimately become so causally removed from their human-based initiation—or humans may become so causally-neutral—that there could be a point at which they rightly be considered autonomous agents. e.g. contracts may offer bounties to humans for being sent transactions to initiate their execution.</p>
</div>
<div class="paragraph data-line-400">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 5</p>
</div>
<div class="paragraph data-line-402">
<p>Legacy transactions do not have an <strong>accessList</strong> (<em>T</em>*<sub>A</sub>* = ()), while <strong>chainId</strong> and <strong>yParity</strong> for legacy transactions are combined into a single value:</p>
</div>
<div class="paragraph data-line-404">
<p>[<mark>_bookmark11 .anchor]</mark>#<strong>w:</strong> A scalar value encoding Y parity and possi- bly chain ID; formally <em>T</em>w. <em>T</em>w = 27 + <em>T</em>y or <em>T</em>w = 2<em>β</em>+35+<em>T</em>y (see EIP-155 by <a href="#_bookmark79" data-href="#_bookmark79">Buterin [2016b</a>).]</p>
</div>
<div class="paragraph data-line-406">
<p>Additionally, a contract creation transaction (regardless whether legacy or EIP-2930) contains:</p>
</div>
<div class="paragraph data-line-408">
<p><strong>init:</strong> An unlimited size byte array specifying the EVM-code for the account initialisation procedure, formally <em>T</em>*<sub>i</sub>*.</p>
</div>
<div class="paragraph data-line-410">
<p><strong>init</strong> is an EVM-code fragment; it returns the <strong>body</strong>, a second fragment of code that executes each time the account receives a message call (either through a trans- action or due to the internal execution of code). <strong>init</strong> is executed only once at account creation and gets discarded immediately thereafter.</p>
</div>
<div class="paragraph data-line-412">
<p>In contrast, a message call transaction contains:</p>
</div>
<div class="paragraph data-line-414">
<p><strong>data:</strong> An unlimited size byte array specifying the input data of the message call, formally <em>T</em>*<sub>d</sub>*.</p>
</div>
<div class="paragraph data-line-416">
<p>Appendix <a href="#Appendix_F.<em>Signing_Transactions" data-href="#Appendix_F.<em>Signing_Transactions">F</a> specifies the function, _S</em>, which maps trans- actions to the sender, and happens through the ECDSA of the SECP-256k1 curve, using the hash of the transaction (excepting the latter three signature fields) as the datum to sign. For the present we simply assert that the sender of a given transaction <em>T</em> can be represented with <em>S</em>(<em>T</em> ).</p>
</div>
<div class="paragraph data-line-418">
<p>(16)</p>
</div>
<div class="paragraph data-line-420">
<p>[<mark>_bookmark12 .anchor]</mark>#(<em>T</em>n<em>, T</em>p<em>, T</em>g<em>, T</em>t<em>, T</em>v<em>,</em> *p*<em>, T</em>w<em>, T</em>r<em>, T</em>s) if <em>T</em>x = 0</p>
</div>
<div class="paragraph data-line-422">
<p>[<mark>_bookmark13 .anchor]</mark>#<strong>parentHash:</strong> The Keccak 256-bit hash of the parent block’s header, in its entirety; formally <em>H</em>p.</p>
</div>
<div class="paragraph data-line-424">
<p><strong>ommersHash:</strong> The Keccak 256-bit hash of the om-</p>
</div>
<div class="paragraph data-line-426">
<p>mers list portion of this block; formally <em>H</em>o.</p>
</div>
<div class="paragraph data-line-428">
<p><strong>beneficiary:</strong> The 160-bit address to which all fees collected from the successful mining of this block be transferred; formally <em>H</em>c.</p>
</div>
<div class="paragraph data-line-430">
<p><strong>stateRoot:</strong> The Keccak 256-bit hash of the root</p>
</div>
<div class="paragraph data-line-432">
<p>node of the state trie, after all transactions are executed and finalisations applied; formally <em>H</em>r.</p>
</div>
<div class="paragraph data-line-434">
<p><strong>transactionsRoot:</strong> The Keccak 256-bit hash of the</p>
</div>
<div class="paragraph data-line-436">
<p>root node of the trie structure populated with each transaction in the transactions list portion of the block; formally <em>H</em>t.</p>
</div>
<div class="paragraph data-line-438">
<p><strong>receiptsRoot:</strong> The Keccak 256-bit hash of the root</p>
</div>
<div class="paragraph data-line-440">
<p>node of the trie structure populated with the re- ceipts of each transaction in the transactions list portion of the block; formally <em>H</em>e.</p>
</div>
<div class="paragraph data-line-442">
<p><strong>logsBloom:</strong> The Bloom filter composed from index-</p>
</div>
<div class="paragraph data-line-444">
<p>able information (logger address and log topics) contained in each log entry from the receipt of each transaction in the transactions list; formally <em>H</em><sub>b</sub>.</p>
</div>
<div class="paragraph data-line-446">
<p><strong>difficulty:</strong> A scalar value corresponding to the dif-</p>
</div>
<div class="paragraph data-line-448">
<p>ficulty level of this block. This can be calculated from the previous block’s difficulty level and the timestamp; formally <em>H</em><sub>d</sub>.</p>
</div>
<div class="paragraph data-line-450">
<p><strong>number:</strong> A scalar value equal to the number of an-</p>
</div>
<div class="paragraph data-line-452">
<p>cestor blocks. The genesis block has a number of zero; formally <a href="#_bookmark30" data-href="#_bookmark30"><em>H</em>i</a>.</p>
</div>
<div class="paragraph data-line-454">
<p>where</p>
</div>
<div class="paragraph data-line-456">
<p>c n p g t v</p>
</div>
<div class="paragraph data-line-458">
<p><strong>A</strong> y r s x</p>
</div>
<div class="paragraph data-line-460">
<p><span id="<em>bookmark14 " class="anchor">#</span>#of gas expenditure per block; formally _H</em><sub>l</sub>.</p>
</div>
<div class="paragraph data-line-462">
<p><strong>gasUsed:</strong> A scalar value equal to the total gas used</p>
</div>
<div class="paragraph data-line-464">
<p>(17) <strong>p</strong> <em>T</em>*<sub>i</sub>* if <em>T</em><sub>t</sub> = ∅</p>
</div>
<div class="paragraph data-line-466">
<p><em>T</em>*<sub>d</sub>* otherwise</p>
</div>
<div class="paragraph data-line-468">
<p>Here, we assume all components are interpreted by the RLP as integer values, with the exception of the access list <em>T</em>*<sub>A</sub>* and the arbitrary length byte arrays <em>T</em>*<sub>i</sub>* and <em>T</em>*<sub>d</sub>*.</p>
</div>
<div class="paragraph data-line-470">
<p>(18) <em>T</em>x ∈ \{0<em>,</em> 1} ∧ <em>T</em>c = <em>β</em> ∧ <em>T</em>n ∈ N256 ∧ <em>T</em>p ∈ N256 ∧ <em>T</em>g ∈ N256 ∧ <em>T</em>v ∈ N256 ∧ <em>T</em>w ∈ N256 ∧ <em>T</em>r ∈ N256 ∧ <em>T</em>s ∈ N256 ∧ <em>T</em><sub>y</sub> ∈ N<sub>1</sub> ∧ <em>T</em>*<sub>d</sub>* ∈ B ∧ <em>T</em>*<sub>i</sub>* ∈ B</p>
</div>
<div class="paragraph data-line-472">
<p>where</p>
</div>
<div class="paragraph data-line-474">
<p>(19) Nn = \{<em>P</em> : <em>P</em> ∈ N ∧ <em>P &lt;</em> 2<em>n</em>}</p>
</div>
<div class="paragraph data-line-476">
<p>The address hash <em>T</em>*t* is slightly different: it is either a 20-byte address hash or, in the case of being a contract- creation transaction (and thus formally equal to ∅), it is</p>
</div>
<div class="paragraph data-line-478">
<p>the RLP empty byte sequence and thus the member of B0:</p>
</div>
<div class="paragraph data-line-480">
<p>in transactions in this block; formally <em>H</em>g.</p>
</div>
<div class="paragraph data-line-482">
<p><strong>timestamp:</strong> A scalar value equal to the reasonable output of Unix’s time() at this block’s inception; <span id="_bookmark15 " class="anchor">#</span>#formally <a href="#_bookmark32" data-href="#_bookmark32"><em>H</em>s</a>.</p>
</div>
<div class="paragraph data-line-484">
<p><strong>extraData:</strong> An arbitrary byte array containing data</p>
</div>
<div class="paragraph data-line-486">
<p>relevant to this block. This must be 32 bytes or <span id="_bookmark16 " class="anchor">#</span>#fewer; formally <em>H</em>x.</p>
</div>
<div class="paragraph data-line-488">
<p><strong>mixHash:</strong> A 256-bit hash which, combined with the</p>
</div>
<div class="paragraph data-line-490">
<p>nonce, proves that a sufficient amount of compu- tation has been carried out on this block; formally [<mark>_bookmark17 .anchor]</mark>#<em>H</em>m.</p>
</div>
<div class="paragraph data-line-492">
<p><strong>nonce:</strong> A 64-bit value which, combined with the mix-</p>
</div>
<div class="paragraph data-line-494">
<p>hash, proves that a sufficient amount of computa- tion has been carried out on this block; formally <a href="#_bookmark33" data-href="#_bookmark33"><em>H</em>n</a>.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-498">
<ol class="arabic" start="20">
<li class="data-line-498">
<p><em>T</em></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-500">
<blockquote>
<div class="paragraph data-line-501">
<p>∈ fB20 if <em>T</em>t = ∅</p>
</div>
<div class="paragraph data-line-503">
<p><span id="_bookmark18 " class="anchor">#</span>#The other two components in the block are simply a list</p>
</div>
<div class="paragraph data-line-505">
<p>B0 otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-509">
<ol class="arabic">
<li class="data-line-509">
<p>[<mark>4.3.<em>The_Block .anchor]</mark>#<strong>The Block.</strong> The block in Ethereum is the collec- tion of relevant pieces of information (known as the block _header</em> ), <em>H</em>, together with information corresponding to the comprised transactions, <strong>T</strong>, and a set of other block headers <strong>U</strong> that are known to have a parent equal to the present block’s parent’s parent (such blocks are known as _ommers_<a href="#_bookmark20" data-href="#_bookmark20"><sup>2</sup></a>). The block header contains several pieces of information:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-511">
<blockquote>
<div class="paragraph data-line-512">
<p>of ommer block headers (of the same format as above),</p>
</div>
<div class="paragraph data-line-514">
<p><em>B</em>*<sub>U</sub>* and a series of the transactions, <em>B</em>*<sub>T</sub>*. Formally, we can refer to a block <em>B</em>:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-518">
<ol class="arabic" start="21">
<li class="data-line-518">
<p><em>B</em> ≡ (<em>B</em><sub>H</sub><em>, B</em>*<sub>T</sub><strong><em>, B</em></strong><sub>U</sub>*)</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-520">
<blockquote>
<div class="paragraph data-line-521">
<p>2[<mark><em>bookmark20 .anchor]</mark>###_ommer</em> is a gender-neutral term to mean “sibling of parent”; see <a href="https://nonbinary.miraheze.org/wiki/Gender_neutral_language_in_English%23Aunt/Uncle" data-href="https://nonbinary.miraheze.org/wiki/Gender_neutral_language_in_English%23Aunt/Uncle">https://nonbinary.miraheze.org/wiki/Gender_neutral_language_in_</a> <a href="https://nonbinary.miraheze.org/wiki/Gender_neutral_language_in_English%23Aunt/Uncle" data-href="https://nonbinary.miraheze.org/wiki/Gender_neutral_language_in_English%23Aunt/Uncle">English#Aunt/Uncle</a></p>
</div>
<div class="paragraph data-line-523">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 6</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-527">
<ol class="arabic">
<li class="data-line-527">
<p><span id="<em>bookmark21 " class="anchor">_Transaction Receipt.</em> In order to encode information about a transaction concerning which it may be useful to form a zero-knowledge proof, or index and search, we encode a receipt of each transaction containing certain in- formation from its execution. Each receipt, denoted <em>B</em>*<sub>R</sub>*[<em>i</em>] for the <em>i</em>th transaction, is placed in an index-keyed <a href="#_bookmark118" data-href="#_bookmark118">trie</a> [<mark>_bookmark22 .anchor]</span></mark>#and the root recorded in the header as <a href="#_bookmark24" data-href="#_bookmark24"><em>H</em>e</a>.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-529">
<blockquote>
<div class="paragraph data-line-530">
<p>The transaction receipt, <em>R</em>, is a tuple of five items com-</p>
</div>
<div class="paragraph data-line-532">
<p>prising: the type of the transaction, <em>R</em>x, the status code of the transaction, <em>R</em>z, the cumulative gas used in the block containing the transaction receipt as of immediately after the transaction has happened, <em>R</em>u, the set of logs created through execution of the transaction, <a href="#<em>bookmark116" data-href="#<em>bookmark116">_R</em>*<sub>l</sub>*</a> and the Bloom filter composed from information in those logs, <a href="#<em>bookmark114" data-href="#<em>bookmark114">_R</em><sub>b</sub></a>:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-536">
<ol class="arabic" start="2">
<li class="data-line-536">
<p><em>Holistic Validity.</em> We can assert a block’s validity if and only if it satisfies several conditions: it must be in- ternally consistent with the ommer and transaction block hashes and the given transactions <em>B</em>*<sub>T</sub>* (as specified in sec <a href="#11.<em>Block_Finalisation" data-href="#11.<em>Block_Finalisation">11),</a> when executed in order on the base state <strong>_σ</em></strong> (derived from the final state of the parent block), result in a new state of the identity <em>H</em>r:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-538">
<blockquote>
<div class="paragraph data-line-539">
<p>(33) [<mark><em>bookmark23 .anchor]</mark>#<em>H</em>r ≡ TRIE(_LS</em> (Π(<em>*σ*, B</em>))) ∧ <em>H</em><sub>o</sub> ≡ KEC(RLP(<em>L</em><sup>∗</sup><em><sub>H</sub></em> (<em>B</em>*<sub>U</sub>*))) ∧ <em>H</em><sub>t</sub> ≡ TRIE(\{∀<em>i &lt;</em> ll<em>B</em><strong><sub>T</sub></strong>ll<em>, i</em> ∈ N :</p>
</div>
<div class="paragraph data-line-541">
<p><em>p</em><sub>T</sub>(<em>i, B</em>*<sub>T</sub>*[<em>i</em>])}) ∧</p>
</div>
<div class="paragraph data-line-543">
<p>[<mark><em>bookmark24 .anchor]</mark>#_H</em><sub>e</sub> ≡ TRIE(\{∀<em>i &lt;</em> ll<em>B</em><strong><sub>R</sub></strong>ll<em>, i</em> ∈ N :</p>
</div>
<div class="paragraph data-line-545">
<p><em>p</em><sub>R</sub>(<em>i, B</em>*<sub>R</sub>*[<em>i</em>])}) ∧</p>
</div>
<div class="paragraph data-line-547">
<p>[<mark>_bookmark26 .anchor]</mark>#<em>R</em>x is equal to the <a href="#_bookmark4" data-href="#_bookmark4">type</a> of the corresponding transaction.</p>
</div>
<div class="paragraph data-line-549">
<p>The function <em>L</em>R prepares a transaction receipt for being transformed into an RLP-serialised byte array:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-553">
<ol class="arabic" start="23">
<li class="data-line-553">
<p><em>L</em><sub>R</sub>(<em>R</em>) ≡ (<em>R</em><sub>z</sub><em>, R</em><sub>u</sub><em>, R</em><sub>b</sub><em>, R</em>*<sub>l</sub>*)</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-555">
<blockquote>
<div class="paragraph data-line-556">
<p>We assert that the status code <em>R</em>z is a non-negative</p>
</div>
<div class="paragraph data-line-558">
<p>where <em>p</em>T(<em>k, v</em>) and <em>p</em>R(<em>k, v</em>) are pairwise RLP transforma- tions, but with a special treatment for EIP-2718 transac- tions:</p>
</div>
<div class="paragraph data-line-560">
<p>(34)</p>
</div>
<div class="paragraph data-line-562">
<p><em>p</em> (<em>k, T</em> ) RLP(<em>k</em>)<em>,</em> RLP(<a href="#<em>bookmark12" data-href="#<em>bookmark12"><em>L</em>T</a>(_T</em> )) if <em>T</em>x = 0</p>
</div>
<div class="paragraph data-line-564">
<p>(<em>T</em>x) · RLP(<em>L</em>T(<em>T</em> )) otherwise</p>
</div>
<div class="paragraph data-line-566">
<p>integer:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-570">
<ol class="arabic" start="24">
<li class="data-line-570">
<p><em>R</em>z ∈ N</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-572">
<blockquote>
<div class="paragraph data-line-573">
<p>We assert that <em>R</em>u, the cumulative gas used, is a non- negative integer and that the logs Bloom, <em>R</em><sub>b</sub>, is a hash of</p>
</div>
<div class="paragraph data-line-575">
<p>and</p>
</div>
<div class="paragraph data-line-577">
<p>(35)</p>
</div>
<div class="paragraph data-line-579">
<p><em>p</em>R(<em>k, R</em>) ≡</p>
</div>
<div class="paragraph data-line-581">
<p>RLP(<em>k</em>)<em>,</em></p>
</div>
<div class="paragraph data-line-583">
<p>RLP(<a href="#<em>bookmark26" data-href="#<em>bookmark26"><em>L</em>R</a>(_R</em>)) if <em>R</em>x = 0</p>
</div>
<div class="paragraph data-line-585">
<p>(<em>R</em>x) · RLP(<em>L</em>R(<em>R</em>)) otherwise</p>
</div>
<div class="paragraph data-line-587">
<p>size 2048 bits (256 bytes):</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-591">
<ol class="arabic" start="25">
<li class="data-line-591">
<p><em>R</em><sub>u</sub> ∈ N ∧ <em>R</em><sub>b</sub> ∈ B<sub>256</sub></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-593">
<blockquote>
<div class="paragraph data-line-594">
<p>The sequence <em>R</em>*<sub>l</sub>* is a series of log entries, (<em>O</em><sub>0</sub><em>, O</em><sub>1</sub><em>, &#8230;&#8203;</em>). A log entry, <em>O</em>, is a tuple of the logger’s address, <em>Oa</em>, a possibly empty series of 32-byte log topics, <em>O</em>*t* and some number of bytes of data, <em>O</em>*<sub>d</sub>*:</p>
</div>
<div class="paragraph data-line-596">
<p>(26) <em>O</em> ≡ (<em>O</em><sub>a</sub><em>,</em> (<em>O</em><sub><strong>t</strong>0</sub><em>, O</em><sub><strong>t</strong>1</sub><em>, &#8230;&#8203;</em>)<em>, O</em>*<sub>d</sub>*)</p>
</div>
<div class="paragraph data-line-598">
<p>(27) <em>O</em><sub>a</sub> ∈ B<sub>20</sub> ∧ ∀<em>x</em> ∈ <em>O</em>*<sub>t</sub>* : <em>x</em> ∈ B<sub>32</sub> ∧ <em>O</em>*<sub>d</sub>* ∈ B</p>
</div>
<div class="paragraph data-line-600">
<p>We define the Bloom filter function, <em>M</em> , to reduce a log entry into a single 256-byte hash:</p>
</div>
<div class="paragraph data-line-602">
<p>(· is the concatenation of byte arrays).</p>
</div>
<div class="paragraph data-line-604">
<p>Furthermore:</p>
</div>
<div class="paragraph data-line-606">
<p>(36) TRIE(<em>L</em>S(<strong><em>σ</em></strong>)) = <em>P</em> (<em>BH</em> )<em>H</em> r</p>
</div>
<div class="paragraph data-line-608">
<p>Thus TRIE(<em>L</em>S(<strong><em>σ</em></strong>)) is the root node hash of the Merkle Patricia tree structure containing the key-value pairs of the state <strong><em>σ</em></strong> with values encoded using RLP, and <em>P</em> (<em>B</em>H) is the parent block of <em>B</em>, defined directly.</p>
</div>
<div class="paragraph data-line-610">
<p>The values stemming from the computation of transac- tions, specifically the <a href="#<em>bookmark21" data-href="#<em>bookmark21">transaction receipts,</a> _B</em>*<sub>R</sub>*, and that defined through the transaction’s <a href="#<em>bookmark67" data-href="#<em>bookmark67">state-accumulation func-</a> <a href="#_bookmark67" data-href="#_bookmark67">tion, Π,</a> are formalised later in section <a href="#11.4._State</em>&amp;_Nonce_Validation" data-href="#11.4._State</em>&amp;_Nonce_Validation">11.4.</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-614">
<ol class="arabic">
<li class="data-line-614">
<p><em>Serialisation.</em> The function <em>L</em>B and <em>L</em>H are the prepa-</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-616">
<blockquote>
<div class="paragraph data-line-617">
<p>(28) <em>M</em> (<em>O</em>) ≡</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-620">
<p><em>x</em>∈\{<em>O</em>a}∪<em>O</em>*t*</p>
</div>
<div class="paragraph data-line-622">
<p><em>M</em>3:2048(<em>x</em>)</p>
</div>
<div class="quoteblock data-line-624">
<blockquote>
<div class="paragraph data-line-625">
<p>ration functions for a block and block header respectively. We assert the types and order of the structure for when</p>
</div>
<div class="paragraph data-line-627">
<p>where <em>M</em>3:2048 is a specialised Bloom filter that sets three</p>
</div>
<div class="paragraph data-line-629">
<p>the RLP transformation is required:</p>
</div>
<div class="paragraph data-line-631">
<p>bits out of 2048, given an arbitrary byte sequence. It does</p>
</div>
<div class="paragraph data-line-633">
<p>this through taking the low-order 11 bits of each of the first three pairs of bytes in a Keccak-256 hash of the byte sequence.<a href="#_bookmark28" data-href="#_bookmark28"><sup>3</sup></a> Formally:</p>
</div>
<div class="paragraph data-line-635">
<p>(37)</p>
</div>
<div class="paragraph data-line-637">
<p>(38)</p>
</div>
<div class="paragraph data-line-639">
<p><em>L</em><sub>H</sub>(<em>H</em>) ≡ ( <em>H</em><sub>p</sub><em>, H</em><sub>o</sub><em>, H</em><sub>c</sub><em>, H</em><sub>r</sub><em>, H</em><sub>t</sub><em>, H</em><sub>e</sub><em>, H</em><sub>b</sub><em>, H</em><sub>d</sub><em>,</em></p>
</div>
<div class="paragraph data-line-641">
<p><em>H</em><sub>i</sub><em>, H</em><sub>l</sub><em>, H</em><sub>g</sub><em>, H</em><sub>s</sub><em>, H</em><sub>x</sub><em>, H</em><sub>m</sub><em>, H</em><sub>n</sub> )</p>
</div>
<div class="paragraph data-line-643">
<p><em>L</em><sub>B</sub>(<em>B</em>) ≡ <em>L</em><sub>H</sub>(<em>B</em><sub>H</sub>)<em>, L</em> ∗T(<em>B</em>*<sub>T</sub><strong>)<em>, L</em><sup>∗</sup><sub>H</sub>(<a href="#<em>bookmark18" data-href="#<em>bookmark18">_B</em></strong><sub>U</sub>*</a>)</p>
</div>
<div class="paragraph data-line-645">
<p>(29)<em>M</em></p>
</div>
<div class="paragraph data-line-647">
<p>(<strong>x</strong> : <strong>x</strong> ∈</p>
</div>
<div class="paragraph data-line-649">
<p><strong>y</strong> : <strong>y</strong> ∈ B256 where: (0<em>,</em> 0<em>, &#8230;&#8203;,</em> 0) except:</p>
</div>
<div class="paragraph data-line-651">
<p>where <em>L</em> T takes a special care of EIP-2718 transactions:</p>
</div>
<div class="paragraph data-line-653">
<p>B2047−<em>m</em>(<strong>x*<em>,i</em>)(*y</strong>) = 1</p>
</div>
<div class="paragraph data-line-655">
<p>KEC(<strong>x</strong>)[<em>i, i</em> + 1] mod 2048</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-658">
<p>(39)</p>
</div>
<div class="quoteblock data-line-660">
<blockquote>
<div class="paragraph data-line-661">
<p><em>L</em> T</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-664">
<p>(<em>T</em> ) = <a href="#<em>bookmark12" data-href="#<em>bookmark12"><em>L</em>T</a>(_T</em> ) if <em>T</em>x = 0</p>
</div>
<div class="quoteblock data-line-666">
<blockquote>
<div class="paragraph data-line-667">
<p>(<em>T</em>x) · RLP(<em>L</em>T(<em>T</em> )) otherwise</p>
</div>
<div class="paragraph data-line-669">
<p>where B is the bit reference function such that Bj(<strong>x</strong>) equals the bit of index <em>j</em> (indexed from 0) in the byte array <strong>x</strong>. Notably, it treats <strong>x</strong> as big-endian (more significant bits</p>
</div>
<div class="paragraph data-line-671">
<p>will have smaller indices).</p>
</div>
<div class="paragraph data-line-673">
<p><span id="<em>bookmark27 " class="anchor">#</span>#with _L</em><sup>∗</sup><sub>T</sub> and <em>L</em><sup>∗</sup><sub>H</sub> being element-wise sequence transforma- tions, thus:</p>
</div>
<div class="paragraph data-line-675">
<p><em>f</em> ∗<span id="<em>bookmark28 " class="anchor">#</span># (<em>x</em>0<em>, x</em>1<em>, &#8230;&#8203;</em>) ≡ _f</em> (<em>x</em>0)<em>, f</em> (<em>x</em>1)<em>, &#8230;&#8203;</em> for any function <em>f</em></p>
</div>
<div class="paragraph data-line-677">
<p>311 bits = 2<sup>2048</sup>, and the low-order 11 bits is the modulo 2048 of the operand, which is in this case is “each of the first three pairs of bytes in a Keccak-256 hash of the byte sequence.”</p>
</div>
<div class="paragraph data-line-679">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 7</p>
</div>
<div class="paragraph data-line-681">
<p>The component types are defined thus:</p>
</div>
<div class="paragraph data-line-683">
<p>(41) <a href="#<em>bookmark13" data-href="#<em>bookmark13"><em>H</em>p</a> ∈ B32 ∧ <em>H</em>o ∈ B32 ∧ <em>H</em>c ∈ B20 ∧ <a href="#_bookmark23" data-href="#_bookmark23"><em>H</em>r</a> ∈ B32 ∧ <em>H</em>t ∈ B32 ∧ <a href="#_bookmark24" data-href="#_bookmark24"><em>H</em>e</a> ∈ B32 ∧ <a href="#_bookmark25" data-href="#_bookmark25">_H</em><sub>b</sub></a> ∈ B<sub>256</sub> ∧ <em>H</em><sub>d</sub> ∈ N ∧ <a href="#<em>bookmark30" data-href="#<em>bookmark30">_H</em><sub>i</sub></a> ∈ N ∧ <a href="#<em>bookmark29" data-href="#<em>bookmark29">_H</em><sub>l</sub></a> ∈ N ∧ <em>H</em><sub>g</sub> ∈ N ∧ <a href="#<em>bookmark32" data-href="#<em>bookmark32">_H</em><sub>s</sub></a> ∈ N<sub>256</sub> ∧ <a href="#_bookmark15" data-href="#_bookmark15"><em>H</em>x</a> ∈ B ∧ <em>H</em>m ∈ B32 ∧ <a href="#_bookmark17" data-href="#_bookmark17"><em>H</em>n</a> ∈ B8</p>
</div>
<div class="paragraph data-line-685">
<p>where</p>
</div>
<div class="paragraph data-line-687">
<p>(42) Bn = \{<em>B</em> : <em>B</em> ∈ B ∧ ll<em>B</em>ll = <em>n</em>}</p>
</div>
<div class="paragraph data-line-689">
<p>We now have a rigorous specification for the construc- tion of a formal block structure. The RLP function RLP (see Appendix <a href="#Appendix_B._Recursive_Length_Prefix" data-href="#Appendix_B._Recursive_Length_Prefix">B)</a> provides the canonical method for trans- forming this structure into a sequence of bytes ready for transmission over the wire or storage locally.</p>
</div>
<div class="paragraph data-line-691">
<p><a href="#<em>bookmark77" data-href="#<em>bookmark77">[2016a</a>.] In the _Byzantium</em> release, with EIP-649, the ice age was delayed by creating a fake block number, <em>H</em><sub>i</sub> , which is obtained by subtracting three million from the actual block number, which in other words reduced <em>E</em> and the time difference between blocks, in order to allow more time to develop proof-of-stake and preventing the network from “freezing” up. Subsequently, EIP-1234 by <a href="#<em>bookmark94" data-href="#<em>bookmark94">Schoedon</a> <a href="#_bookmark94" data-href="#_bookmark94">[2018</a>,] EIP-2384 by <a href="#_bookmark83" data-href="#_bookmark83">Conner [2019</a>,] EIP-3554 by <a href="#_bookmark102" data-href="#_bookmark102">Hancock</a> <a href="#_bookmark102" data-href="#_bookmark102">[2021</a>,] and EIP-4345 by <a href="#_bookmark71" data-href="#_bookmark71">Beiko et al. [2021a</a>] increased the <span id="_bookmark29 " class="anchor">#</span>#subtrahend _κ</em>.</p>
</div>
<div class="paragraph data-line-693">
<p>The canonical gas limit <em>H</em><sub>l</sub> of a block of header <em>H</em> must fulfil the relation:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-697">
<ol class="arabic" start="2">
<li class="data-line-697">
<p><em>Block Header Validity.</em> We define <em>P</em> (<em>B</em>H parent block of <em>B</em>, formally:</p>
</li>
</ol>
</div>
<div class="paragraph data-line-699">
<p>) to be the</p>
</div>
<div class="quoteblock data-line-701">
<blockquote>
<div class="paragraph data-line-702">
<p>(53)</p>
</div>
<div class="paragraph data-line-704">
<p><em>H</em><sub>l</sub> <em>&lt; P</em> (<em>H</em>)<sub>H</sub>l</p>
</div>
<div class="paragraph data-line-706">
<p>+ <em>P</em> (<em>H</em>)Hl</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-709">
<p>1024</p>
</div>
<div class="paragraph data-line-711">
<p>[<mark>_bookmark30 .anchor]</mark># _P_ (_H_)</p>
</div>
<div class="quoteblock data-line-713">
<blockquote>
<div class="paragraph data-line-714">
<p>The block number is the parent’s block number incre- mented by one:</p>
</div>
<div class="paragraph data-line-716">
<p>(44) <em>H</em>i <span id="<em>bookmark31 " class="anchor">#</span>#≡ _P</em> (<em>H</em>)Hi + 1</p>
</div>
<div class="paragraph data-line-718">
<p>The canonical difficulty of a block of header <em>H</em> is defined as <em>D</em>(<em>H</em>):</p>
</div>
<div class="paragraph data-line-720">
<p>(45)</p>
</div>
<div class="paragraph data-line-722">
<p><em>H</em><sub>l</sub> ;;: 5000</p>
</div>
<div class="paragraph data-line-724">
<p>[<mark><em>bookmark32 .anchor]</mark>#<em>H</em>s is the timestamp (in Unix’s time()) of block _H</em> and must fulfil the relation:</p>
</div>
<div class="paragraph data-line-726">
<p><em>D</em>(<em>H</em>) ≡</p>
</div>
<div class="paragraph data-line-728">
<p>where:</p>
</div>
<div class="paragraph data-line-730">
<p>max <em>D</em></p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-733">
<p>min</p>
</div>
<div class="paragraph data-line-735">
<p><em>, P</em> (<em>H</em>)Hd</p>
</div>
<div class="quoteblock data-line-737">
<blockquote>
<div class="paragraph data-line-738">
<p>+ <em>x</em> × <em>ς</em>2</p>
</div>
<div class="paragraph data-line-740">
<p>+ <em>E</em> otherwise</p>
</div>
<div class="paragraph data-line-742">
<p>(54) <em>H</em>s <em>&gt; P</em> (<em>H</em>)Hs</p>
</div>
<div class="paragraph data-line-744">
<p>(46)</p>
</div>
<div class="paragraph data-line-746">
<p>(47)</p>
</div>
<div class="paragraph data-line-748">
<p>(48)</p>
</div>
<div class="paragraph data-line-750">
<p><em>D</em>min ≡ 217</p>
</div>
<div class="paragraph data-line-752">
<p><em>x P</em> (<em>H</em>)Hd 2048</p>
</div>
<div class="paragraph data-line-754">
<p><em>ς</em>2 ≡ max (<em>y</em> −</p>
</div>
<div class="paragraph data-line-756">
<p>__H__s − _P_ (_H_)Hs</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-759">
<p><em>,</em> −99</p>
</div>
<div class="quoteblock data-line-761">
<blockquote>
<div class="paragraph data-line-762">
<p>This mechanism enforces a homeostasis in terms of the time between blocks; a smaller period between the last two blocks results in an increase in the difficulty level and thus additional computation required, lengthening the likely next period. Conversely, if the period is too large, the</p>
</div>
<div class="paragraph data-line-764">
<p>(49)</p>
</div>
<div class="paragraph data-line-766">
<p>(50)</p>
</div>
<div class="paragraph data-line-768">
<p>(51)</p>
</div>
<div class="paragraph data-line-770">
<p><em>y</em> 1 if ll<em>P</em> (<em>H</em>)<strong><sub>U</sub></strong>ll = 0</p>
</div>
<div class="paragraph data-line-772">
<p>2 otherwise</p>
</div>
<div class="paragraph data-line-774">
<p><em>E</em> ≡ 2l<em>H</em>i<em>t</em> ÷100000J−2</p>
</div>
<div class="paragraph data-line-776">
<p><em>H</em><sub>i</sub> ≡ max(<em>H</em><sub>i</sub> − <em>κ,</em> 0)</p>
</div>
<div class="paragraph data-line-778">
<p>difficulty, and <span id="_bookmark33 " class="anchor">#</span>#expected time to the next block, is reduced.</p>
</div>
<div class="paragraph data-line-780">
<p>The nonce, <a href="#_bookmark17" data-href="#_bookmark17"><em>H</em>n</a>, must satisfy the relations:</p>
</div>
<div class="paragraph data-line-782">
<p>2256</p>
</div>
<div class="paragraph data-line-784">
<p>5000000</p>
</div>
<div class="paragraph data-line-786">
<p>9000000</p>
</div>
<div class="paragraph data-line-788">
<p>9700000</p>
</div>
<div class="paragraph data-line-790">
<p>10700000 if <em>H</em>i</p>
</div>
<div class="paragraph data-line-792">
<p>;;: <em>F</em></p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-795">
<p>ArrowGlacier</p>
</div>
<div class="quoteblock data-line-797">
<blockquote>
<div class="paragraph data-line-798">
<p>∧ <em>m</em> = <em>H</em>m</p>
</div>
<div class="paragraph data-line-800">
<p><span id="_bookmark34 " class="anchor">#</span>#n<em>,</em> <strong>d</strong>).</p>
</div>
<div class="paragraph data-line-802">
<p>ock’s header <em>H</em>, but <em>without</em> the nonce and mix-hash components, <strong>d</strong> being the current DAG, a large data set needed to compute the mix-hash, and PoW</p>
</div>
<div class="paragraph data-line-804">
<p>The <em>Homestead</em> difficulty parameter, <em>ς</em>2, is used to affect</p>
</div>
<div class="paragraph data-line-806">
<p>a dynamic homeostasis of time between blocks, as the time between blocks varies, as discussed below, as implemented in EIP-2 by <a href="#<em>bookmark76" data-href="#<em>bookmark76">Buterin</a> <a href="#_bookmark76" data-href="#_bookmark76">[2015</a>.] In the Homestead release, the exponential difficulty symbol, _E</em> causes the difficulty to slowly increase (every 100,000 blocks) at an exponential rate, and thus increasing the block time difference, and putting time pressure on transitioning to proof-of-stake. This effect, known as the “difficulty bomb”, or “ice age”, was explained in EIP-649 by <a href="#_bookmark95" data-href="#_bookmark95">Schoedon and Buterin [2017</a>]</p>
</div>
<div class="paragraph data-line-808">
<p>and delayed and implemented earlier in EIP-2. <em>ς</em>2 was also modified in EIP-100 with the use of <em>x</em>, the adjustment factor above, and the denominator 9, in order to target the mean block time including uncle blocks by <a href="#_bookmark77" data-href="#_bookmark77">Buterin</a></p>
</div>
<div class="paragraph data-line-810">
<p>is the proof-of-work function (see section <a href="#11.5._Mining_Proof-of-Work" data-href="#11.5._Mining_Proof-of-Work">11.5):</a> this evalu-</p>
</div>
<div class="paragraph data-line-812">
<p>ates to an array with the first item being the mix-hash, to prove that a correct DAG has been used, and the second item being a pseudo-random number cryptographically dependent on <em>H</em> and <strong>d</strong>. Given an approximately uniform distribution in the range [0<em>,</em> 2<sup>64</sup>), the expected time to find a solution is proportional to the difficulty, <em>H</em><sub>d</sub>.</p>
</div>
<div class="paragraph data-line-814">
<p>This is the foundation of the security of the blockchain and is the fundamental reason why a malicious node can- not propagate newly created blocks that would otherwise overwrite (“rewrite”) history. Because the nonce must sat- isfy this requirement, and because its satisfaction depends on the contents of the block and in turn its composed transactions, creating new, valid, blocks is difficult and,</p>
</div>
<div class="paragraph data-line-816">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 8</p>
</div>
<div class="paragraph data-line-818">
<p>over time, requires approximately the total compute power <span id="_bookmark35 " class="anchor">#</span>#of the trustworthy portion of the mining peers.</p>
</div>
<div class="paragraph data-line-820">
<p>Thus we are able to define the block header validity function <em>V</em> (<em>H</em>):</p>
</div>
<div class="paragraph data-line-822">
<p>256</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-826">
<ol class="arabic" start="56">
<li class="data-line-826">
<p><em>V</em> (<em>H</em>) ≡ <em>n H</em> ∧ <em>m</em> = <em>H</em>m ∧</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-828">
<blockquote>
<div class="paragraph data-line-829">
<p><em>H</em><sub>d</sub> = <em>D</em>(<em>H</em>) ∧</p>
</div>
<div class="paragraph data-line-831">
<p><em>H</em><sub>g</sub> ≤ <em>H</em><sub>l</sub> ∧</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-835">
<ol class="arabic" start="6">
<li class="data-line-835">
<p>Transaction Execution</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-837">
<blockquote>
<div class="paragraph data-line-838">
<p>The execution of a transaction is the most complex part of the Ethereum protocol: it defines the state transition function <a href="#_bookmark0" data-href="#_bookmark0">Υ.</a> It is assumed that any transactions executed first pass the initial tests of intrinsic validity. These include:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-842">
<ol class="arabic">
<li class="data-line-842">
<p>The transaction is well-formed RLP, with no addi- tional trailing bytes;</p>
</li>
<li class="data-line-843">
<p>the transaction signature is valid;</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-845">
<blockquote>
<div class="paragraph data-line-846">
<p><em>H</em><sub>l</sub> <em>&lt; P</em> (<em>H</em>)<sub>H</sub>l</p>
</div>
<div class="paragraph data-line-848">
<p>+ <em>P</em> (<em>H</em>)Hl</p>
</div>
<div class="paragraph data-line-850">
<p>1024</p>
</div>
<div class="paragraph data-line-852">
<p><em>P</em> (<em>H</em>)Hl</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-856">
<ol class="arabic" start="3">
<li class="data-line-856">
<p></p>
<div class="quoteblock data-line-858">
<blockquote>
<div class="paragraph data-line-859">
<p>the <a href="#_bookmark40" data-href="#_bookmark40">transaction nonce</a> is valid (equivalent to the <a href="#_bookmark3" data-href="#_bookmark3">sender account’s current nonce);</a></p>
</div>
</blockquote>
</div>
</li>
<li class="data-line-861">
<p></p>
<div class="quoteblock data-line-863">
<blockquote>
<div class="paragraph data-line-864">
<p>the sender account has no contract code deployed</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-867">
<blockquote>
<div class="paragraph data-line-868">
<p><em>H</em><sub>l</sub> ;;: 5000 ∧</p>
</div>
<div class="paragraph data-line-870">
<p><em>H</em>s <em>&gt; P</em> (<em>H</em>)Hs ∧</p>
</div>
<div class="paragraph data-line-872">
<p><em>H</em>i = <em>P</em> (<em>H</em>)Hi + 1 ∧</p>
</div>
<div class="paragraph data-line-874">
<p>ll<em>H</em>xll ≤ 32</p>
</div>
<div class="paragraph data-line-876">
<p>where (<em>n, m</em>) = PoW(<em>H</em>n<em>, H</em>n<em>,</em> <strong>d</strong>)</p>
</div>
<div class="paragraph data-line-878">
<p>Noting additionally that <strong>extraData</strong> must be at most 32 bytes.</p>
</div>
<div class="paragraph data-line-880">
<p>5. Gas and Payment</p>
</div>
<div class="paragraph data-line-882">
<p>In order to avoid issues of network abuse and to sidestep the inevitable questions stemming from Turing complete- ness, all programmable computation in Ethereum is subject to fees. The fee schedule is specified in units of <em>gas</em> (see Ap- pendix <a href="#Appendix_G._Fee_Schedule" data-href="#Appendix_G._Fee_Schedule">G</a> for the fees associated with various computation). Thus any given fragment of programmable computation (this includes creating contracts, making message calls, utilising and accessing account storage and executing op- erations on the virtual machine) has a universally agreed cost in terms of gas.</p>
</div>
<div class="paragraph data-line-884">
<p>Every transaction has a specific amount of gas associ- ated with it: <strong>gasLimit</strong>. This is the amount of gas which is implicitly purchased from the sender’s account balance. The purchase happens at the according <strong>gasPrice</strong>, also specified in the transaction. The transaction is consid- ered invalid if the account balance cannot support such a purchase. It is named <strong>gasLimit</strong> since any unused gas at the end of the transaction is refunded (at the same rate of purchase) to the sender’s account. Gas does not exist outside of the execution of a transaction. Thus for accounts with trusted code associated, a relatively high gas limit may be set and left alone.</p>
</div>
<div class="paragraph data-line-886">
<p>In general, Ether used to purchase gas that is not re- funded is delivered to the <em>beneficiary</em> address, the address of an account typically under the control of the miner. Transactors are free to specify any <strong>gasPrice</strong> that they wish, however miners are free to ignore transactions as they choose. A higher gas price on a transaction will there- fore cost the sender more in terms of Ether and deliver a greater value to the miner and thus will more likely be selected for inclusion by more miners. Miners, in general, will choose to advertise the minimum gas price for which they will execute transactions and transactors will be free to canvas these prices in determining what gas price to offer. Since there will be a (weighted) distribution of min- imum acceptable gas prices, transactors will necessarily have a trade-off to make between lowering the gas price and maximising the chance that their transaction will be mined in a timely manner.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-890">
<ol class="arabic" start="5">
<li class="data-line-890">
<p>the gas limit is no smaller than the intrinsic gas,</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-892">
<blockquote>
<div class="paragraph data-line-893">
<p><em>g</em>0, used by the transaction; and</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-897">
<ol class="arabic" start="6">
<li class="data-line-897">
<p></p>
<div class="quoteblock data-line-899">
<blockquote>
<div class="paragraph data-line-900">
<p>the sender account balance contains at least the cost, <em>v</em>0, required in up-front payment.</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-903">
<blockquote>
<div class="paragraph data-line-904">
<p>Formally, we consider the function <a href="#<em>bookmark0" data-href="#<em>bookmark0">Υ,</a> with _T</em> being a transaction and <strong><em>σ</em></strong> the state:</p>
</div>
<div class="paragraph data-line-906">
<p>(57) <strong><em>σ</em></strong> = Υ(<em>*σ*, T</em> )</p>
</div>
<div class="paragraph data-line-908">
<p>Thus <strong><em>σ</em></strong> is the post-transactional state. We also define <a href="#_bookmark42" data-href="#_bookmark42">Υ<sup>g</sup></a> to evaluate to the amount of gas used in the execution of a transaction, <a href="#_bookmark42" data-href="#_bookmark42">Υ<strong><sup>l</sup></strong></a> to evaluate to the transaction’s accrued log items and <a href="#_bookmark42" data-href="#_bookmark42">Υ<sup>z</sup></a> to evaluate to the status code resulting from the transaction. These will be formally defined later.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-912">
<ol class="arabic">
<li class="data-line-912">
<p>[<mark>6.1.<em>Substate .anchor]</mark>#<strong>Substate.</strong> Throughout transaction execution, we ac- crue certain information that is acted upon immediately following the transaction. We call this the _accrued transac- tion substate</em>, or <em>accrued substate</em> for short, and represent it as <em>A</em>, which is a tuple:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-914">
<blockquote>
<div class="paragraph data-line-915">
<p>(58) <em>A</em> ≡ (<em>A</em>*<sub>s</sub><strong><em>, A</em></strong><sub>l</sub><strong><em>, A</em></strong><sub>t</sub><strong><em>, A</em><sub>r</sub><em>, A</em></strong><sub>a</sub><strong><em>, A</em></strong><sub>K</sub>*)</p>
</div>
<div class="paragraph data-line-917">
<p>The tuple contents include <em>A</em>*s*, the self-destruct set: a set of accounts that will be discarded following the trans- action’s completion. <span id="<em>bookmark38 " class="anchor">_A</em>*<sub>l</sub>* is the log series: this is a series of archived and indexable ‘checkpoints’ in VM code execution that allow for contract-calls to be easily tracked by onlook- ers external to the Ethereum world (such as decentralised application front-ends). <em>A</em>*t* is the set of touched accounts, of which the empty ones are deleted at the end of a transac- tion. [#_bookmark37 .anchor]</span><em>A</em>r is the refund balance, increased through using the</p>
</div>
<div class="paragraph data-line-919">
<p><a href="#_bookmark145" data-href="#_bookmark145">SSTORE</a> instruction in order to reset contract storage to</p>
</div>
<div class="paragraph data-line-921">
<p>zero from some non-zero value. Though not immediately refunded, it is allowed to partially offset the total execution costs. Finally, EIP-2929 by <a href="#<em>bookmark81" data-href="#<em>bookmark81">Buterin and Swende [2020a</a>] introduced [<mark>_bookmark39 .anchor]</mark>#_A</em>*a*, the set of accessed account addresses, and <em>A</em>*<sub>K</sub><strong>, the set of accessed storage keys (more accurately, each element of <em>A</em></strong><sub>K</sub>* is a tuple of a 20-byte account address and a 32-byte storage slot).</p>
</div>
<div class="paragraph data-line-923">
<p>We define the empty accrued substate <em>A</em><sup>0</sup> to have no self-destructs, no logs, no touched accounts, zero refund bal-</p>
</div>
<div class="paragraph data-line-925">
<p>ance, all precompiled contracts in the accessed addresses, and no accessed storage:</p>
</div>
<div class="paragraph data-line-927">
<p>(59) <em>A</em><sup>0</sup> ≡ (∅<em>,</em> ()<em>,</em> ∅<em>,</em> 0<em>, π,</em> ∅)</p>
</div>
<div class="paragraph data-line-929">
<p>where <em><a href="#_bookmark51" data-href="#_bookmark51">π</a></em> is the set of all precompiled addresses.</p>
</div>
<div class="paragraph data-line-931">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 9</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-935">
<ol class="arabic" start="2">
<li class="data-line-935">
<p><strong>Execution.</strong> We define intrinsic gas <em>g</em>0, the amount of gas this transaction requires to be paid prior to execution, as follows:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-937">
<blockquote>
<div class="paragraph data-line-938">
<p>accrued substate <em>A</em> and status code <em>z</em>: (66)</p>
</div>
<div class="paragraph data-line-940">
<p><strong></strong><a href="#<em>bookmark44" data-href="#<em>bookmark44">Λ</a>4(<strong>_σ</em></strong>0<em>, A</em><sup>∗</sup><em>, S</em>(<em>T</em> )<em>, S</em>(<em>T</em> )<em>, g,</em></p>
</div>
<div class="paragraph data-line-942">
<p><em>g</em>0 ≡</p>
</div>
<div class="paragraph data-line-944">
<p>f<a href="#<em>bookmark136" data-href="#<em>bookmark136"><em>G</em>txdatazero</a> if _i</em> = 0</p>
</div>
<div class="paragraph data-line-946">
<p><a href="#<em>bookmark47" data-href="#<em>bookmark47">Θ</a>4(<strong>_σ</em></strong>0<em>, A , S</em>(<em>T</em> )<em>, S</em>(<em>T</em> )<em>, T</em>t<em>,</em></p>
</div>
<div class="paragraph data-line-948">
<p> <em>T</em><sub>t</sub><em>, g, T</em><sub>p</sub><em>, T</em><sub>v</sub><em>, T</em><sub>v</sub><em>, T</em>*<sub>d</sub>*<em>,</em> 0<em>,</em> T) otherwise</p>
</div>
<div class="paragraph data-line-950">
<p><em>i</em>∈<em>T</em>*i*<em>,T</em>*d*</p>
</div>
<div class="paragraph data-line-952">
<p><a href="#_bookmark137" data-href="#_bookmark137"><em>G</em>txdatanonzero</a> otherwise</p>
</div>
<div class="paragraph data-line-954">
<p>where</p>
</div>
<div class="paragraph data-line-956">
<p>+ <a href="#_bookmark135" data-href="#_bookmark135"><em>G</em>txcreate</a> if <em>T</em>t = ∅</p>
</div>
<div class="paragraph data-line-958">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-960">
<p>(67)</p>
</div>
<div class="paragraph data-line-962">
<p>(68)</p>
</div>
<div class="paragraph data-line-964">
<p><em>A</em><sup>∗</sup> ≡ <em>A</em><sup>0</sup> except</p>
</div>
<div class="paragraph data-line-966">
<p><em>A</em><sup>∗</sup><strong><sub>a</sub></strong> ≡ <em>A</em><sup>0</sup> ∪ \{<em>S</em>(<em>T</em> )} ∪<sub><em>E</em>∈<em>T</em></sub></p>
</div>
<div class="paragraph data-line-968">
<p>\{<a href="#<em>bookmark9" data-href="#<em>bookmark9">_E</em></a>a}</p>
</div>
<div class="paragraph data-line-970">
<p>+ <a href="#_bookmark138" data-href="#_bookmark138"><em>G</em>transaction</a></p>
</div>
<div class="paragraph data-line-972">
<p><em>T</em>*A* −1</p>
</div>
<div class="paragraph data-line-974">
<p>(69)</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-977">
<p><strong>a</strong></p>
</div>
<div class="quoteblock data-line-979">
<blockquote>
<div class="paragraph data-line-980">
<p><em>A</em><sup>∗</sup><strong><sub>K</sub></strong> ≡ L</p>
</div>
<div class="paragraph data-line-982">
<p><strong>A</strong></p>
</div>
<div class="paragraph data-line-984">
<p>\{∀<em>i &lt;</em> ll<em>E</em><strong>s</strong>ll<em>, i</em> ∈ N : (<em>E</em>a<em>, E</em>*s*[<em>i</em>])}</p>
</div>
<div class="paragraph data-line-986">
<p>+</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-989">
<p><em>j</em>=0</p>
</div>
<div class="quoteblock data-line-991">
<blockquote>
<div class="paragraph data-line-992">
<p><em>G</em>accesslistaddress + ll<em>T</em>*A*<strong class="<em>j</em>">s</strong>ll<em>G</em>accessliststorage</p>
</div>
<div class="paragraph data-line-994">
<p><em>E</em>∈<em>T</em>*A*</p>
</div>
<div class="paragraph data-line-996">
<p>and <em>g</em> is the amount of gas remaining after deducting</p>
</div>
<div class="paragraph data-line-998">
<p>where <em>T</em>*<sub>i</sub><strong><em>, T</em></strong><sub>d</sub>* means the series of bytes of the transaction’s associated data and initialisation EVM-code, depending on whether the transaction is for contract-creation or message-</p>
</div>
<div class="paragraph data-line-1000">
<p>call. <em>G</em>txcreate is added if the transaction is contract- creating, but not if a result of EVM-code. <a href="#<em>bookmark132" data-href="#<em>bookmark132">_G</em><sub>accesslistaddress</sub></a> and <a href="#<em>bookmark133" data-href="#<em>bookmark133">_G</em><sub>accessliststorage</sub></a> are the costs of warming up account and storage access, respectively. <em>G</em> is fully defined in Ap-</p>
</div>
<div class="paragraph data-line-1002">
<p>pendix <a href="#Appendix_G._Fee_Schedule" data-href="#Appendix_G._Fee_Schedule">G.</a></p>
</div>
<div class="paragraph data-line-1004">
<p>The up-front cost <em>v</em>0 is calculated as:</p>
</div>
<div class="paragraph data-line-1006">
<p>(61) <em>v</em>0 ≡ <a href="#_bookmark6" data-href="#_bookmark6"><em>T</em>g</a><a href="#_bookmark5" data-href="#_bookmark5"><em>T</em>p</a> + <a href="#_bookmark7" data-href="#_bookmark7"><em>T</em>v</a></p>
</div>
<div class="paragraph data-line-1008">
<p>The validity is determined as:</p>
</div>
<div class="paragraph data-line-1010">
<p>the basic amount required to pay for the existence of the transaction:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1014">
<ol class="arabic" start="70">
<li class="data-line-1014">
<p><em>g</em> ≡ <em>T</em>g − <em>g</em>0</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1016">
<blockquote>
<div class="paragraph data-line-1017">
<p>Note we use <a href="#_bookmark47" data-href="#_bookmark47">Θ</a>4 and <a href="#_bookmark44" data-href="#_bookmark44">Λ</a>4 to denote the fact that only the first four components of the functions’ values are taken; the final represents the message-call’s output value (a byte array) and is unused in the context of transaction evalua-</p>
</div>
<div class="paragraph data-line-1019">
<p>tion.</p>
</div>
<div class="paragraph data-line-1021">
<p>After the message call or contract creation is processed, the refund counter has to be incremented for the accounts that were self-destructed throughout its invocation.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1025">
<ol class="arabic" start="71">
<li class="data-line-1025">
<p><em>A</em>r ≡ <em>A</em>r + <em>R</em>selfdestruct</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1027">
<blockquote>
<div class="paragraph data-line-1028">
<p><em>i</em>∈<em>A</em>*s*</p>
</div>
<div class="paragraph data-line-1030">
<p>(62) <em>S</em>(<em>T</em> ) = ∅</p>
</div>
<div class="paragraph data-line-1032">
<p>[<mark>_bookmark40 .anchor]</mark># ∧</p>
</div>
<div class="paragraph data-line-1034">
<p>Then the state is finalised by determining the amount</p>
</div>
<div class="paragraph data-line-1036">
<p><em>T</em>n = <strong><em>σ</em></strong>[<em>S</em>(<em>T</em> )]n ∧</p>
</div>
<div class="paragraph data-line-1038">
<p><em>g</em>0 <em>T</em>g ∧</p>
</div>
<div class="paragraph data-line-1040">
<p><em>v</em><sub>0</sub> <strong><em>σ</em></strong><sub class="<em>S</em>(<em>T</em> )">b</sub> ∧</p>
</div>
<div class="paragraph data-line-1042">
<p>allowance from the refund counter, to the sender at the original rate.</p>
</div>
<div class="paragraph data-line-1044">
<p><em>T</em><sub>g</sub> <em>B</em><sub>Hl</sub> − <a href="#<em>bookmark2" data-href="#<em>bookmark2"></em>.€<em></a>(_B</em>*<sub>R</sub>*)<sub>u</sub></p>
</div>
<div class="paragraph data-line-1046">
<p>Note the final condition; the sum of the transaction’s gas</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1050">
<ol class="arabic" start="72">
<li class="data-line-1050">
<p>_<br>
g_<sup>∗</sup> ≡ <em>g</em></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1053">
<blockquote>
<div class="paragraph data-line-1054">
<p>+ min</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1057">
<p><em>T</em>g − <em>g</em></p>
</div>
<div class="paragraph data-line-1059">
<p><em>, A</em><sub>r</sub></p>
</div>
<div class="quoteblock data-line-1061">
<blockquote>
<div class="paragraph data-line-1062">
<p>limit, <em>T</em>g, and the gas utilised in this block prior, given by</p>
</div>
<div class="paragraph data-line-1064">
<p><a href="#<em>bookmark2" data-href="#<em>bookmark2"></em>.€<em></a>(_B</em>*<sub>R</sub><strong>)<sub>u</sub>, must be no greater than the block’s *gasLimit</strong>, <em>B</em><sub>Hl</sub>. Also, with a slight abuse of notation, we assume that <strong><em>σ</em></strong><sub class="<em>S</em>(<em>T</em> )">c</sub> = KEC () , <strong><em>σ</em></strong><sub class="<em>S</em>(<em>T</em> )">n</sub> = 0, and <strong><em>σ</em></strong><sub class="<em>S</em>(<em>T</em> )">b</sub> = 0 if <strong><em>σ</em></strong>[<em>S</em>(<em>T</em> )] = ∅.</p>
</div>
<div class="paragraph data-line-1066">
<p>The execution of a valid transaction begins with an irrevocable change made to the state: the <a href="#<em>bookmark3" data-href="#<em>bookmark3">nonce of the</a> <a href="#_bookmark3" data-href="#_bookmark3">account of the sender,</a> _S</em>(<em>T</em> ), is incremented by one and the balance is reduced by part of the up-front cost, <em>T</em>g<em>T</em>p. The</p>
</div>
<div class="paragraph data-line-1068">
<p>The total refundable amount is the legitimately remain-</p>
</div>
<div class="paragraph data-line-1070">
<p>ing gas <em>g</em> , added to <a href="#<em>bookmark37" data-href="#<em>bookmark37"><em>A</em>r</a>, with the latter component being capped up to a maximum of half (rounded down) of the total amount used <em>T</em>g − _g</em> . Therefore, <em>g</em><sup>∗</sup> is the total gas that remains after the transaction has been executed.</p>
</div>
<div class="paragraph data-line-1072">
<p>The Ether for the gas is given to the miner, whose address is specified as the beneficiary of the present block</p>
</div>
<div class="paragraph data-line-1074">
<p><em>B</em>. So we define the pre-final state <strong><em>σ</em></strong><sup>∗</sup> in terms of the</p>
</div>
<div class="paragraph data-line-1076">
<p>provisional state <strong><em>σ</em></strong>P:</p>
</div>
<div class="paragraph data-line-1078">
<p>gas available for the proceeding computation, <em>g</em>, is defined</p>
</div>
<div class="paragraph data-line-1080">
<p>as <em>T</em>g − <em>g</em>0. The computation, whether contract creation</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1084">
<ol class="arabic" start="73">
<li class="data-line-1084">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1086">
<blockquote>
<div class="paragraph data-line-1087">
<p><strong><em>σ</em></strong>∗ ≡ <strong><em>σ</em></strong>P except</p>
</div>
<div class="paragraph data-line-1089">
<p>or a message call, results in an eventual state (which may legally be equivalent to the current state), the change to which is deterministic and never invalid: there can be no invalid transactions from this point.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1093">
<ol class="arabic" start="74">
<li class="data-line-1093">
<p></p>
</li>
<li class="data-line-1094">
<p></p>
</li>
<li class="data-line-1095">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1097">
<blockquote>
<div class="paragraph data-line-1098">
<p><strong><em>σ</em></strong><sup>∗</sup><sub class="<em>S</em>(<em>T</em> )">b</sub> ≡ <strong><em>σ</em></strong><sub>P</sub><sub class="<em>S</em>(<em>T</em> )">b</sub> + <em>g</em><sup>∗</sup><em>T</em><sub>p</sub></p>
</div>
<div class="paragraph data-line-1100">
<p><strong><em>σ</em></strong><sup>∗</sup><sub class="<em>m</em>">b</sub> ≡ <strong><em>σ</em></strong><sub>P</sub><sub class="<em>m</em>">b</sub> + (<em>T</em><sub>g</sub> − <em>g</em><sup>∗</sup>)<em>T</em><sub>p</sub> <em>m</em> ≡ <em>B</em><sub>Hc</sub></p>
</div>
<div class="paragraph data-line-1102">
<p>We define the checkpoint state <strong><em>σ</em></strong>0:</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1105">
<p>The final state, <strong><em>σ</em></strong> , is reached after deleting all accounts</p>
</div>
<div class="paragraph data-line-1107">
<p><span id="_bookmark41 " class="anchor">#</span>#that either appear in the self-destruct set or are touched</p>
</div>
<div class="quoteblock data-line-1109">
<blockquote>
<div class="paragraph data-line-1110">
<p>(63)</p>
</div>
<div class="paragraph data-line-1112">
<p>(64)</p>
</div>
<div class="paragraph data-line-1114">
<p><strong><em>σ</em></strong>0 ≡ <strong><em>σ</em></strong> except:</p>
</div>
<div class="paragraph data-line-1116">
<p><strong><em>σ</em></strong><sub>0</sub><sub class="<em>S</em>(<em>T</em> )">b</sub> ≡ <strong><em>σ</em></strong><sub class="<em>S</em>(<em>T</em> )">b</sub> − <em>T</em><sub>g</sub><em>T</em><sub>p</sub></p>
</div>
<div class="paragraph data-line-1118">
<p>and empty:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1122">
<ol class="arabic" start="77">
<li class="data-line-1122">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1124">
<blockquote>
<div class="paragraph data-line-1125">
<p><strong><em>σ</em></strong> ≡ <strong><em>σ</em></strong><sup>∗</sup> except</p>
</div>
<div class="paragraph data-line-1127">
<p>(65)</p>
</div>
<div class="paragraph data-line-1129">
<p><strong><em>σ</em></strong>0[<em>S</em>(<em>T</em> )]n ≡ <strong><em>σ</em></strong>[<em>S</em>(<em>T</em> )]n + 1</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1133">
<ol class="arabic" start="78">
<li class="data-line-1133">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1135">
<blockquote>
<div class="paragraph data-line-1136">
<p>∀<em>i</em> ∈ <em>A</em>*s* : <strong><em>σ</em></strong> [<em>i</em>] = ∅</p>
</div>
<div class="paragraph data-line-1138">
<p>Evaluating <strong><em>σ</em></strong>P</p>
</div>
<div class="paragraph data-line-1140">
<p>from <strong><em>σ</em></strong>0</p>
</div>
<div class="paragraph data-line-1142">
<p>depends on the transaction type;</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1146">
<ol class="arabic" start="79">
<li class="data-line-1146">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1148">
<blockquote>
<div class="paragraph data-line-1149">
<p>∀<em>i</em> ∈ <em>A</em>*t* : <strong><em>σ</em></strong> [<em>i</em>] = ∅ if DEAD(<strong><em>σ</em></strong>∗<em>, i</em>)</p>
</div>
<div class="paragraph data-line-1151">
<p>either contract creation or message call; we define the tuple of post-execution provisional state <strong><em>σ</em></strong>P, remaining gas <em>g</em> ,</p>
</div>
<div class="paragraph data-line-1153">
<p><span id="_bookmark42 " class="anchor">#</span>#And finally, we specify Υ<sup>g</sup>, the total gas used in this transaction Υ<strong><sup>l</sup></strong>, the logs created by this transaction and</p>
</div>
<div class="paragraph data-line-1155">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 10</p>
</div>
<div class="paragraph data-line-1157">
<p>Υ<sup>z</sup>, the status code of this transaction:</p>
</div>
<div class="paragraph data-line-1159">
<p>(90)</p>
</div>
<div class="paragraph data-line-1161">
<p><strong><em>σ</em></strong><sup>∗</sup>[<em>a</em>] = 1<em>, v</em> + <em>v ,</em> <a href="#<em>bookmark118" data-href="#<em>bookmark118">TRIE</a>(∅)</em>,_ KEC ()</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1165">
<ol class="arabic" start="80">
<li class="data-line-1165">
<p></p>
</li>
<li class="data-line-1166">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1168">
<blockquote>
<div class="paragraph data-line-1169">
<p>Υg(<em>*σ*, T</em> ) ≡ <em>T</em>g − <em>g</em>∗</p>
</div>
<div class="paragraph data-line-1171">
<p>Υ<strong><sup>l</sup></strong>(<em>*σ*, T</em> ) ≡ <a href="#<em>bookmark38" data-href="#<em>bookmark38">_A</em>*<sub>l</sub>*</a></p>
</div>
<div class="paragraph data-line-1173">
<p>(91)</p>
</div>
<div class="paragraph data-line-1175">
<p><strong><em>σ</em></strong><sup>∗</sup>[<em>s</em>] =</p>
</div>
<div class="paragraph data-line-1177">
<p>∅ if <strong><em>σ</em></strong>[<em>s</em>] = ∅ ∧ <em>v</em> = 0</p>
</div>
<div class="paragraph data-line-1179">
<p><strong>a</strong><sup>∗</sup> otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1183">
<ol class="arabic" start="82">
<li class="data-line-1183">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1185">
<blockquote>
<div class="paragraph data-line-1186">
<p>Υ<sup>z</sup>(<em>*σ*, T</em> ) ≡ <em>z</em></p>
</div>
<div class="paragraph data-line-1188">
<p>(92)</p>
</div>
<div class="paragraph data-line-1190">
<p><strong>a</strong><sup>∗</sup> ≡ (<strong><em>σ</em></strong><sub class="<em>s</em>">n</sub><em>, <strong>σ*</em><sub class="<em>s</em>">b</sub> − <em>v, *σ*</em>[<em>s</em>]</strong><sub>s</sub>*<em>, *σ*</em><sub class="<em>s</em>">c</sub>)</p>
</div>
<div class="paragraph data-line-1192">
<p>These are used to help define the <a href="#_bookmark21" data-href="#_bookmark21">transaction receipt</a> and are also used <a href="#_bookmark66" data-href="#_bookmark66">later</a> for state and nonce validation.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1196">
<ol class="arabic" start="6">
<li class="data-line-1196">
<p></p>
<div class="quoteblock data-line-1198">
<blockquote>
<div class="paragraph data-line-1199">
<p>Contract Creation</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-1202">
<blockquote>
<div class="paragraph data-line-1203">
<p>There are a number of intrinsic parameters used when creating an account: sender (<em>s</em>), original transactor<a href="#<em>bookmark46" data-href="#<em>bookmark46"><sup>4</sup></a> (_o</em>), available gas (<em>g</em>), gas price (<em>p</em>), endowment (<em>v</em>) together with an arbitrary length byte array, <strong>i</strong>, the initialisation EVM code, the present depth of the message-call/contract- creation stack (<em>e</em>), the salt for new account’s address (<em>ζ</em>) and finally the p[<mark><em>bookmark43 .anchor]</mark>###ermission to make modifications to the state (_w</em>). The salt <em>ζ</em> might be missing (<em>ζ</em> = ∅); formally,</p>
</div>
<div class="paragraph data-line-1205">
<p>(83) <em>ζ</em> ∈ B32 ∪ B0</p>
</div>
<div class="paragraph data-line-1207">
<p>where <em>v</em> is the account’s pre-existing value, in the event it was previously in existence:</p>
</div>
<div class="paragraph data-line-1209">
<p>(93) <em>v</em> 0 if <strong><em>σ</em></strong>[<em>a</em>] = ∅</p>
</div>
<div class="paragraph data-line-1211">
<p><strong><em>σ</em></strong><sub class="<em>a</em>">b</sub> otherwise</p>
</div>
<div class="paragraph data-line-1213">
<p>Finally, the account is initialised through the execution of the initialising EVM code <strong>i</strong> according to the execution model (see section <a href="#9.<em>Execution_Model" data-href="#9.<em>Execution_Model">9).</a> Code execution can effect several events that are not internal to the execution state: the account’s storage can be altered, further accounts can be created and further message calls can be made. As such, the code execution function <a href="#9.4._Execution_Overview" data-href="#9.4._Execution_Overview">Ξ</a> evaluates to a tuple of the resultant state <strong>_σ</em></strong><sup>∗∗</sup>, available gas remaining <em>g</em><sup>∗∗</sup>, the re- sultant accrued substate <em>A</em><sup>∗∗</sup> and the body code of the account <strong>o</strong>.</p>
</div>
<div class="paragraph data-line-1215">
<p>If the creation was caused by <a href="#<em>bookmark150" data-href="#<em>bookmark150">CREATE2</a>, then _ζ</em> ∅.</p>
</div>
<div class="paragraph data-line-1217">
<p><span id="<em>bookmark44 " class="anchor">#</span>#We define the creation function formally as the function Λ, which evaluates from these values, together with the state <strong>_σ</em></strong> and the accrued substate <em>A</em>, to the tuple containing the new state, remaining gas, new accrued substate, status code and output (<em>*σ* , g , A , z,</em> <strong>o</strong>):</p>
</div>
<div class="paragraph data-line-1219">
<p>(84) (<em>*σ* , g , A , z,</em> <strong>o</strong>) ≡ Λ(<em>*σ*, A, s, o, g, p, v,</em> *i*<em>, e, ζ, w</em>)</p>
</div>
<div class="paragraph data-line-1221">
<p>The address of the new account is defined as being the rightmost 160 bits of the Keccak-256 hash of the <a href="#<em>bookmark113" data-href="#<em>bookmark113">RLP</a> encoding of the structure containing only the sender and the <a href="#_bookmark3" data-href="#_bookmark3">account nonce.</a> For <a href="#_bookmark150" data-href="#_bookmark150">CREATE2</a> the rule is different and is described in EIP-1014 by <a href="#_bookmark82" data-href="#_bookmark82">Buterin</a> <a href="#_bookmark82" data-href="#_bookmark82">[2018</a>.] Combining the two cases, we define the resultant address for the new account _a</em>:</p>
</div>
<div class="paragraph data-line-1223">
<p>(94) (<strong><em>σ</em></strong><sup>∗∗</sup><em>, g</em><sup>∗∗</sup><em>, A</em><sup>∗∗</sup><em>,</em> <strong>o</strong>) ≡ Ξ(<strong><em>σ</em></strong><sup>∗</sup><em>, g, A</em><sup>∗</sup><em>, I</em>)</p>
</div>
<div class="paragraph data-line-1225">
<p>where <em>I</em> contains the parameters of the <a href="#9.3._Execution_Environment" data-href="#9.3._Execution_Environment">execution environ-</a> <a href="#9.3._Execution_Environment" data-href="#9.3._Execution_Environment">men</a>t, that is:</p>
</div>
<div class="paragraph data-line-1227">
<p>(85) <em>a</em> <span id="<em>bookmark45 " class="anchor">#</span>#≡ ADDR(_s, <strong>σ*</em>[<em>s</em>]n − 1<em>, ζ,</em> *i</strong>)</p>
</div>
<div class="paragraph data-line-1229">
<p>(86) ADDR(<em>s, n, ζ,</em> <strong>i</strong>) ≡ B96<em>..</em>255 KEC <em>L</em>A(<em>s, n, ζ,</em> <strong>i</strong>)</p>
</div>
<div class="paragraph data-line-1231">
<p><em>I</em>*<sub>d</sub>* evaluates to the empty tuple as there is no input data to this call. <em>I</em>H has no special treatment and is determined</p>
</div>
<div class="paragraph data-line-1233">
<p>(87)</p>
</div>
<div class="paragraph data-line-1235">
<p><em>L</em>A(<em>s, n, ζ,</em> <strong>i</strong>) ≡</p>
</div>
<div class="paragraph data-line-1237">
<p>RLP (<em>s, n</em>) if <em>ζ</em> = ∅</p>
</div>
<div class="paragraph data-line-1239">
<p>(255) · <em>s</em> · <em>ζ</em> · KEC(<strong>i</strong>) otherwise</p>
</div>
<div class="paragraph data-line-1241">
<p>from the blockchain.</p>
</div>
<div class="paragraph data-line-1243">
<p>Code execution depletes gas, and gas may not go below zero, thus execution may exit before the code has come</p>
</div>
<div class="paragraph data-line-1245">
<p>where · is the concatenation of byte arrays, B<em><sub>a..b</sub></em>(<em>X</em>) evalu- ates to a binary value containing the bits of indices in the range [<em>a, b</em>] of the binary data <em>X</em>, and <strong><em>σ</em></strong>[<em>x</em>] is the address state of <em>x</em>, or ∅ if none exists. Note we use one fewer than</p>
</div>
<div class="paragraph data-line-1247">
<p>the sender’s nonce value; we assert that we have incre- mented the sender account’s nonce prior to this call, and so the value used is the sender’s nonce at the beginning of the responsible transaction or VM operation.</p>
</div>
<div class="paragraph data-line-1249">
<p>The address of the new account is added to the set of accessed accounts:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1253">
<ol class="arabic" start="88">
<li class="data-line-1253">
<p><em>A</em><sup>∗</sup> ≡ <em>A</em> except <em>A</em><sup>∗</sup><strong><sub>a</sub></strong> ≡ <em>A</em>*<sub>a</sub>* ∪ \{<em>a</em>}</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1255">
<blockquote>
<div class="paragraph data-line-1256">
<p>The account’s nonce is initially defined as one, the bal- ance as the value passed, the storage as empty and the code hash as the Keccak 256-bit hash of the empty string; the sender’s balance is also reduced by the value passed. Thus the mutated state becomes <strong><em>σ</em></strong><sup>∗</sup>:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1260">
<ol class="arabic" start="89">
<li class="data-line-1260">
<p><strong><em>σ</em></strong><sup>∗</sup> ≡ <strong><em>σ</em></strong> except:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1262">
<blockquote>
<div class="paragraph data-line-1263">
<p>to a natural halting state. In this (and several other) ex- ceptional cases we say an out-of-gas (OOG) exception has occurred: The evaluated state is defined as being the empty set, ∅, and the entire create operation should have no effect on the state, effectively leaving it as it was immediately prior to attempting the creation.</p>
</div>
<div class="paragraph data-line-1265">
<p>If the initialization code completes successfully, a final contract-creation cost is paid, the code-deposit cost, <em>c</em>, proportional to the size of the created contract’s code:</p>
</div>
<div class="paragraph data-line-1267">
<p>(104) <em>c</em> ≡ <em>G</em><sub>codedeposit</sub> × ll<strong>o</strong>ll</p>
</div>
<div class="paragraph data-line-1269">
<p>If there is not enough gas remaining to pay this, i.e.</p>
</div>
<div class="paragraph data-line-1271">
<p><em>g</em><sup>∗∗</sup> <em>&lt; c</em>, then we also declare an out-of-gas exception.</p>
</div>
<div class="paragraph data-line-1273">
<p>The gas remaining will be zero in any such exceptional condition, i.e. if the creation was conducted as the recep- tion of a transaction, then this doesn’t affect payment of the intrinsic cost of contract creation; it is paid regardless. However, the value of the transaction is not transferred to the aborted contract’s address when we are out-of-gas.</p>
</div>
<div class="paragraph data-line-1275">
<p>4[<mark>_bookmark46 .anchor]</mark>###which can differ from the sender in the case of a message call or contract creation not directly triggered by a transaction but coming from the execution of EVM-code</p>
</div>
<div class="paragraph data-line-1277">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 11</p>
</div>
<div class="paragraph data-line-1279">
<p>If such an exception does not occur, then the remaining gas is refunded to the originator and the now-altered state is allowed to persist. Thus formally, we may specify the resultant state, gas, accrued substate and status code as (<em>*σ* , g , A , z</em>) where:</p>
</div>
<div class="paragraph data-line-1281">
<p>(105)</p>
</div>
<div class="paragraph data-line-1283">
<p><em>g</em> 0 if <em>F</em></p>
</div>
<div class="paragraph data-line-1285">
<p><em>g</em><sup>∗∗</sup> − <em>c</em> otherwise</p>
</div>
<div class="paragraph data-line-1287">
<p>(106)</p>
</div>
<div class="paragraph data-line-1289">
<p><strong><em>σ</em></strong> if <em>F</em> ∨ <strong><em>σ</em></strong><sup>∗∗</sup> = ∅</p>
</div>
<div class="paragraph data-line-1291">
<p><strong></strong><strong><em>σ</em></strong> except:</p>
</div>
<div class="paragraph data-line-1293">
<p>recipient (<em>r</em>), the account whose code is to be executed (<em>c</em>, usually the same as recipient), available gas (<em>g</em>), value (<em>v</em>) and gas price (<em>p</em>) together with an arbitrary length byte array, <strong>d</strong>, the input data of the call, the present depth of the message-call/contract-creation stack (<em>e</em>) and finally the permission to make modifications to the state (<em>w</em>).</p>
</div>
<div class="paragraph data-line-1295">
<p>Aside from evaluating to a new state and accrued transaction substate, message calls also have an extra component—the output data denoted by the byte array <strong>o</strong>. This is ignored when executing transactions, however mes- sage calls can be initiated due to VM-code execution and in this case this information is used.</p>
</div>
<div class="paragraph data-line-1297">
<p>(110)</p>
</div>
<div class="paragraph data-line-1299">
<p>(<strong><em>σ</em></strong> <em>, g</em> <em>, A</em> <em>, z,</em> <strong>o</strong>) ≡ <span id="<em>bookmark47 " class="anchor">#</span>#Θ(<em>*σ*, A, s, o, r, c, g, p, v, v</em>˜<em>,</em> *d*</em>, e, w_)</p>
</div>
<div class="paragraph data-line-1301">
<p><strong><em>σ</em></strong> ≡</p>
</div>
<div class="paragraph data-line-1303">
<p>(107)</p>
</div>
<div class="paragraph data-line-1305">
<p><strong><em>σ</em></strong> [<em>a</em>] = ∅ if DEAD(<strong><em>σ</em></strong><sup>∗∗</sup><em>, a</em>)</p>
</div>
<div class="paragraph data-line-1307">
<p><strong><em>σ</em></strong><sup>∗∗</sup> except:</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1310">
<p> <strong><em>σ</em></strong> [<em>a</em>]c = KEC(<strong>o</strong>) otherwise</p>
</div>
<div class="paragraph data-line-1312">
<p>Note that we need to differentiate between the value that</p>
</div>
<div class="quoteblock data-line-1314">
<blockquote>
<div class="paragraph data-line-1315">
<p>is to be transferred, <em>v</em>, from the value apparent in the execution context, <em>v</em>˜, for the DELEGATECALL instruction. We define <strong><em>σ</em></strong>1, the first transitional state as the orig- inal state but with the value transferred from sender to</p>
</div>
<div class="paragraph data-line-1317">
<p><em>A A</em><sup>∗</sup> if <em>F</em> ∨ <strong><em>σ</em></strong><sup>∗∗</sup> = ∅</p>
</div>
<div class="paragraph data-line-1319">
<p><em>A</em><sup>∗∗</sup> otherwise</p>
</div>
<div class="paragraph data-line-1321">
<p>(108)</p>
</div>
<div class="paragraph data-line-1323">
<p><em>z</em> 0 if <em>F</em> ∨ <strong><em>σ</em></strong><sup>∗∗</sup> = ∅</p>
</div>
<div class="paragraph data-line-1325">
<p>1 otherwise</p>
</div>
<div class="paragraph data-line-1327">
<p>where (109)</p>
</div>
<div class="paragraph data-line-1329">
<p><em>F</em> ≡ <strong><em>σ</em></strong>[<em>a</em>] = ∅ ∧ <strong><em>σ</em></strong><em class="_a_">c</em> = KEC () ∨ <strong><em>σ</em></strong><em class="_a_">n</em> = 0 ∨</p>
</div>
<div class="paragraph data-line-1331">
<p>(<strong><em>σ</em></strong><sup>∗∗</sup> = ∅ ∧ <strong>o</strong> = ∅) ∨</p>
</div>
<div class="paragraph data-line-1333">
<p><em>g</em><sup>∗∗</sup> <em>&lt; c</em> ∨</p>
</div>
<div class="paragraph data-line-1335">
<p>recipient:</p>
</div>
<div class="paragraph data-line-1337">
<p>(111) <strong><em>σ</em></strong><sub>1</sub><sub class="<em>r</em>">b</sub> ≡ <strong><em>σ</em></strong><sub class="<em>r</em>">b</sub> + <em>v</em> ∧ <strong><em>σ</em></strong><sub>1</sub><sub class="<em>s</em>">b</sub> ≡ <strong><em>σ</em></strong><sub class="<em>s</em>">b</sub> − <em>v</em></p>
</div>
<div class="paragraph data-line-1339">
<p>unless <em>s</em> = <em>r</em>.</p>
</div>
<div class="paragraph data-line-1341">
<p>Throughout the present work, it is assumed that if <strong><em>σ</em></strong>1[<em>r</em>] was originally undefined, it will be created as an account with no code or state and zero balance and nonce. Thus the previous equation should be taken to mean:</p>
</div>
<div class="paragraph data-line-1343">
<p>(112) <strong><em>σ</em></strong><sub>1</sub> ≡ <strong><em>σ</em></strong><sub>1</sub> except:</p>
</div>
<div class="paragraph data-line-1345">
<p>ll<strong>o</strong>ll <em>&gt;</em> 24576</p>
</div>
<div class="paragraph data-line-1347">
<p>[<mark><em>bookmark48 .anchor]</mark>#(113) <strong>_σ</em></strong>1[<em>s</em>] ≡ f∅</p>
</div>
<div class="paragraph data-line-1349">
<p>if <strong><em>σ</em></strong> <sub>1</sub>[<em>s</em>] = ∅</p>
</div>
<div class="paragraph data-line-1351">
<p>∧ <em>v</em> = 0</p>
</div>
<div class="paragraph data-line-1353">
<p>The exception in the determination of <strong><em>σ</em></strong> dictates that <strong>o</strong>, the resultant byte sequence from the execution of the initialisation code, specifies the final body code for the newly-created account.</p>
</div>
<div class="paragraph data-line-1355">
<p>Note that intention is that the result is either a suc- cessfully created new contract with its endowment, or no new contract with no transfer of value. In addition, ob-</p>
</div>
<div class="paragraph data-line-1357">
<p>serve that if the execution of the initialising code <a href="#<em>bookmark151" data-href="#<em>bookmark151">reverts</a> (<strong>_σ</em></strong><sup>∗∗</sup> = ∅ ∧ <strong>o</strong> = ∅), the resultant gas <em>g</em> is not depleted (provided there was no other exception), but no new ac-</p>
</div>
<div class="paragraph data-line-1359">
<p>count is created.</p>
</div>
<div class="paragraph data-line-1361">
<p>7.1. <strong>Subtleties.</strong> Note that while the initialisation code is executing, the newly created address exists but with no intrinsic body code<a href="#_bookmark49" data-href="#_bookmark49"><sup>5</sup></a>. Thus any message call received by it during this time causes no code to be executed. If the initialisation execution ends with a SELFDESTRUCT instruction, the matter is moot since the account will be deleted before the transaction is completed. For a normal STOP code, or if the code returned is otherwise empty, then the state is left with a zombie account, and any remaining balance will be locked into the account forever.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1365">
<ol class="arabic" start="6">
<li class="data-line-1365">
<p></p>
<div class="quoteblock data-line-1367">
<blockquote>
<div class="paragraph data-line-1368">
<p>Message Call</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-1371">
<blockquote>
<div class="paragraph data-line-1372">
<p>In the case of executing a message call, several param- eters are required: sender (<em>s</em>), transaction originator (<em>o</em>),</p>
</div>
<div class="paragraph data-line-1374">
<p><strong>a</strong>1 otherwise</p>
</div>
<div class="paragraph data-line-1376">
<p>(114) <strong>a</strong><sub>1</sub> ≡ <strong><em>σ</em></strong> <sub>1</sub><sub class="<em>s</em>">n</sub><em>, <strong>σ*</em> <sub>1</sub><sub class="<em>s</em>">b</sub> − <em>v, *σ*</em> <sub>1</sub>[<em>s</em>]</strong><sub>s</sub>*<em>, *σ*</em> <sub>1</sub><sub class="<em>s</em>">c</sub></p>
</div>
<div class="paragraph data-line-1378">
<p>(115) and <strong><em>σ</em></strong><sub>1</sub> ≡ <strong><em>σ</em></strong> except:</p>
</div>
<div class="paragraph data-line-1380">
<p>(116)</p>
</div>
<div class="paragraph data-line-1382">
<p><strong><em>σ</em></strong> <sub>1</sub>[<em>r</em>] ≡ (0<em>, v,</em> TRIE(∅)<em>,</em> KEC) if <strong><em>σ</em></strong>[<em>r</em>] = ∅ ∧ <em>v</em> = 0</p>
</div>
<div class="paragraph data-line-1384">
<p><strong><em>σ</em></strong> <sub>1</sub>[<em>r</em>] ≡ ∅ if <strong><em>σ</em></strong>[<em>r</em>] = ∅ ∧ <em>v</em> = 0</p>
</div>
<div class="paragraph data-line-1386">
<p><strong><em>σ</em></strong> <sub>1</sub>[<em>r</em>] ≡ <strong>a</strong> <sub>1</sub> otherwise</p>
</div>
<div class="paragraph data-line-1388">
<p>(117) <strong>a</strong> <sub>1</sub> ≡ (<strong><em>σ</em></strong><sub class="<em>r</em>">n</sub><em>, <strong>σ*</em><sub class="<em>r</em>">b</sub> + <em>v, *σ*</em>[<em>r</em>]</strong><sub>s</sub>*<em>, *σ*</em><sub class="<em>r</em>">c</sub>)</p>
</div>
<div class="paragraph data-line-1390">
<p>The account’s associated code (identified as the frag- ment whose Keccak-256 hash is <strong><em>σ</em></strong>[<em>c</em>]c) is executed according to the execution model (see section <a href="#9.<em>Execution_Model" data-href="#9.<em>Execution_Model">9).</a> Just as with con- tract creation, if the execution halts in an exceptional fashion (i.e. due to an exhausted gas supply, stack under- flow, invalid jump destination or invalid instruction), then no gas is refunded to the caller and the state is reverted to the point immediately prior to balance transfer (i.e. <strong>_σ</em></strong>).</p>
</div>
<div class="paragraph data-line-1392">
<p>5[<mark>_bookmark49 .anchor]</mark>###During initialization code execution, EXTCODESIZE on the address should return zero, which is the length of the code of the account while</p>
</div>
<div class="paragraph data-line-1394">
<p>CODESIZE should return the length of the initialization code (as defined in <a href="#H.2._Instruction_Set" data-href="#H.2._Instruction_Set">H.2).</a></p>
</div>
<div class="paragraph data-line-1396">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 12</p>
</div>
<div class="paragraph data-line-1398">
<p><span id="_bookmark50 " class="anchor">#</span>#where</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1402">
<ol class="arabic" start="131">
<li class="data-line-1402">
<p>Ξ ≡</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1404">
<blockquote>
<div class="paragraph data-line-1405">
<p>and</p>
</div>
<div class="paragraph data-line-1407">
<p><strong><em>σ σ</em></strong> if <strong><em>σ</em></strong><sup>∗∗</sup> = ∅</p>
</div>
<div class="paragraph data-line-1409">
<p><strong><em>σ</em></strong><sup>∗∗</sup> otherwise</p>
</div>
<div class="paragraph data-line-1411">
<p>0 if <strong><em>σ</em></strong><sup>∗∗</sup> = ∅ ∧</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1414">
<p><strong>o</strong> = ∅</p>
</div>
<div class="paragraph data-line-1416">
<p><em>g</em><sup>∗∗</sup> otherwise</p>
</div>
<div class="quoteblock data-line-1418">
<blockquote>
<div class="paragraph data-line-1419">
<p><em>A A</em> if <strong><em>σ</em></strong><sup>∗∗</sup> = ∅</p>
</div>
<div class="paragraph data-line-1421">
<p><em>A</em><sup>∗∗</sup> otherwise</p>
</div>
<div class="paragraph data-line-1423">
<p>f0 if <strong><em>σ</em></strong><sup>∗∗</sup> = ∅</p>
</div>
<div class="paragraph data-line-1425">
<p>ΞECREC(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 1 ΞSHA256(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 2 ΞRIP160(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 3 ΞID(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 4 ΞEXPMOD(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 5 ΞBN ADD(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 6 ΞBN MUL(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 7 ΞSNARKV(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 8 ΞBLAKE2 F(<strong><em>σ</em></strong>1<em>, g, A, I</em>) if <em>c</em> = 9</p>
</div>
<div class="paragraph data-line-1427">
<p>Ξ(<strong><em>σ</em></strong>1<em>, g, A, I</em>) otherwise</p>
</div>
<div class="paragraph data-line-1429">
<p>formal model of a virtual state machine, known as the Ethereum Virtual Machine (EVM). It is a <em>quasi-</em>Turing- complete machine; the <em>quasi</em> qualification comes from the fact that the computation is intrinsically bounded through a parameter, <em>gas</em>, which limits the total amount of compu- tation done.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1433">
<ol class="arabic">
<li class="data-line-1433">
<p><strong>Basics.</strong> The EVM is a simple stack-based architec- ture. The word size of the machine (and thus size of stack items) is 256-bit. This was chosen to facilitate the Keccak- 256 hash scheme and elliptic-curve computations. The memory model is a simple word-addressed byte array. The stack has a maximum size of 1024. The machine also has an independent storage model; this is similar in concept to the memory but rather than a byte array, it is a word- addressable word array. Unlike memory, which is volatile, storage is non volatile and is maintained as part of the system state. All locations in both storage and memory are well-defined initially as zero.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1435">
<blockquote>
<div class="paragraph data-line-1436">
<p>The machine does not follow the standard von Neu- mann architecture. Rather than storing program code in generally-accessible memory or storage, it is stored separately in a virtual ROM interactable only through a specialised instruction.</p>
</div>
<div class="paragraph data-line-1438">
<p>The machine can have exceptional execution for several reasons, including stack underflows and invalid instruc- tions. Like the out-of-gas exception, they do not leave state changes intact. Rather, the machine halts immedi- ately and reports the issue to the execution agent (either the transaction processor or, recursively, the spawning execution environment) which will deal with it separately.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1442">
<ol class="arabic" start="2">
<li class="data-line-1442">
<p><strong>Fees Overview.</strong> Fees (denominated in gas) are charged under three distinct circumstances, all three as prerequisite to the execution of an operation. The first and most common is the fee intrinsic to the computation of the operation (see Appendix <a href="#Appendix_G._Fee_Schedule" data-href="#Appendix_G._Fee_Schedule">G).</a> Secondly, gas may be deducted in order to form the payment for a subordinate</p>
</li>
</ol>
</div>
<div class="olist arabic data-line-1445">
<ol class="arabic" start="132">
<li class="data-line-1445">
<p>KEC(<em>I</em>*<sub>b</sub><strong>) = *<em>σ</em></strong><sub class="<em>c</em>">c</sub></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1447">
<blockquote>
<div class="paragraph data-line-1448">
<p>It is assumed that the client will have stored the pair (KEC(<em>I</em>*<sub>b</sub><strong>)<em>, I</em></strong><sub>b</sub><strong>) at some point prior in order to make the determination of <em>I</em></strong><sub>b</sub>* feasible.</p>
</div>
<div class="paragraph data-line-1450">
<p>As can be seen, there are nine exceptions to the usage of the general execution framework Ξ for evaluation of the message call: these are so-called ‘precompiled’ contracts, meant as a preliminary piece of architecture that may later become <em>native extensions</em>. The contracts in addresses 1 to 9 execute the elliptic curve public key recovery function, the SHA2 256-bit hash scheme, the RIPEMD 160-bit hash scheme, the identity function, arbitrary precision modular exponentiation, elliptic curve addition, elliptic curve scalar multiplication, an elliptic curve pairing check, and the BLAKE2 compression function F respectively. Their full formal definition is in Appendix <a href="#Appendix_E.<em>Precompiled_Contracts" data-href="#Appendix_E.<em>Precompiled_Contracts">E.</a> <span id="_bookmark51 " class="anchor">#</span>#We denote the set of the addresses of the precompiled contracts by _π</em>:</p>
</div>
<div class="paragraph data-line-1452">
<p>(133) <em>π</em> ≡ \{1<em>,</em> 2<em>,</em> 3<em>,</em> 4<em>,</em> 5<em>,</em> 6<em>,</em> 7<em>,</em> 8<em>,</em> 9}</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1456">
<ol class="arabic" start="6">
<li class="data-line-1456">
<p></p>
<div class="quoteblock data-line-1458">
<blockquote>
<div class="paragraph data-line-1459">
<p><span id="9" class="_Execution_Model  anchor">#</span>#Execution Model</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-1462">
<blockquote>
<div class="paragraph data-line-1463">
<p>The execution model specifies how the system state is altered given a series of bytecode instructions and a small tuple of environmental data. This is specified through a</p>
</div>
<div class="paragraph data-line-1465">
<p>message call or contract creation; this forms part of the payment for CREATE, CREATE2, CALL and CALLCODE. Finally, gas may be paid due to an increase in the usage of the memory.</p>
</div>
<div class="paragraph data-line-1467">
<p>Over an account’s execution, the total fee for memory- usage payable is proportional to smallest multiple of 32 bytes that are required such that all memory indices (whether for read or write) are included in the range. This is paid for on a just-in-time basis; as such, referencing an area of memory at least 32 bytes greater than any previ- ously indexed memory will certainly result in an additional memory usage fee. Due to this fee it is highly unlikely addresses will ever go above 32-bit bounds. That said, implementations must be able to manage this eventuality. Storage fees have a slightly nuanced behaviour—to in- centivise minimisation of the use of storage (which corre- sponds directly to a larger state database on all nodes), the execution fee for an operation that clears an entry in the storage is not only waived, a qualified refund is given; in fact, this refund is effectively paid up-front since the initial usage of a storage location costs substantially more</p>
</div>
<div class="paragraph data-line-1469">
<p>than normal usage.</p>
</div>
<div class="paragraph data-line-1471">
<p>See Appendix <a href="#Appendix_H._Virtual_Machine_Specificatio" data-href="#Appendix_H._Virtual_Machine_Specificatio">H</a> for a rigorous definition of the EVM gas cost.</p>
</div>
<div class="paragraph data-line-1473">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 13</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1477">
<ol class="arabic">
<li class="data-line-1477">
<p>[<mark>9.3.<em>Execution_Environment .anchor]</mark>#<strong>Execution Environment.</strong> In addition to the sys- tem state <strong>_σ</em></strong>, the remaining gas for computation <em>g</em>, and the accrued substate <em>A</em>, there are several pieces of important information used in the execution environment that the execution agent must provide; these are contained in the tuple <em>I</em>:</p>
<div class="ulist data-line-1478">
<ul>
<li class="data-line-1478">
<p><em>I</em>a, the address of the account which owns the code that is executing.</p>
</li>
<li class="data-line-1479">
<p><em>I</em>o, the sender address of the transaction that orig- inated this execution.</p>
</li>
<li class="data-line-1480">
<p><em>I</em>p, the price of gas in the transaction that origi- <span id="_bookmark54 " class="anchor">#</span>#nated this execution.</p>
</li>
<li class="data-line-1481">
<p><em>I</em>*<sub>d</sub>*, the byte array that is the input data to this execution; if the execution agent is a transaction,</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-1483">
<blockquote>
<div class="paragraph data-line-1484">
<p>should halt.</p>
</div>
<div class="paragraph data-line-1486">
<p>(135) Ξ(<em>*σ*, g, A, I</em>) ≡ (<em>*σ* , <strong>µ*</em>g<em>, A ,</em> *o</strong>)</p>
</div>
<div class="paragraph data-line-1488">
<p>(136) (<em>*σ* , <strong>µ</strong> , A , &#8230;&#8203;,</em> <strong>o</strong>) ≡ <em>X</em> (<em>*σ*, <strong>µ</strong>, A, I</em>)</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1492">
<colgroup>
<col style="width: 43%;">
<col style="width: 37%;">
<col style="width: 12%;">
<col style="width: 8%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
(137)
</em>_</em></th>
<th class="tableblock halign-left valign-top"><strong><em>µ</em></strong>g</th>
<th class="tableblock halign-left valign-top"><em><em>_
≡
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em>g</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(138)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>µ</em></strong>pc</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-1517">
<blockquote>
<div class="paragraph data-line-1518">
<p><span id="<em>bookmark55 " class="anchor">#</span># ∅<em>, <strong>µ</strong>, A, I,</em> ∅ if _Z</em>(<em>*σ*, <strong>µ</strong>, A, I</em>)</p>
</div>
<div class="paragraph data-line-1520">
<p>this would be the transaction data.</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-1523">
<ul>
<li class="data-line-1523">
<p><em>I</em>s, the address of the account which caused the</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-1525">
<blockquote>
<div class="paragraph data-line-1526">
<p><em>X</em> (<em>*σ*, <strong>µ</strong>, A, I</em>)</p>
</div>
<div class="paragraph data-line-1528">
<p>≡ <strong></strong> ∅<em>, <strong>µ*</em> <em>, A, I,</em> *o</strong> if <em>w</em> =</p>
</div>
<div class="paragraph data-line-1530">
<p>REVERT</p>
</div>
<div class="paragraph data-line-1532">
<p>code to be executing; if the execution agent is a transaction, this would be the transaction sender.</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-1535">
<ul>
<li class="data-line-1535">
<p><em>I</em>v, the value, in Wei, passed to this account as part of the same procedure as execution; if the</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-1537">
<blockquote>
<div class="paragraph data-line-1538">
<p>execution agent is a transaction, this would be the transaction value.</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-1541">
<ul>
<li class="data-line-1541">
<p><em>I</em>*<sub>b</sub>*, the byte array that is the machine code to be</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-1543">
<blockquote>
<div class="paragraph data-line-1544">
<p>executed.</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-1547">
<ul>
<li class="data-line-1547">
<p><em>I</em>H, the block header of the present block.</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-1549">
<blockquote>
<div class="paragraph data-line-1550">
<p>where (144)</p>
</div>
<div class="paragraph data-line-1552">
<p>(145)</p>
</div>
<div class="paragraph data-line-1554">
<p>(146)</p>
</div>
<div class="paragraph data-line-1556">
<p><em>O</em>(<em>*σ*, <strong>µ</strong>, A, I</em>) <strong>o</strong> if <strong>o</strong> = ∅</p>
</div>
<div class="paragraph data-line-1558">
<p><em>X O</em>(<em>*σ*, <strong>µ</strong>, A, I</em>) otherwise</p>
</div>
<div class="paragraph data-line-1560">
<p><strong>o</strong> ≡ <em>H</em>(<em>*µ*, I</em>)</p>
</div>
<div class="paragraph data-line-1562">
<p>(<em>a, b, c, d</em>) · <em>e</em> ≡ (<em>a, b, c, d, e</em>)</p>
</div>
<div class="paragraph data-line-1564">
<p><strong><em>µ</em></strong> ≡ <strong><em>µ</em></strong> except:</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-1567">
<ul>
<li class="data-line-1567">
<p><em>I</em>e, the depth of the present message-call or</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-1569">
<blockquote>
<div class="paragraph data-line-1570">
<p>contract-creation (i.e. the number of CALLs or</p>
</div>
<div class="paragraph data-line-1572">
<p>CREATE(2)s being executed at present).</p>
</div>
<div class="paragraph data-line-1574">
<p>(147)</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1577">
<p><strong><em>µ</em></strong>g</p>
</div>
<div class="quoteblock data-line-1579">
<blockquote>
<div class="paragraph data-line-1580">
<p>≡ <strong><em>µ</em></strong>g</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-1583">
<ul>
<li class="data-line-1583">
<p>_<br>
C_(<em>*σ*, <strong>µ</strong>, A, I</em>)</p>
<div class="ulist data-line-1585">
<ul>
<li class="data-line-1585">
<p><em>I</em>w, the permission to make modifications to the</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="quoteblock data-line-1587">
<blockquote>
<div class="paragraph data-line-1588">
<p>state.</p>
</div>
<div class="paragraph data-line-1590">
<p>The execution model defines the function Ξ, which can compute the resultant state <strong><em>σ</em></strong> , the remaining gas <em>g</em> , the resultant accrued substate <em>A</em> and the resultant output, <strong>o</strong>, given these definitions. For the present context, we will define it as:</p>
</div>
<div class="paragraph data-line-1592">
<p>(134) (<em>*σ* , g , A ,</em> <strong>o</strong>) ≡ Ξ(<em>*σ*, g, A, I</em>)</p>
</div>
<div class="paragraph data-line-1594">
<p>where we will remember that <em>A</em>, the accrued substate, is defined in section <a href="#6.1._Substate" data-href="#6.1._Substate">6.1.</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1598">
<ol class="arabic">
<li class="data-line-1598">
<p>[<mark>9.4.<em>Execution_Overview .anchor]</mark>#<strong>Execution Overview.</strong> We must now define the Ξ function. In most practical implementations this will be modelled as an iterative progression of the pair comprising the full system state, <strong>_σ</em></strong> and the machine state, <strong><em>µ</em></strong>. For- mally, we define it recursively with a function <em>X</em>. This uses an iterator function <em>O</em> (which defines the result of a</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1600">
<blockquote>
<div class="paragraph data-line-1601">
<p>Note that, when we evaluate Ξ, we drop the fourth</p>
</div>
<div class="paragraph data-line-1603">
<p>element <em>I</em> and extract the remaining gas <strong><em>µ</em></strong>g from the resultant machine state <strong><em>µ</em></strong> .</p>
</div>
<div class="paragraph data-line-1605">
<p><em>X</em> is thus cycled (recursively here, but implementations are generally expected to use a simple iterative loop) until either <em><a href="#_bookmark59" data-href="#_bookmark59">Z</a></em> becomes true indicating that the present state is exceptional and that the machine must be halted and any changes discarded or until <em><a href="#_bookmark60" data-href="#_bookmark60">H</a></em> becomes a series (rather than the empty set) indicating that the machine has reached a controlled halt.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1609">
<ol class="arabic">
<li class="data-line-1609">
<p><em>Machine State.</em> The machine state <strong><em>µ</em></strong> is defined as the tuple (<em>g, pc,</em> <strong>m*<em>, i,</em> *s</strong>) which are the gas available, the</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1611">
<blockquote>
<div class="paragraph data-line-1612">
<p>program counter <em>pc</em> ∈ N256 , the memory contents, the active number of words in memory (counting continuously</p>
</div>
<div class="paragraph data-line-1614">
<p>from position 0), and the stack contents. The memory contents <strong><em>µ</em></strong> are a series of zeroes of size 2<sup>256</sup>.</p>
</div>
<div class="paragraph data-line-1616">
<p>For the ease of reading, the instruction mnemonics,</p>
</div>
<div class="paragraph data-line-1618">
<p>written in small-caps (e.g. ADD), should be interpreted as their numeric equivalents; the full table of instructions and their specifics is given in Appendix <a href="#Appendix_H._Virtual_Machine_Specificatio" data-href="#Appendix_H._Virtual_Machine_Specificatio">H.</a></p>
</div>
<div class="paragraph data-line-1620">
<p>For the purposes of defining <em>Z</em>, <em>H</em> and <em>O</em>, we define <em>w</em></p>
</div>
<div class="paragraph data-line-1622">
<p>as the current operation to be executed:</p>
</div>
<div class="paragraph data-line-1624">
<p>single cycle of the state machine) together with functions</p>
</div>
<div class="paragraph data-line-1626">
<p><em><a href="#_bookmark59" data-href="#_bookmark59">Z</a></em> which determines if the present state is an <a href="#_bookmark59" data-href="#_bookmark59">exceptional</a></p>
</div>
<div class="paragraph data-line-1628">
<p>(148) <em>w</em> ≡</p>
</div>
<div class="paragraph data-line-1630">
<p>f<em>I</em>*<sub>b</sub>*[<strong><em>µ</em></strong>pc</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1633">
<p>] if <strong><em>µ</em></strong>pc</p>
</div>
<div class="quoteblock data-line-1635">
<blockquote>
<div class="paragraph data-line-1636">
<p><em>&lt;</em> ll<em>I</em><strong><sub>b</sub></strong>ll</p>
</div>
<div class="paragraph data-line-1638">
<p><a href="#<em>bookmark59" data-href="#<em>bookmark59">halting</a> state of the machine and <a href="#_bookmark60" data-href="#_bookmark60">_H</em></a>, specifying the output data of the instruction if and only if the present state is a <a href="#_bookmark60" data-href="#_bookmark60"><span id="_bookmark58 " class="anchor">#</span>#normal halting</a> state of the machine.</p>
</div>
<div class="paragraph data-line-1640">
<p>The empty sequence, denoted (), is not equal to the empty set, denoted ∅; this is important when interpreting the output of <em>H</em>, which evaluates to ∅ when execution is to continue but a series (potentially empty) when execution</p>
</div>
<div class="paragraph data-line-1642">
<p><a href="#_bookmark143" data-href="#_bookmark143">STOP</a> otherwise</p>
</div>
<div class="paragraph data-line-1644">
<p>We also assume the fixed amounts of <em>δ</em> and <em>α</em>, specifying the stack items removed and added, both subscriptable on the instruction and an instruction cost function <em>C</em> eval- uating to the full cost, in gas, of executing the given instruction.</p>
</div>
<div class="paragraph data-line-1646">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 14</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1650">
<ol class="arabic" start="2">
<li class="data-line-1650">
<p>[<mark><em>bookmark59 .anchor]</mark>#_Exceptional Halting.</em> The exceptional halting func- tion <em>Z</em> is defined as:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1652">
<blockquote>
<div class="paragraph data-line-1653">
<p>(149)</p>
</div>
<div class="paragraph data-line-1655">
<p><em>Z</em>(<em>*σ*, <strong>µ</strong>, A, I</em>) ≡ <em><strong>µ</strong>g &lt; C</em>(<em>*σ*, <strong>µ</strong>, A, I</em>) ∨</p>
</div>
<div class="paragraph data-line-1657">
<p><span id="<em>bookmark60 " class="anchor">#</span>#9.4.4. _Normal Halting.</em> The normal halting function <em>H</em> is defined:</p>
</div>
<div class="paragraph data-line-1659">
<p>(154)</p>
</div>
<div class="paragraph data-line-1661">
<p><em>H</em>RETURN(<strong><em>µ</em></strong>) if <em>w</em> ∈ \{<a href="#<em>bookmark149" data-href="#<em>bookmark149">RETURN</a></em>,_ REVERT}</p>
</div>
<div class="paragraph data-line-1663">
<p><em>δw</em> = ∅ ∨ ll<strong><em>µ</em><sub>s</sub></strong>ll <em>&lt; δw</em> ∨</p>
</div>
<div class="paragraph data-line-1665">
<p>(<em>w</em> = JUMP ∧ <strong><em>µ</em>s</strong>[0] ∈<em>/ D</em>(<em>I</em>*<sub>b</sub>*)) ∨</p>
</div>
<div class="paragraph data-line-1667">
<p><em>H</em>(<em>*µ*, I</em>) ≡</p>
</div>
<div class="paragraph data-line-1669">
<p>() if <em>w</em> ∈ \{<a href="#<em>bookmark143" data-href="#<em>bookmark143">STOP</a></em>,_ <a href="#_bookmark152" data-href="#_bookmark152">SELFDESTRUCT</a>}</p>
</div>
<div class="paragraph data-line-1671">
<p>∅ otherwise</p>
</div>
<div class="paragraph data-line-1673">
<p>where</p>
</div>
<div class="paragraph data-line-1675">
<p>(<em>w</em> = JUMPI ∧ <strong><em>µ</em>s</strong>[1] = 0 ∧</p>
</div>
<div class="paragraph data-line-1677">
<p><strong><em>µ</em>s</strong>[0] ∈<em>/ D</em>(<em>I</em>*<sub>b</sub>*)) ∨</p>
</div>
<div class="paragraph data-line-1679">
<p>(<em>w</em> = RETURNDATACOPY ∧</p>
</div>
<div class="paragraph data-line-1681">
<p><strong><em>µ</em>s</strong>[1] + <strong><em>µ</em>s</strong>[2] <em>&gt;</em> ll<strong><em>µ</em>o</strong>ll) ∨ ll<strong><em>µ</em><sub>s</sub></strong>ll − <em>δw</em> + <em>αw &gt;</em> 1024 ∨ (¬<em>I</em>w ∧ <em>W</em> (<em>w, *µ*</em>)) ∨</p>
</div>
<div class="paragraph data-line-1683">
<p>(<em>w</em> = SSTORE ∧ <em><strong>µ</strong>g G</em>callstipend)</p>
</div>
<div class="paragraph data-line-1685">
<p>The data-returning halt operations, <a href="#_bookmark149" data-href="#_bookmark149">RETURN</a> and REVERT, have a special function <em>H</em>RETURN. Note also the difference between the empty sequence and the empty set as discussed <a href="#_bookmark58" data-href="#_bookmark58">here.</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1689">
<ol class="arabic" start="2">
<li class="data-line-1689">
<p><strong>The Execution Cycle.</strong> Stack items are added or removed from the left-most, lower-indexed portion of the series; all other items remain unchanged:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1691">
<blockquote>
<div class="paragraph data-line-1692">
<p>(150) <em>W</em> (<em>w, *µ*</em>) ≡ <em>w</em> ∈ \{CREATE<em>,</em> CREATE2<em>,</em> SSTORE<em>,</em></p>
</div>
<div class="paragraph data-line-1694">
<p>SELFDESTRUCT} ∨</p>
</div>
<div class="paragraph data-line-1696">
<p>LOG0 ≤ <em>w</em> ∧ <em>w</em> ≤ LOG4 ∨</p>
</div>
<div class="paragraph data-line-1698">
<p><em>w</em> = CALL ∧ <strong><em>µ</em>s</strong>[2] = 0</p>
</div>
<div class="paragraph data-line-1700">
<p>(155)</p>
</div>
<div class="paragraph data-line-1702">
<p>(156)</p>
</div>
<div class="paragraph data-line-1704">
<p>(157)</p>
</div>
<div class="paragraph data-line-1706">
<p>(158)</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1709">
<p><em>O</em> (<em>*σ*, <strong>µ</strong>, A, I</em>) ≡ (<em>*σ* , <strong>µ</strong> , A , I</em>)</p>
</div>
<div class="quoteblock data-line-1711">
<blockquote>
<div class="paragraph data-line-1712">
<p>∆ ≡ <em>αw</em> − <em>δw</em></p>
</div>
<div class="paragraph data-line-1714">
<p>ll<strong><em>µ</em>s</strong>ll ≡ ll<strong><em>µ</em>s</strong>ll + ∆</p>
</div>
<div class="paragraph data-line-1716">
<p>∀<em>x</em> ∈ [<em>αw,</em> ll<strong><em>µ</em>s</strong>ll) : <strong><em>µ</em>s</strong>[<em>x</em>] ≡ <strong><em>µ</em><sub>s</sub></strong>[<em>x</em> − ∆]</p>
</div>
<div class="paragraph data-line-1718">
<p>This states that the execution is in an exceptional halt- ing state if there is insufficient gas, if the instruction is invalid (and therefore its <em>δ</em> subscript is undefined), if there are insufficient stack items, if a JUMP/JUMPI destination is invalid, the new stack size would be larger than 1024 or state modification is attempted during a static call. The as-</p>
</div>
<div class="paragraph data-line-1720">
<p>The gas is reduced by the instruction’s gas cost and for most instructions, the program counter increments on each cycle, for the three exceptions, we assume a function <em>J</em> , subscripted by one of two instructions, which evaluates to the according value:</p>
</div>
<div class="paragraph data-line-1722">
<p>tute reader will realise that this implies that no instruction</p>
</div>
<div class="paragraph data-line-1724">
<p>can, through its execution, cause an exceptional halt. Also, the execution is in an exceptional halting state if the gas</p>
</div>
<div class="paragraph data-line-1726">
<p>(159)</p>
</div>
<div class="paragraph data-line-1728">
<p><strong><em>µ</em></strong>g ≡ <strong><em>µ</em></strong>g − <em>C</em>(<em>*σ*, <strong>µ</strong>, A, I</em>)</p>
</div>
<div class="paragraph data-line-1730">
<p><a href="#<em>bookmark147" data-href="#<em>bookmark147"><em>J</em>JUMP</a>(<strong>_µ</em></strong>) if <em>w</em> = JUMP</p>
</div>
<div class="paragraph data-line-1732">
<p>left prior to executing an <a href="#<em>bookmark145" data-href="#<em>bookmark145">SSTORE</a> instruction is less than or equal to the call stipend <a href="#_bookmark134" data-href="#_bookmark134">_G</em><sub>callstipend</sub></a>. The last condition was introduced in EIP-1706 by <a href="#_bookmark96" data-href="#_bookmark96">Forshtat and Weiss [2019</a>]</p>
</div>
<div class="paragraph data-line-1734">
<p>(160)</p>
</div>
<div class="paragraph data-line-1736">
<p><strong><em>µ</em></strong>pc ≡</p>
</div>
<div class="paragraph data-line-1738">
<p><a href="#<em>bookmark148" data-href="#<em>bookmark148"><em>J</em>JUMPI</a>(<strong>_µ</em></strong>) if <em>w</em> = JUMPI</p>
</div>
<div class="paragraph data-line-1740">
<p><em>N</em> (<strong><em>µ</em></strong>pc<em>, w</em>) otherwise</p>
</div>
<div class="paragraph data-line-1742">
<p>(part of EIP-2200 by <a href="#_bookmark105" data-href="#_bookmark105">Tang</a> [<a href="#_bookmark105" data-href="#_bookmark105">2019</a>).]</p>
</div>
<div class="paragraph data-line-1744">
<p>In general, we assume the memory, accrued substate</p>
</div>
<div class="paragraph data-line-1746">
<p>and system state do not change:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1750">
<ol class="arabic" start="3">
<li class="data-line-1750">
<p><em>Jump Destination Validity.</em> We previously used <em>D</em> as the function to determine the set of valid jump desti- nations given the code that is being run. We define this as any position in the code occupied by a JUMPDEST instruction.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1752">
<blockquote>
<div class="paragraph data-line-1753">
<p>(161)</p>
</div>
<div class="paragraph data-line-1755">
<p>(162)</p>
</div>
<div class="paragraph data-line-1757">
<p>(163)</p>
</div>
<div class="paragraph data-line-1759">
<p>(164)</p>
</div>
<div class="paragraph data-line-1761">
<p><strong><em>µ</em>m</strong> ≡ <strong><em>µ</em>m <em>µ</em></strong>i ≡ <strong><em>µ</em></strong>i</p>
</div>
<div class="paragraph data-line-1763">
<p><em>A</em> ≡ <em>A</em></p>
</div>
<div class="paragraph data-line-1765">
<p><strong><em>σ</em></strong> ≡ <strong><em>σ</em></strong></p>
</div>
<div class="paragraph data-line-1767">
<p>All such positions must be on valid instruction bound- aries, rather than sitting in the data portion of PUSH operations and must appear within the explicitly defined portion of the code (rather than in the implicitly defined <a href="#_bookmark143" data-href="#_bookmark143">STOP</a> operations that trail it).</p>
</div>
<div class="paragraph data-line-1769">
<p>Formally:</p>
</div>
<div class="paragraph data-line-1771">
<p>(151) <em>D</em>(<strong>c</strong>) ≡ <em>D</em>J(*c*<em>,</em> 0) where:</p>
</div>
<div class="paragraph data-line-1773">
<p>(152)</p>
</div>
<div class="paragraph data-line-1775">
<p>\{} if <em>i</em> ;;: ll<strong>c</strong>ll</p>
</div>
<div class="paragraph data-line-1777">
<p><em>D</em> (<strong>c*<em>, i</em>) \{<em>i</em>} ∪ <em>D</em>J(*c*<em>, N</em> (<em>i,</em> *c</strong>[<em>i</em>]))</p>
</div>
<div class="paragraph data-line-1779">
<p>if <strong>c</strong>[<em>i</em>] = JUMPDEST</p>
</div>
<div class="paragraph data-line-1781">
<p><em>D</em>J(<strong>c*<em>, N</em> (<em>i,</em> *c</strong>[<em>i</em>])) otherwise</p>
</div>
<div class="paragraph data-line-1783">
<p>where <em>N</em> is the next valid instruction position in the code, skipping the data of a PUSH instruction, if any: (153)</p>
</div>
<div class="paragraph data-line-1785">
<p><em>i</em> + <em>w</em> − PUSH1 + 2</p>
</div>
<div class="paragraph data-line-1787">
<p>However, instructions do typically alter one or several components of these values. Altered components listed by instruction are noted in Appendix <a href="#Appendix_H.<em>Virtual_Machine_Specificatio" data-href="#Appendix_H.<em>Virtual_Machine_Specificatio">H,</a> alongside values for _α</em> and <em>δ</em> and a formal description of the gas requirements.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1791">
<ol class="arabic" start="6">
<li class="data-line-1791">
<p></p>
<div class="quoteblock data-line-1793">
<blockquote>
<div class="paragraph data-line-1794">
<p><span id="10" class="_Blocktree_to_Blockchain  anchor">#</span>#Blocktree to Blockchain</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-1797">
<blockquote>
<div class="paragraph data-line-1798">
<p>The canonical blockchain is a path from root to leaf through the entire block tree. In order to have consensus over which path it is, conceptually we identify the path that has had the most computation done upon it, or, the <em>heaviest</em> path. Clearly one factor that helps determine the heaviest path is the block number of the leaf, equivalent to the number of blocks, not counting the unmined <a href="#_bookmark153" data-href="#_bookmark153">genesis</a> <a href="#_bookmark153" data-href="#_bookmark153">block,</a> in the path. The longer the path, the greater the total mining effort that must have been done in order to arrive at the leaf. This is akin to existing schemes, such as that employed in Bitcoin-derived protocols.</p>
</div>
<div class="paragraph data-line-1800">
<p>Since a block header includes the difficulty, the header alone is enough to validate the computation done. Any</p>
</div>
<div class="paragraph data-line-1802">
<p><em>N</em> (<em>i, w</em>) ≡</p>
</div>
<div class="paragraph data-line-1804">
<p>if <em>w</em> [PUSH1<em>,</em> PUSH32]</p>
</div>
<div class="paragraph data-line-1806">
<p><em>i</em> + 1 otherwise</p>
</div>
<div class="paragraph data-line-1808">
<p>block contributes toward the total computation or <em>total difficulty</em> of a chain.</p>
</div>
<div class="paragraph data-line-1810">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 15</p>
</div>
<div class="paragraph data-line-1812">
<p>as:</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1815">
<p>Thus we define the total difficulty of block <em>B</em> recursively</p>
</div>
<div class="quoteblock data-line-1817">
<blockquote>
<div class="paragraph data-line-1818">
<p>If there are collisions of the beneficiary addresses be- tween ommers and the block (i.e. two ommers with the</p>
</div>
<div class="paragraph data-line-1820">
<p>(165)</p>
</div>
<div class="paragraph data-line-1822">
<p>(166)</p>
</div>
<div class="paragraph data-line-1824">
<p><em>B</em><sub>t</sub> ≡ <em>B</em><sub>t</sub> + <em>B</em><sub>d</sub> <em>B</em> ≡ <em>P</em> (<em>B</em>H)</p>
</div>
<div class="paragraph data-line-1826">
<p>same beneficiary address or an ommer with the same bene- ficiary address as the present block), additions are applied <span id="_bookmark62 " class="anchor">#</span>#cumulatively.</p>
</div>
<div class="paragraph data-line-1828">
<p>As such given a block <em>B</em>, <em>B</em>t is its total difficulty, <em>B</em> is its parent block and <em>B</em><sub>d</sub> is its difficulty.</p>
</div>
<div class="paragraph data-line-1830">
<p>We define the block reward in Wei: (176)</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1834">
<ol class="arabic" start="11">
<li class="data-line-1834">
<p><span id="11" class="_Block_Finalisation  anchor">#</span>#Block Finalisation</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1836">
<blockquote>
<div class="paragraph data-line-1837">
<p>The process of finalising a block involves four stages:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1841">
<ol class="arabic">
<li class="data-line-1841">
<p>Validate (or, if mining, determine) ommers;</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1843">
<blockquote>
<div class="paragraph data-line-1844">
<p><em>R</em>block = 1018 ×</p>
</div>
<div class="paragraph data-line-1846">
<p>5 if <em>H</em>i <em>&lt; F</em>Byzantium</p>
</div>
<div class="paragraph data-line-1848">
<p>3 if <em>F</em>Byzantium <em>H</em>i <em>&lt; F</em>Constantinople</p>
</div>
<div class="paragraph data-line-1850">
<p><span id="11" class="4 <em>State</em>&amp;_Nonce_Validation  anchor">#</span>#2 if <em>H</em>i ;;: <em>F</em>Constantinople</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1854">
<ol class="arabic" start="2">
<li class="data-line-1854">
<p>validate (or, if mining, determine) transactions;</p>
</li>
<li class="data-line-1855">
<p>apply rewards;</p>
</li>
<li class="data-line-1856">
<p>verify (or, if mining, compute a valid) state and <a href="#_bookmark17" data-href="#_bookmark17">block nonce.</a></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1858">
<blockquote>
<div class="paragraph data-line-1859">
<p>11.1. <strong>Ommer Validation.</strong> The validation of <a href="#_bookmark18" data-href="#_bookmark18">ommer</a> <a href="#_bookmark18" data-href="#_bookmark18">headers</a> means nothing more than verifying that each om- mer header is both a valid header and satisfies the relation</p>
</div>
<div class="paragraph data-line-1861">
<p>of <em>N</em> th-generation ommer to the present block where <em>N</em> ≤ 6.</p>
</div>
<div class="paragraph data-line-1863">
<p>The maximum of ommer headers is two. Formally:</p>
</div>
<div class="paragraph data-line-1865">
<p>11.4. <strong>State &amp; Nonce Validation.</strong> We may now define</p>
</div>
<div class="paragraph data-line-1867">
<p>the function, Γ, that maps a block <em>B</em> to its initiation state: (177)</p>
</div>
<div class="paragraph data-line-1869">
<p>Γ(<em>B</em>) <strong><em>σ</em></strong>0 if <em>P</em> (<em>B</em>H) = ∅</p>
</div>
<div class="paragraph data-line-1871">
<p><strong><em>σ</em></strong>i : <a href="#<em>bookmark118" data-href="#<em>bookmark118">TRIE</a>(<em>L</em>S(<strong>_σ</em></strong>i)) = <em>P</em> (<em>B</em>H)Hr otherwise</p>
</div>
<div class="paragraph data-line-1873">
<p>Here, TRIE(<em>L</em>S(<strong><em>σ</em></strong>i)) means the hash of the root node of a trie of state <strong><em>σ</em></strong>i; it is assumed that implementations will store this in the state database, which is trivial and efficient</p>
</div>
<div class="paragraph data-line-1875">
<p>since the trie is by nature an immutable data structure.</p>
</div>
<div class="paragraph data-line-1877">
<p>(167) ll<em>B</em>*<sub>U</sub>*</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1880">
<p>ll 2</p>
</div>
<div class="quoteblock data-line-1882">
<blockquote>
<div class="paragraph data-line-1883">
<p><strong>U</strong>∈<em>B</em>*U*</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1886">
<p><a href="#<em>bookmark35" data-href="#<em>bookmark35">_V</em> (<strong>U</strong></a>) ∧ <em>k</em>(<strong>U*<em>, P</em> (*B</strong></p>
</div>
<div class="paragraph data-line-1888">
<p><strong>H</strong>)<strong>H</strong></p>
</div>
<div class="paragraph data-line-1890">
<p><em>,</em> 6)</p>
</div>
<div class="quoteblock data-line-1892">
<blockquote>
<div class="paragraph data-line-1893">
<p>And finally we define Φ, the block transition function, which maps an incomplete block <em>B</em> to a complete block <em>B</em> :</p>
</div>
<div class="paragraph data-line-1895">
<p>where <em>k</em> denotes the “is-kin” property:</p>
</div>
<div class="paragraph data-line-1897">
<p>(168)</p>
</div>
<div class="paragraph data-line-1899">
<p>(178) Φ(<em>B</em>) ≡ <em>B</em> : <em>B</em> = <em>B</em><sup>∗</sup> except:</p>
</div>
<div class="paragraph data-line-1901">
<p><em>k</em>(<em>U, H, n</em>) ≡</p>
</div>
<div class="paragraph data-line-1903">
<p><em>false</em> if <em>n</em> = 0</p>
</div>
<div class="paragraph data-line-1905">
<p><em>s</em>(<em>U, H</em>)</p>
</div>
<div class="paragraph data-line-1907">
<p>(179)</p>
</div>
<div class="paragraph data-line-1909">
<p><em>B</em><sub>n</sub> = <em>n</em> : <em>x</em></p>
</div>
<div class="paragraph data-line-1911">
<p>2256</p>
</div>
<div class="paragraph data-line-1913">
<p><a href="#<em>bookmark31" data-href="#<em>bookmark31">_H</em><sub>d</sub></a></p>
</div>
<div class="paragraph data-line-1915">
<p> ∨ <em>k</em>(<em>U, P</em> (<em>H</em>)H<em>, n</em> − 1) otherwise</p>
</div>
<div class="paragraph data-line-1917">
<p>(180) <em>B</em><sub>m</sub> = <em>m</em> with (<em>x, m</em>) = PoW(<em>B_<a href="#_bookmark34" data-href="#_bookmark34">n∗</a> _, n,</em> <strong>d</strong>)</p>
</div>
<div class="paragraph data-line-1919">
<p>(169)</p>
</div>
<div class="paragraph data-line-1921">
<p><em>s</em>(<em>U, H</em>) ≡ (<em>P</em> (<em>H</em>) = <em>P</em> (<em>U</em> ) ∧ <em>H U</em> ∧ <em>U</em> ∈<em>/ B</em>(<em>H</em>)<strong><sub>U</sub></strong>)</p>
</div>
<div class="paragraph data-line-1923">
<p>where <em>B</em>(<em>H</em>) and <em>P</em> (<em>H</em>) are the block and the parent block of the corresponding header <em>H</em> respectively.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1927">
<ol class="arabic" start="2">
<li class="data-line-1927">
<p><strong>Transaction Validation.</strong> The given <strong>gasUsed</strong> must correspond faithfully to the transactions listed: <a href="#<em>bookmark14" data-href="#<em>bookmark14">_B</em><sub>Hg</sub></a>, the total gas used in the block, must be equal to the accumulated gas used according to the final transaction:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1929">
<blockquote>
<div class="paragraph data-line-1930">
<p>(170) <a href="#<em>bookmark14" data-href="#<em>bookmark14"><em>B</em>H</a>g = <a href="#_bookmark2" data-href="#_bookmark2"></em>.€_</a>(<a href="#_bookmark22" data-href="#_bookmark22"><strong>R</strong>)u</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-1934">
<ol class="arabic" start="3">
<li class="data-line-1934">
<p><strong>Reward Application.</strong> The application of rewards to a block involves raising the balance of the accounts of the beneficiary address of the block and each ommer by a certain amount. We raise the block’s beneficiary account by <a href="#<em>bookmark62" data-href="#<em>bookmark62">_R</em><sub>block</sub></a>; for each ommer, we raise the block’s beneficiary by an additional <sup>1</sup> of the block reward and the benefi- ciary of the ommer gets rewarded depending on the block numb[<mark>_bookmark65 .anchor]</mark>###er. Formally we define the function Ω:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-1936">
<blockquote>
<div class="paragraph data-line-1937">
<p>(171)</p>
</div>
<div class="paragraph data-line-1939">
<p>Ω(<em>B, <strong>σ*</em>) ≡ *<em>σ</em></strong> : <strong><em>σ</em></strong> = <strong><em>σ</em></strong> except:</p>
</div>
<div class="paragraph data-line-1941">
<p>With <strong>d</strong> being a dataset as specified in Appendix <a href="#Appendix_J._Ethash" data-href="#Appendix_J._Ethash">J.</a></p>
</div>
<div class="paragraph data-line-1943">
<p>As specified at the beginning of the present work, <a href="#_bookmark67" data-href="#_bookmark67">Π</a> is the state-transition function, which is defined in terms of <a href="#_bookmark65" data-href="#_bookmark65">Ω,</a> the block finalisation function and <a href="#_bookmark0" data-href="#_bookmark0">Υ,</a> the transaction- evaluation function, both now well-defined.</p>
</div>
<div class="paragraph data-line-1945">
<p>As previously detailed, <strong>R</strong><sub class="<em>n</em>">z</sub>, <strong>R</strong>[<em>n</em>]<strong><sub>l</sub></strong> and <strong>R</strong><sub class="<em>n</em>">u</sub> are the <em>n</em>th corresponding status code, logs and cumulative gas used after each transaction (<strong>R</strong><sub class="<em>n</em>">b</sub>, the fourth component in the tuple, has already been defined in terms of the logs). We also define the <em>n</em>th state <strong><em>σ</em></strong>[<em>n</em>], which is defined simply as the state resulting from applying the corresponding</p>
</div>
<div class="paragraph data-line-1947">
<p>transaction to the state resulting from the previous trans- action (or the block’s initial state in the case of the first such transaction):</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1950">
<p>(182) [<mark><em>bookmark66 .anchor]</mark>#<strong>_σ</em></strong>[<em>n</em>] = <a href="#11.4.<em>State</em>&amp;_Nonce_Validation" data-href="#11.4.<em>State</em>&amp;_Nonce_Validation">Γ(</a><em>B</em>) if <em>n &lt;</em> 0</p>
</div>
<div class="paragraph data-line-1952">
<p><a href="#<em>bookmark0" data-href="#<em>bookmark0">Υ(</a><strong>_σ</em></strong><em class="_n_ − 1">, B</em>*<sub>T</sub>*[<em>n</em>]) otherwise</p>
</div>
<div class="quoteblock data-line-1954">
<blockquote>
<div class="paragraph data-line-1955">
<p>In the case of <em>B</em>*<sub>R</sub>*<sub class="<em>n</em>">u</sub>, we take a similar approach defin- ing each item as the gas used in evaluating the correspond- ing transaction summed with the previous item (or zero, if it is the first), giving us a running total:</p>
</div>
<div class="paragraph data-line-1957">
<p>(172) <strong><em>σ</em></strong> [<strong>B</strong> ] = <strong><em>σ</em></strong>[<strong>B</strong> ] + (1 + ll<strong>BU</strong>ll <em>R</em></p>
</div>
<div class="paragraph data-line-1959">
<p>0 if <em>n &lt;</em> 0</p>
</div>
<div class="paragraph data-line-1961">
<p>(173)</p>
</div>
<div class="paragraph data-line-1963">
<p>∀<strong>U</strong> ∈ <strong>B<sub>U</sub></strong> :</p>
</div>
<div class="paragraph data-line-1965">
<p> +<strong>R</strong>[<em>n</em> − 1]u otherwise</p>
</div>
<div class="paragraph data-line-1967">
<p>f∅ if <strong><em>σ</em></strong>[<strong>U</strong> ] = ∅ ∧ <em>R</em> = 0</p>
</div>
<div class="paragraph data-line-1969">
<p>For <strong>R</strong>[<em>n</em>]<strong><sub>l</sub></strong>, we utilise the <a href="#_bookmark42" data-href="#_bookmark42">Υ</a> function that we conve-</p>
</div>
<div class="paragraph data-line-1971">
<p><strong><em>σ</em></strong> [<strong>U</strong>c] =</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1974">
<p>c</p>
</div>
<div class="quoteblock data-line-1976">
<blockquote>
<div class="paragraph data-line-1977">
<p><strong>a</strong> otherwise</p>
</div>
<div class="paragraph data-line-1979">
<p>niently defined in the transaction execution function.</p>
</div>
<div class="paragraph data-line-1981">
<p>(184) <strong>R</strong>[<em>n</em>]<strong><sub>l</sub></strong> = Υ<strong><sup>l</sup></strong>(<strong><em>σ</em></strong><em class="_n_ − 1">, B</em>*<sub>T</sub>*[<em>n</em>])</p>
</div>
<div class="paragraph data-line-1983">
<p>(174) <strong>a</strong> ≡ (<strong><em>σ</em></strong><sub class="<em>U</em>~c~">n</sub><em>, <strong>σ*</em><sub class="<em>U</em>~c~">b</sub> + <em>R, *σ*</em>[<em>U</em><sub>c</sub>]</strong><sub>s</sub>*<em>, *σ*</em><sub class="<em>U</em>~c~">c</sub>)</p>
</div>
<div class="paragraph data-line-1985">
<p>(175) <em>R</em> ≡ (1 + 1 (<em>U</em> − <em>B</em> ) <em>R</em></p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-1988">
<p>block</p>
</div>
<div class="quoteblock data-line-1990">
<blockquote>
<div class="paragraph data-line-1991">
<p>We define <a href="#<em>bookmark42" data-href="#<em>bookmark42"><strong>R</strong>[_n</em></a>z] in a similar manner.</p>
</div>
<div class="paragraph data-line-1993">
<p>(185) <strong>R</strong><sub class="<em>n</em>">z</sub> = Υ<sup>z</sup>(<strong><em>σ</em></strong><em class="_n_ − 1">, B</em>*<sub>T</sub>*[<em>n</em>])</p>
</div>
<div class="paragraph data-line-1995">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 16</p>
</div>
<div class="paragraph data-line-1997">
<p><span id="<em>bookmark67 " class="anchor">#</span>#Finally, we define Π as the new state given the block re- ward function <a href="#_bookmark65" data-href="#_bookmark65">Ω</a> applied to the final transaction’s resultant state, <a href="#_bookmark2" data-href="#_bookmark2"></em>.€<em></a>(<strong>_σ</em></strong>):</p>
</div>
<div class="paragraph data-line-1999">
<p>(186) Π(<em>*σ*, B</em>) ≡ Ω(<em>B, .€</em>(<strong><em>σ</em></strong>))</p>
</div>
<div class="paragraph data-line-2001">
<p>Thus the complete block-transition mechanism is de- fined, except for PoW, the proof-of-work function.</p>
</div>
<div class="paragraph data-line-2003">
<p><span id="11" class="5 <em>Mining_Proof-of-Work  anchor">#</span>#11.5. <strong>Mining Proof-of-Work.</strong> The mining proof-of- work (PoW) exists as a cryptographically secure nonce that proves beyond reasonable doubt that a particular amount of computation has been expended in the deter- mination of some token value _n</em>. It is utilised to enforce the blockchain security by giving meaning and credence to the notion of difficulty (and, by extension, total dif- ficulty). However, since mining new blocks comes with an attached reward, the proof-of-work not only functions as a method of securing confidence that the blockchain will remain canonical into the future, but also as a wealth distribution mechanism.</p>
</div>
<div class="paragraph data-line-2005">
<p>For both reasons, there are two important goals of the proof-of-work function; firstly, it should be as accessible as possible to as many people as possible. The requirement of, or reward from, specialised and uncommon hardware should be minimised. This makes the distribution model as open as possible, and, ideally, makes the act of mining a simple swap from electricity to Ether at roughly the same rate for anyone around the world.</p>
</div>
<div class="paragraph data-line-2007">
<p>Secondly, it should not be possible to make super-linear profits, and especially not so with a high initial barrier. Such a mechanism allows a well-funded adversary to gain a troublesome amount of the network’s total mining power and as such gives them a super-linear reward (thus skewing distribution in their favour) as well as reducing the network security.</p>
</div>
<div class="paragraph data-line-2009">
<p>One plague of the Bitcoin world is ASICs. These are specialised pieces of compute hardware that exist only to do a single task <a href="#_bookmark98" data-href="#_bookmark98">(Smith [1997</a>).] In Bitcoin’s case the task is the SHA256 hash function <a href="#_bookmark84" data-href="#_bookmark84">(Courtois et al. [2014</a>).] While ASICs exist for a proof-of-work function, both goals are placed in jeopardy. Because of this, a proof-of-work func- tion that is ASIC-resistant (i.e. difficult or economically inefficient to implement in specialised compute hardware) has been identified as the proverbial silver bullet.</p>
</div>
<div class="paragraph data-line-2011">
<p>Two directions exist for ASIC resistance; firstly make it sequential memory-hard, i.e. engineer the function such that the determination of the <a href="#_bookmark17" data-href="#_bookmark17">nonce</a> requires a lot of mem- ory and bandwidth such that the memory cannot be used in parallel to discover multiple nonces simultaneously. The second is to make the type of computation it would need to do general-purpose; the meaning of “specialised hardware” for a general-purpose task set is, naturally, general purpose hardware and as such commodity desktop computers are likely to be pretty close to “specialised hardware” for the task. For Ethereum 1.0 we have chosen the first path.</p>
</div>
<div class="paragraph data-line-2013">
<p>More formally, the proof-of-work function takes the form of PoW:</p>
</div>
<div class="paragraph data-line-2015">
<p>(187)</p>
</div>
<div class="paragraph data-line-2017">
<p>256</p>
</div>
<div class="paragraph data-line-2019">
<p><em>m</em> = <a href="#<em>bookmark16" data-href="#<em>bookmark16"><em>H</em>m</a> ∧ _n <a href="#_bookmark31" data-href="#_bookmark31">H</a></em> with (<em>m, n</em>) = PoW(link:#_bookmark34<em class="__H__n">, H</em>n<em>,</em> <strong>d</strong>)</p>
</div>
<div class="paragraph data-line-2021">
<p>Where <em>H</em>n is the new block’s header but <em>without</em> the nonce and mix-hash components; <em>H</em>n is the nonce of the header; <strong>d</strong> is a large data set needed to compute the mix- Hash and <em>H</em><sub>d</sub> is the new block’s difficulty value (i.e. the</p>
</div>
<div class="paragraph data-line-2023">
<p>block difficulty from section <a href="#10.<em>Blocktree_to_Blockchain" data-href="#10.<em>Blocktree_to_Blockchain">10).</a> PoW is the proof-of-work function which evaluates to an array with the first item being the mixHash and the second item being a pseudo- random number cryptographically dependent on _H</em> and <strong>d</strong>. The underlying algorithm is called Ethash and is described below.</p>
</div>
<div class="paragraph data-line-2025">
<p>11.5.1. <em>Ethash.</em> Ethash is the PoW algorithm for Ethereum</p>
</div>
<div class="paragraph data-line-2027">
<p>1.0. It is the latest version of Dagger-Hashimoto, intro- duced by <a href="#_bookmark78" data-href="#_bookmark78">Buterin</a> <a href="#_bookmark78" data-href="#_bookmark78">[2013b</a>] and <a href="#_bookmark90" data-href="#_bookmark90">Dryja</a> <a href="#_bookmark90" data-href="#_bookmark90">[2014</a>,] although it can no longer appropriately be called that since many of the original features of both algorithms were drastically changed with R&amp;D from February 2015 until May 4 2015 <a href="#_bookmark106" data-href="#_bookmark106">(Jentzsch</a> <a href="#_bookmark106" data-href="#_bookmark106">[2015</a>).] The general route that the algorithm takes is as follows:</p>
</div>
<div class="paragraph data-line-2029">
<p>There exists a seed which can be computed for each block by scanning through the block headers up until that point. From the seed, one can compute a pseudorandom cache, <a href="#<em>bookmark155" data-href="#<em>bookmark155">_J</em><sub>cacheinit</sub></a> bytes in initial size. Light clients store the cache. From the cache, we can generate a dataset, <a href="#<em>bookmark156" data-href="#<em>bookmark156">_J</em><sub>datasetinit</sub></a> bytes in initial size, with the property that each item in the dataset depends on only a small number of items from the cache. Full clients and miners store the dataset. The dataset grows linearly with time.</p>
</div>
<div class="paragraph data-line-2031">
<p>Mining involves grabbing random slices of the dataset and hashing them together. Verification can be done with low memory by using the cache to regenerate the specific pieces of the dataset that you need, so you only need to store the cache. The large dataset is updated once every</p>
</div>
<div class="paragraph data-line-2033">
<p><a href="#<em>bookmark157" data-href="#<em>bookmark157">_J</em><sub>epoch</sub></a> blocks, so the vast majority of a miner’s effort will be reading the dataset, not making changes to it. The</p>
</div>
<div class="paragraph data-line-2035">
<p>mentioned parameters as well as the algorithm is explained in detail in Appendix <a href="#Appendix_J._Ethash" data-href="#Appendix_J._Ethash">J.</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2039">
<ol class="arabic" start="12">
<li class="data-line-2039">
<p></p>
<div class="quoteblock data-line-2041">
<blockquote>
<div class="paragraph data-line-2042">
<p>Implementing Contracts</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-2045">
<blockquote>
<div class="paragraph data-line-2046">
<p>There are several patterns of contracts engineering that allow particular useful behaviours; two of these that we will briefly discuss are data feeds and random numbers.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2050">
<ol class="arabic">
<li class="data-line-2050">
<p><strong>Data Feeds.</strong> A data feed contract is one which pro- vides a single service: it gives access to information from the external world within Ethereum. The accuracy and timeliness of this information is not guaranteed and it is the task of a secondary contract author—the contract that utilises the data feed—to determine how much trust can be placed in any single data feed.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2052">
<blockquote>
<div class="paragraph data-line-2053">
<p>The general pattern involves a single contract within Ethereum which, when given a message call, replies with some timely information concerning an external phenome- non. An example might be the local temperature of New York City. This would be implemented as a contract that returned that value of some known point in storage. Of course this point in storage must be maintained with the correct such temperature, and thus the second part of the pattern would be for an external server to run an Ethereum node, and immediately on discovery of a new block, creates a new valid transaction, sent to the contract, updating said value in storage. The contract’s code would accept such updates only from the identity contained on said server.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2057">
<ol class="arabic" start="2">
<li class="data-line-2057">
<p><strong>Random Numbers.</strong> Providing random numbers within a deterministic system is, naturally, an impossible task. However, we can approximate with pseudo-random numbers by utilising data which is generally unknowable</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2059">
<blockquote>
<div class="paragraph data-line-2060">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 17</p>
</div>
<div class="paragraph data-line-2062">
<p>at the time of transacting. Such data might include the block’s hash, the block’s timestamp and the block’s benefi- ciary address. In order to make it hard for malicious miners to control those values, one should use the <a href="#_bookmark144" data-href="#_bookmark144">BLOCKHASH</a> operation in order to use hashes of the previous 256 blocks as pseudo-random numbers. For a series of such numbers, a trivial solution would be to add some constant amount and hashing the result.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2066">
<ol class="arabic" start="13">
<li class="data-line-2066">
<p></p>
<div class="quoteblock data-line-2068">
<blockquote>
<div class="paragraph data-line-2069">
<p>Future Directions</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-2072">
<blockquote>
<div class="paragraph data-line-2073">
<p>The state database won’t be forced to maintain all past state <a href="#_bookmark118" data-href="#_bookmark118">trie</a> structures into the future. It should maintain an age for each node and eventually discard nodes that are neither recent enough nor checkpoints. Checkpoints, or a set of nodes in the database that allow a particular block’s state trie to be traversed, could be used to place a maximum limit on the amount of computation needed in order to retrieve any state throughout the blockchain.</p>
</div>
<div class="paragraph data-line-2075">
<p>Blockchain consolidation could be used in order <span id="_bookmark70 " class="anchor"><mark>#to re- duce the amount of blocks a client would need to download to act as a full, mining, node. A compressed archive of the trie structure at given points in time (perhaps one in [#_bookmark69 .anchor]</span><mark>every 10,000th block) could be maintained by the peer network, effectively recasting the <a href="#_bookmark153" data-href="#_bookmark153">genesis block.</a> This would reduce the amount to be downloaded to a single archive [#_bookmark71 .anchor]</mark></mark>#plus a hard maximum limit of blocks.</p>
</div>
<div class="paragraph data-line-2077">
<p>Finally, blockchain compression could perhaps be con- ducted: nodes in state trie that haven’t sent/receiv[<mark>_bookmark72 .anchor]</mark>###ed a transaction in some constant amount of blocks could be thrown out, reducing both Ether-leakage and the growth of the state database.</p>
</div>
<div class="paragraph data-line-2079">
<p>13.1. <strong>Scalability.</strong> Scalability remains an eternal <span id="_bookmark75 " class="anchor"><mark>#concern. With a generalised state transition function, it becomes dif- ficult to partition and parallelise transactions to apply the divide-and-conquer strategy. Unaddressed, the [#_bookmark74 .anchor]</span><mark>dynamic value-range of the system remains essentially fixed and as the average transaction value increases, the less valuable of them become ignored, being economically pointless to in- clude in the main ledger. However, several strategies [#_bookmark73 .anchor]</mark></mark>#exist that may potentially be exploited to provide a considerably more scalable protocol.</p>
</div>
<div class="paragraph data-line-2081">
<p>Some form of hierarchical structure, achieved by either consolidating smaller lighter-weight chains into the <span id="_bookmark78 " class="anchor"><mark>#main block or building the main block through the incremen- tal combination and adhesion (through proof-of-work) of smaller transaction sets may allow parallelisation of [#_bookmark76 .anchor]</span><mark>trans- action combination and block-building. Parallelism could also come from a prioritised set of parallel blockc[#_bookmark77 .anchor]</mark></mark>#hains, consolidating each block and with duplicate or invalid transactions thrown out accordingly.</p>
</div>
<div class="paragraph data-line-2083">
<p>Finally, verifiable computation, if made generally a[<mark>_bookmark79 .anchor]</mark>###vail- able and efficient enough, may provide a route to allow the proof-of-work to be the verification of final state.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2087">
<ol class="arabic" start="14">
<li class="data-line-2087">
<p></p>
<div class="quoteblock data-line-2089">
<blockquote>
<div class="paragraph data-line-2090">
<p>Conclusion</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-2093">
<blockquote>
<div class="paragraph data-line-2094">
<p>We have introduced, discussed and formally defined<span id="_bookmark81 " class="anchor"><mark># [#_bookmark82 .anchor]</span><mark>the protocol of Ethereum. Through this protocol the reader may implement a node on the Ethereum network and [#_bookmark80 .anchor]</mark></mark>#join others in a decentralised secure social operating system. Contracts may be authored in order to algorithmically specify and autonomously enforce rules of interaction.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2098">
<ol class="arabic" start="15">
<li class="data-line-2098">
<p></p>
<div class="quoteblock data-line-2100">
<blockquote>
<div class="paragraph data-line-2101">
<p>Acknowledgements</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-2104">
<blockquote>
<div class="paragraph data-line-2105">
<p>Many thanks to Aeron Buchanan for authoring the <em>Homestead</em> revisions, Christoph Jentzsch for authoring the Ethash algorithm and Yoichi Hirai for doing most of the EIP-150 changes. Important maintenance, useful correc- tions and suggestions were provided by a number of others from the Ethereum DEV organisation and Ethereum com- munity at large including Gustav Simonsson, Pawelw Bylica, Jutta Steiner, Nick Savers, Viktor Tr´on, Marko Simovic, Giacomo Tazzari and, of course, Vitalik Buterin.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2109">
<ol class="arabic" start="16">
<li class="data-line-2109">
<p></p>
<div class="quoteblock data-line-2111">
<blockquote>
<div class="paragraph data-line-2112">
<p>Availability</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock data-line-2115">
<blockquote>
<div class="paragraph data-line-2116">
<p>The source of this paper is maintained at <a href="https://github.com/ethereum/yellowpaper/" data-href="https://github.com/ethereum/yellowpaper/">https:</a></p>
</div>
<div class="paragraph data-line-2118">
<p><a href="https://github.com/ethereum/yellowpaper/" data-href="https://github.com/ethereum/yellowpaper/">//github.com/ethereum/yellowpaper/</a>. An auto- generated PDF is located at <a href="https://ethereum.github.io/yellowpaper/paper.pdf" data-href="https://ethereum.github.io/yellowpaper/paper.pdf">https://ethereum.github.</a> <a href="https://ethereum.github.io/yellowpaper/paper.pdf" data-href="https://ethereum.github.io/yellowpaper/paper.pdf">io/yellowpaper/paper.pdf</a>.</p>
</div>
<div class="paragraph data-line-2120">
<p>References</p>
</div>
<div class="paragraph data-line-2122">
<p>Jacob Aron. BitCoin software finds new life. <em>New Scientist</em>, 213(2847):20, 2012. URL <a href="http://www.sciencedirect.com/science/article/pii/S0262407912601055" data-href="http://www.sciencedirect.com/science/article/pii/S0262407912601055">http://www.sciencedirect.</a> <a href="http://www.sciencedirect.com/science/article/pii/S0262407912601055" data-href="http://www.sciencedirect.com/science/article/pii/S0262407912601055">com/science/article/pii/S0262407912601055</a>.</p>
</div>
<div class="paragraph data-line-2124">
<p>Adam Back. Hashcash - Amortizable Publicly Auditable</p>
</div>
<div class="paragraph data-line-2126">
<p>Cost-Functions, 2002. URL <a href="http://www.hashcash.org/papers/amortizable.pdf" data-href="http://www.hashcash.org/papers/amortizable.pdf">http://www.hashcash.org/</a> <a href="http://www.hashcash.org/papers/amortizable.pdf" data-href="http://www.hashcash.org/papers/amortizable.pdf">papers/amortizable.pdf</a>.</p>
</div>
<div class="paragraph data-line-2128">
<p>Tim Beiko, James Hancock, and Thomas Jay Rush. EIP- 4345: Difficulty bomb delay to June 2022, October 2021a. URL <a href="https://eips.ethereum.org/EIPS/eip-4345" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-4345">https://eips.ethereum.org/EIPS/eip-4345</a>.</p>
</div>
<div class="paragraph data-line-2130">
<p>Tim Beiko et al. Berlin network upgrade specifica-</p>
</div>
<div class="paragraph data-line-2132">
<p>tion, 2021b. URL <a href="https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md" data-href="https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md">https://github.com/ethereum/</a> <a href="https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md" data-href="https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md">eth1.0-specs/blob/master/network-upgrades/</a> <a href="https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md" data-href="https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md">mainnet-upgrades/berlin.md</a>.</p>
</div>
<div class="paragraph data-line-2134">
<p>Guido Bertoni, Joan Daemen, Michal Peeters, and Gilles Van Assche. The KECCAK SHA-3 sub- mission, 2011. URL <a href="https://keccak.team/files/Keccak-submission-3.pdf" data-href="https://keccak.team/files/Keccak-submission-3.pdf">https://keccak.team/files/</a></p>
</div>
<div class="paragraph data-line-2136">
<p><a href="https://keccak.team/files/Keccak-submission-3.pdf" data-href="https://keccak.team/files/Keccak-submission-3.pdf">Keccak-submission-3.pdf</a>.</p>
</div>
<div class="paragraph data-line-2138">
<p>Roman Boutellier and Mareike Heinzen. Pirates, Pio- neers, Innovators and Imitators. In <em>Growth Through Innovation</em>, pages 85–96. Springer, 2014. URL <a href="https://www.springer.com/gb/book/9783319040158" data-href="https://www.springer.com/gb/book/9783319040158">https:</a></p>
</div>
<div class="paragraph data-line-2140">
<p><a href="https://www.springer.com/gb/book/9783319040158" data-href="https://www.springer.com/gb/book/9783319040158">//www.springer.com/gb/book/9783319040158</a>.</p>
</div>
<div class="paragraph data-line-2142">
<p>Vitalik Buterin. Ethereum: A Next-Generation Smart Contract and Decentralized Application Platform,</p>
</div>
<div class="paragraph data-line-2144">
<p>2013a. URL <a href="https://github.com/ethereum/wiki/wiki/White-Paper" data-href="https://github.com/ethereum/wiki/wiki/White-Paper">https://github.com/ethereum/wiki/</a> <a href="https://github.com/ethereum/wiki/wiki/White-Paper" data-href="https://github.com/ethereum/wiki/wiki/White-Paper">wiki/White-Paper</a>.</p>
</div>
<div class="paragraph data-line-2146">
<p>Vitalik Buterin. Dagger: A Memory-Hard to Compute, Memory-Easy to Verify Scrypt Alternative, 2013b. URL <a href="http://www.hashcash.org/papers/dagger.html" class="undefined" data-href="http://www.hashcash.org/papers/dagger.html">http://www.hashcash.org/papers/dagger.html</a>.</p>
</div>
<div class="paragraph data-line-2148">
<p>Vitalik Buterin. EIP-2: Homestead hard-fork changes,</p>
</div>
<div class="paragraph data-line-2150">
<p>2015. URL <a href="https://eips.ethereum.org/EIPS/eip-2" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-2">https://eips.ethereum.org/EIPS/eip-2</a>. Vitalik Buterin. EIP-100: Change difficulty adjustment to target mean block time including uncles, April 2016a.</p>
</div>
<div class="paragraph data-line-2152">
<p>URL <a href="https://eips.ethereum.org/EIPS/eip-100" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-100">https://eips.ethereum.org/EIPS/eip-100</a>. Vitalik Buterin. EIP-155: Simple replay attack protec-</p>
</div>
<div class="paragraph data-line-2154">
<p>tion, October 2016b. URL <a href="https://eips.ethereum.org/EIPS/eip-155" data-href="https://eips.ethereum.org/EIPS/eip-155">https://eips.ethereum.</a> <a href="https://eips.ethereum.org/EIPS/eip-155" data-href="https://eips.ethereum.org/EIPS/eip-155">org/EIPS/eip-155</a>.</p>
</div>
<div class="paragraph data-line-2156">
<p>Vitalik Buterin. EIP-1014: Skinny CREATE2, April 2018. URL <a href="https://eips.ethereum.org/EIPS/eip-1014" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-1014">https://eips.ethereum.org/EIPS/eip-1014</a>.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-2159">
<p>Vitalik Buterin and Martin Swende. EIP-2929: Gas cost in-</p>
</div>
<div class="paragraph data-line-2161">
<p>creases for state access opcodes, September 2020a. URL</p>
</div>
<div class="quoteblock data-line-2163">
<blockquote>
<div class="paragraph data-line-2164">
<p><a href="https://eips.ethereum.org/EIPS/eip-2929" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-2929">https://eips.ethereum.org/EIPS/eip-2929</a>.</p>
</div>
<div class="paragraph data-line-2166">
<p>Vitalik Buterin and Martin Swende. EIP-2930: Optional ac- cess lists, August 2020b. URL <a href="https://eips.ethereum.org/EIPS/eip-2930" data-href="https://eips.ethereum.org/EIPS/eip-2930">https://eips.ethereum.</a> <a href="https://eips.ethereum.org/EIPS/eip-2930" data-href="https://eips.ethereum.org/EIPS/eip-2930">org/EIPS/eip-2930</a>.</p>
</div>
<div class="paragraph data-line-2168">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 18</p>
</div>
<div class="paragraph data-line-2170">
<p><span id="_bookmark83 " class="anchor"><mark>#Eric Conner. EIP-2384: Muir Glacier difficulty b[#_bookmark85 .anchor]</span><mark>omb delay, November 2019. URL <a href="https://eips.ethereum.org/EIPS/eip-2384" data-href="https://eips.ethereum.org/EIPS/eip-2384">https://eips.ethereum.</a> <a href="https://eips.ethereum.org/EIPS/eip-2384" data-href="https://eips.ethereum.org/EIPS/eip-2384">[#_bookmark84 .anchor</a></mark></mark>#org/EIPS/eip-2384].</p>
</div>
<div class="paragraph data-line-2172">
<p>Nicolas T. Courtois, Marek Grajek, and Rahul <span id="_bookmark86 " class="anchor">#</span>#Naik.</p>
</div>
<div class="paragraph data-line-2174">
<p><em>Optimizing SHA256 in Bitcoin Mining</em>, pages 131–</p>
</div>
<div class="paragraph data-line-2176">
<p>144. Springer Berlin Heidelberg, Berlin, Heidel- berg, 2014. ISBN 978-3-662-44893-9. doi: 10. 1007/978-3-662-44893-9 12. URL <a href="https://doi.org/10.1007/978-3-662-44893-9_12" class="undefined" data-href="https://doi.org/10.1007/978-3-662-44893-9_12">https://doi.org/10.1007/978-3-662-44893-9_12</a><span class="[<mark>_bookmark87 .anchor"></mark>#https://doi.org/10.] <a href="https://doi.org/10.1007/978-3-662-44893-9_12" data-href="https://doi.org/10.1007/978-3-662-44893-9_12">[<mark>_bookmark88 .anchor</a></span></mark>#1007/978-3-662-44893-9_12].</p>
</div>
<div class="paragraph data-line-2178">
<p>B.A. Davey and H.A. Priestley. <em>Introduction to lattices and order. 2nd ed.</em> Cambridge: Cambridge Univ<span id="_bookmark89 " class="anchor"><mark>#ersity [#_bookmark90 .anchor]</span></mark>#Press, 2nd ed. edition, 2002. ISBN 0-521-78451-4/pbk. Thaddeus Dryja. Hashimoto: I/O bound proof of work, 2014. URL <a href="http://diyhpl.us/" class="undefined" data-href="http://diyhpl.us/">http://diyhpl.us/</a><sub>bryan/papers2/bitcoin/meh/hashimoto.pdf[<a href="http://diyhpl.us/" class="undefined" data-href="http://diyhpl.us/">http://diyhpl.us/</a></sub>bryan/papers2/]</p>
</div>
<div class="paragraph data-line-2180">
<p>bitcoin/meh/hashimoto.pdf.</p>
</div>
<div class="paragraph data-line-2182">
<p>Cynthia Dwork and Moni Naor. Pricing via <span id="<em>bookmark92 " class="anchor">#</span>#pro- cessing or combatting junk mail. In _In 12th An- nual International Cryptology Conference</em>, pages 139– 147, 1992. URL <a href="http://www.wisdom.weizmann.ac.il/~naor/PAPERS/pvp.pdf" data-href="http://www.wisdom.weizmann.ac.il/~naor/PAPERS/pvp.pdf">http://www.wisdom.weizmann.ac.il/</a></p>
</div>
<div class="paragraph data-line-2184">
<p>~naor/PAPERS/pvp.pdf.</p>
</div>
<div class="paragraph data-line-2186">
<p>Dankrad Feist, Dmitry Khovratovich, and Marius van <span id="_bookmark94 " class="anchor">#</span>#der</p>
</div>
<div class="paragraph data-line-2188">
<p>Wijden. EIP-3607: Reject transactions from senders with deployed code, June 2021. URL <a href="https://eips.ethereum.org/EIPS/eip-3607" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-3607">https://eips.ethereum.org/EIPS/eip-3607</a><span class="[<mark>_bookmark95 .anchor"></mark>#https://eips.] <a href="https://eips.ethereum.org/EIPS/eip-3607" data-href="https://eips.ethereum.org/EIPS/eip-3607">[<mark>_bookmark96 .anchor</a></span></mark>#ethereum.org/EIPS/eip-3607].</p>
</div>
<div class="paragraph data-line-2190">
<p>Alex Forshtat and Yoav Weiss. EIP-1706: Disable sstore</p>
</div>
<div class="paragraph data-line-2192">
<p>with gasleft lower than call stipend, 2019. URL <a href="https://eips.ethereum.org/EIPS/eip-1706" data-href="https://eips.ethereum.org/EIPS/eip-1706">https:</a></p>
</div>
<div class="paragraph data-line-2196">
<p>Phong Vo Glenn Fowler, Landon Curt Noll. Fo<span id="_bookmark98 " class="anchor"><mark>#wlerNol- lVo hash function, 1991. URL <a href="http://www.isthe.com/chongo/tech/comp/fnv/index.html" data-href="http://www.isthe.com/chongo/tech/comp/fnv/index.html">http://www.isthe.com/</a> <a href="http://www.isthe.com/chongo/tech/comp/fnv/index.html" data-href="http://www.isthe.com/chongo/tech/comp/fnv/index.html">[#_bookmark99 .anchor</a></span></mark>#chongo/tech/comp/fnv/index.html].</p>
</div>
<div class="paragraph data-line-2198">
<p>Nils Gura, Arun Patel, Arvinderpal Wander, Hans Eb[<mark>_bookmark100 .anchor]</mark>###erle,</p>
</div>
<div class="paragraph data-line-2200">
<p>and Sheueling Chang Shantz. Comparing elliptic curve cryptography and RSA on 8-bit CPUs. In <em>Cryptographic Hardware and Embedded Systems-CHES 2004</em>, <span id="_bookmark101 " class="anchor"><mark>#pages 119–132. Springer, 2004. URL <a href="https://www.iacr.org/archive/ches2004/31560117/31560117.pdf" data-href="https://www.iacr.org/archive/ches2004/31560117/31560117.pdf">https://www.iacr.org/</a> <a href="https://www.iacr.org/archive/ches2004/31560117/31560117.pdf" data-href="https://www.iacr.org/archive/ches2004/31560117/31560117.pdf">[#_bookmark102 .anchor</a></span></mark>#archive/ches2004/31560117/31560117.pdf].</p>
</div>
<div class="paragraph data-line-2202">
<p>James Hancock. EIP-3554: Difficulty bomb delay to De- cember 2021, May 2021. URL <a href="https://eips.ethereum.org/EIPS/eip-3554" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-3554">https://eips.ethereum.org/EIPS/eip-3554</a><span class="[<mark>_bookmark103 .anchor"></mark>#https://eips.ethereum.] <a href="https://eips.ethereum.org/EIPS/eip-3554" data-href="https://eips.ethereum.org/EIPS/eip-3554">[<mark>_bookmark104 .anchor</a></span></mark>#org/EIPS/eip-3554].</p>
</div>
<div class="paragraph data-line-2204">
<p>Tjaden Hess, Matt Luongo, Piotr Dyraga, and James</p>
</div>
<div class="paragraph data-line-2206">
<p>Hancock. EIP-152: Add BLAKE2 compression func- tion ‘F‘ precompile, October 2016. URL <a href="https://eips.ethereum.org/EIPS/eip-152" class="undefined" data-href="https://eips.ethereum.org/EIPS/eip-152">https://eips.ethereum.org/EIPS/eip-152</a><span class="[<mark>_bookmark105 .anchor"></mark>#https://eips.] <a href="https://eips.ethereum.org/EIPS/eip-152" data-href="https://eips.ethereum.org/EIPS/eip-152">[<mark>_bookmark106 .anchor</a></span></mark>#ethereum.org/EIPS/eip-152].</p>
</div>
<div class="paragraph data-line-2208">
<p>Christoph Jentzsch. Commit date for ethash, 2015. URL</p>
</div>
<div class="paragraph data-line-2210">
<p><a href="https://github.com/ethereum/yellowpaper/commit/" class="undefined" data-href="https://github.com/ethereum/yellowpaper/commit/">https://github.com/ethereum/yellowpaper/commit/</a> <a href="https://github.com/ethereum/yellowpaper/commit/77a8cf2428ce245bf6e2c39c5e652ba58a278666#commitcomment-24644869" data-href="https://github.com/ethereum/yellowpaper/commit/77a8cf2428ce245bf6e2c39c5e652ba58a278666#commitcomment-24644869">77a8cf2428ce245bf6e2c39c5e652ba58a278666#</a> <a href="https://github.com/ethereum/yellowpaper/commit/77a8cf2428ce245bf6e2c39c5e652ba58a278666#commitcomment-24644869" data-href="https://github.com/ethereum/yellowpaper/commit/77a8cf2428ce245bf6e2c39c5e652ba58a278666#commitcomment-24644869"><span id="_bookmark108 " class="anchor">#</span>#commitcomment-24644869</a>.</p>
</div>
<div class="paragraph data-line-2212">
<p>Don Johnson, Alfred Menezes, and Scott Van- stone. The Elliptic Curve Digital <span id="_bookmark109 " class="anchor">#</span>#Signa- ture Algorithm (ECDSA), 2001. URL https:</p>
</div>
<div class="paragraph data-line-2216">
<p>cs.ucsb.edu/~koc/ccs130h/notes/ecdsa-<span id="_bookmark110 " class="anchor">#</span>#cert.pdf. Accessed 21 September 2017, but the original link was</p>
</div>
<div class="paragraph data-line-2218">
<p>inaccessible on 19 October 2017. Refer to section 6.2 for ECDSAPUBKEY, and section 7 for ECDSASIGN and</p>
</div>
<div class="paragraph data-line-2220">
<p>ECDSARECOVER.</p>
</div>
<div class="paragraph data-line-2222">
<p>Sergio Demian Lerner. Strict Memory Hard Hashing Func- tions, 2014. URL <a href="http://www.hashcash.org/papers/memohash.pdf" data-href="http://www.hashcash.org/papers/memohash.pdf">http://www.hashcash.org/papers/</a> <a href="http://www.hashcash.org/papers/memohash.pdf" data-href="http://www.hashcash.org/papers/memohash.pdf">memohash.pdf</a>.</p>
</div>
<div class="paragraph data-line-2224">
<p>Mark Miller. The Future of Law. In <em>pa-</em></p>
</div>
<div class="paragraph data-line-2226">
<p><em>per delivered at the Extro 3 Conference (August 9)</em>, 1997. URL <a href="https://drive.google.com/file/d/0Bw0VXJKBgYPMS0J2VGIyWWlocms/edit?usp=sharing" data-href="https://drive.google.com/file/d/0Bw0VXJKBgYPMS0J2VGIyWWlocms/edit?usp=sharing">https://drive.google.com/file/d/</a> <a href="https://drive.google.com/file/d/0Bw0VXJKBgYPMS0J2VGIyWWlocms/edit?usp=sharing" data-href="https://drive.google.com/file/d/0Bw0VXJKBgYPMS0J2VGIyWWlocms/edit?usp=sharing">0Bw0VXJKBgYPMS0J2VGIyWWlocms/edit?usp=sharing</a>.</p>
</div>
<div class="paragraph data-line-2228">
<p>Satoshi Nakamoto. Bitcoin: A peer-to-peer electronic cash</p>
</div>
<div class="paragraph data-line-2230">
<p>system, 2008. URL <a href="http://www.bitcoin.org/bitcoin.pdf" data-href="http://www.bitcoin.org/bitcoin.pdf">http://www.bitcoin.org/bitcoin.</a> <a href="http://www.bitcoin.org/bitcoin.pdf" data-href="http://www.bitcoin.org/bitcoin.pdf">pdf</a>.</p>
</div>
<div class="paragraph data-line-2232">
<p>Meni Rosenfeld, Yoni Assia, Vitalik Buterin, m li- orhakiLior, Oded Leiba, Assaf Shomer, and Eli- ran Zach. Colored Coins Protocol Specification, 2012. URL <a href="https://github.com/Colored-Coins/Colored-Coins-Protocol-Specification" data-href="https://github.com/Colored-Coins/Colored-Coins-Protocol-Specification">https://github.com/Colored-Coins/</a></p>
</div>
<div class="paragraph data-line-2234">
<p><a href="https://github.com/Colored-Coins/Colored-Coins-Protocol-Specification" data-href="https://github.com/Colored-Coins/Colored-Coins-Protocol-Specification">Colored-Coins-Protocol-Specification</a>.</p>
</div>
<div class="paragraph data-line-2236">
<p>Markku-Juhani Saarinen and Jean-Philippe Aumasson. RFC 7693: The BLAKE2 cryptographic hash and mes- sage authentication code (MAC), November 2015. URL <a href="https://tools.ietf.org/html/rfc7693" class="undefined" data-href="https://tools.ietf.org/html/rfc7693">https://tools.ietf.org/html/rfc7693</a>.</p>
</div>
<div class="paragraph data-line-2238">
<p>Afri Schoedon. EIP-1234: Constantinople difficulty bomb</p>
</div>
<div class="paragraph data-line-2240">
<p>delay and block reward adjustment, 2018. URL <a href="https://eips.ethereum.org/EIPS/eip-1234" data-href="https://eips.ethereum.org/EIPS/eip-1234">https:</a></p>
</div>
<div class="paragraph data-line-2242">
<p><a href="https://eips.ethereum.org/EIPS/eip-1234" data-href="https://eips.ethereum.org/EIPS/eip-1234">//eips.ethereum.org/EIPS/eip-1234</a>.</p>
</div>
<div class="paragraph data-line-2244">
<p>Afri Schoedon and Vitalik Buterin. EIP-649: Metropo- lis difficulty bomb delay and block reward reduction, June 2017. URL <a href="https://eips.ethereum.org/EIPS/eip-649" data-href="https://eips.ethereum.org/EIPS/eip-649">https://eips.ethereum.org/EIPS/</a></p>
</div>
<div class="paragraph data-line-2246">
<p><a href="https://eips.ethereum.org/EIPS/eip-649" data-href="https://eips.ethereum.org/EIPS/eip-649">eip-649</a>.</p>
</div>
<div class="paragraph data-line-2248">
<p>Michael John Sebastian Smith. <em>Application-Specific Integrated Circuits</em>. Addison-Wesley, 1997. ISBN 0201500221.</p>
</div>
<div class="paragraph data-line-2250">
<p>Yonatan Sompolinsky and Aviv Zohar. Accelerating bit- coin’s transaction processing. fast money grows on trees, not chains, 2013. URL <a href="https://eprint.iacr.org/2013/881" data-href="https://eprint.iacr.org/2013/881">https://eprint.iacr.org/</a></p>
</div>
<div class="paragraph data-line-2252">
<p><a href="https://eprint.iacr.org/2013/881" data-href="https://eprint.iacr.org/2013/881">2013/881</a>.</p>
</div>
<div class="paragraph data-line-2254">
<p>Simon Sprankel. Technical Basis of Digital Currencies, 2013. URL <a href="http://www.coderblog.de/wp-content/uploads/technical-basis-of-digital-currencies.pdf" data-href="http://www.coderblog.de/wp-content/uploads/technical-basis-of-digital-currencies.pdf">http://www.coderblog.de/wp-content/</a> <a href="http://www.coderblog.de/wp-content/uploads/technical-basis-of-digital-currencies.pdf" data-href="http://www.coderblog.de/wp-content/uploads/technical-basis-of-digital-currencies.pdf">uploads/technical-basis-of-digital-currencies.</a> <a href="http://www.coderblog.de/wp-content/uploads/technical-basis-of-digital-currencies.pdf" data-href="http://www.coderblog.de/wp-content/uploads/technical-basis-of-digital-currencies.pdf">pdf</a>.</p>
</div>
<div class="paragraph data-line-2256">
<p>Nick Szabo. Formalizing and securing relation-</p>
</div>
<div class="paragraph data-line-2258">
<p>ships on public networks. <em>First Monday</em>, 2(9), 1997. URL <a href="http://firstmonday.org/ojs/index.php/fm/article/view/548" data-href="http://firstmonday.org/ojs/index.php/fm/article/view/548">http://firstmonday.org/ojs/index.php/</a> <a href="http://firstmonday.org/ojs/index.php/fm/article/view/548" data-href="http://firstmonday.org/ojs/index.php/fm/article/view/548">fm/article/view/548</a>.</p>
</div>
<div class="paragraph data-line-2260">
<p>Wei Tang. EIP-2200: Structured definitions for net gas me-</p>
</div>
<div class="paragraph data-line-2262">
<p>tering, 2019. URL <a href="https://eips.ethereum.org/EIPS/eip-2200" data-href="https://eips.ethereum.org/EIPS/eip-2200">https://eips.ethereum.org/EIPS/</a> <a href="https://eips.ethereum.org/EIPS/eip-2200" data-href="https://eips.ethereum.org/EIPS/eip-2200">eip-2200</a>.</p>
</div>
<div class="paragraph data-line-2264">
<p>Vivek Vishnumurthy, Sangeeth Chandrakumar, and Emin Gn Sirer. KARMA: A secure economic framework for peer-to-peer resource sharing, 2003. URL <a href="https://www.cs.cornell.edu/people/egs/papers/karma.pdf" data-href="https://www.cs.cornell.edu/people/egs/papers/karma.pdf">https://</a></p>
</div>
<div class="paragraph data-line-2266">
<p><a href="https://www.cs.cornell.edu/people/egs/papers/karma.pdf" data-href="https://www.cs.cornell.edu/people/egs/papers/karma.pdf">www.cs.cornell.edu/people/egs/papers/karma.pdf</a>.</p>
</div>
<div class="olist upperalpha data-line-2268">
<ol class="upperalpha" type="A">
<li class="data-line-2268">
<p>R. Willett. MasterCoin Complete Specification, 2013. URL <a href="https://github.com/mastercoin-MSC/spec" class="undefined" data-href="https://github.com/mastercoin-MSC/spec">https://github.com/mastercoin-MSC/spec</a>.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2270">
<p>Micah Zoltu. EIP-2718: Typed transaction envelope,</p>
</div>
<div class="paragraph data-line-2272">
<p>June 2020. URL <a href="https://eips.ethereum.org/EIPS/eip-2718" data-href="https://eips.ethereum.org/EIPS/eip-2718">https://eips.ethereum.org/EIPS/</a> <a href="https://eips.ethereum.org/EIPS/eip-2718" data-href="https://eips.ethereum.org/EIPS/eip-2718">eip-2718</a>.</p>
</div>
<div class="paragraph data-line-2274">
<p><span id="Appendix_A" class="_Terminology  anchor">#</span>#Appendix A. Terminology</p>
</div>
<div class="paragraph data-line-2276">
<p><strong>External Actor:</strong> A person or other entity able to interface to an Ethereum node, but external to the world of Ethereum. It can interact with Ethereum through depositing signed Transactions and inspecting the blockchain and associated state. Has one (or more) intrinsic Accounts.</p>
</div>
<div class="paragraph data-line-2278">
<p><strong>Address:</strong> A 160-bit code used for identifying Accounts.</p>
</div>
<div class="paragraph data-line-2280">
<p><strong>Account:</strong> Accounts have an intrinsic balance and transaction count maintained as part of the Ethereum state. They also have some (possibly empty) EVM Code and a (possibly empty) Storage State associated with them.</p>
</div>
<div class="paragraph data-line-2282">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 19</p>
</div>
<div class="paragraph data-line-2284">
<p>Though homogenous, it makes sense to distinguish between two practical types of account: those with empty associated EVM Code (thus the account balance is controlled, if at all, by some external entity) and those with non-empty associated EVM Code (thus the account represents an Autonomous Object). Each Account has a single Address that identifies it.</p>
</div>
<div class="paragraph data-line-2286">
<p><strong>Transaction:</strong> A piece of data, signed by an External Actor. It represents either a Message or a new Autonomous Object. Transactions are recorded into each block of the blockchain.</p>
</div>
<div class="paragraph data-line-2288">
<p><strong>Autonomous Object:</strong> A notional object existent only within the hypothetical state of Ethereum. Has an intrinsic address and thus an associated account; the account will have non-empty associated EVM Code. Incorporated only as the Storage State of that account.</p>
</div>
<div class="paragraph data-line-2290">
<p><strong>Storage State:</strong> The information particular to a given Account that is maintained between the times that the Account’s associated EVM Code runs.</p>
</div>
<div class="paragraph data-line-2292">
<p><strong>Message:</strong> Data (as a set of bytes) and Value (specified as Ether) that is passed between two Accounts, either through the deterministic operation of an Autonomous Object or the cryptographically secure signature of the Transaction.</p>
</div>
<div class="paragraph data-line-2294">
<p><strong>Message Call:</strong> The act of passing a message from one Account to another. If the destination account is associated with non-empty EVM Code, then the VM will be started with the state of said Object and the Message acted upon. If the message sender is an Autonomous Object, then the Call passes any data returned from the VM operation.</p>
</div>
<div class="paragraph data-line-2296">
<p><strong>Gas:</strong> The fundamental network cost unit. Paid for exclusively by Ether (as of PoC-4), which is converted freely to and from Gas as required. Gas does not exist outside of the internal Ethereum computation engine; its price is set by the Transaction and miners are free to ignore Transactions whose Gas price is too low.</p>
</div>
<div class="paragraph data-line-2298">
<p><strong>Contract:</strong> Informal term used to mean both a piece of EVM Code that may be associated with an Account or an Autonomous Object.</p>
</div>
<div class="paragraph data-line-2300">
<p><strong>Object:</strong> Synonym for Autonomous Object.</p>
</div>
<div class="paragraph data-line-2302">
<p><strong>App:</strong> An end-user-visible application hosted in the Ethereum Browser.</p>
</div>
<div class="paragraph data-line-2304">
<p><strong>Ethereum Browser:</strong> (aka Ethereum Reference Client) A cross-platform GUI of an interface similar to a simplified browser (a la Chrome) that is able to host sandboxed applications whose backend is purely on the Ethereum protocol.</p>
</div>
<div class="paragraph data-line-2306">
<p><strong>Ethereum Virtual Machine:</strong> (aka EVM) The virtual machine that forms the key part of the execution model for an Account’s associated EVM Code.</p>
</div>
<div class="paragraph data-line-2308">
<p><strong>Ethereum Runtime Environment:</strong> (aka ERE) The environment which is provided to an Autonomous Object executing in the EVM. Includes the EVM but also the structure of the world state on which the EVM relies for certain I/O instructions including CALL &amp; CREATE.</p>
</div>
<div class="paragraph data-line-2310">
<p><strong>EVM Code:</strong> The bytecode that the EVM can natively execute. Used to formally specify the meaning and ramifications of a message to an Account.</p>
</div>
<div class="paragraph data-line-2312">
<p><strong>EVM Assembly:</strong> The human-readable form of EVM-code.</p>
</div>
<div class="paragraph data-line-2314">
<p><strong>LLL:</strong> The Lisp-like Low-level Language, a human-writable language used for authoring simple contracts and general low-level language toolkit for trans-compiling to.</p>
</div>
<div class="paragraph data-line-2316">
<p><span id="Appendix_B" class="_Recursive_Length_Prefix  anchor">#</span>#Appendix B. Recursive Length Prefix</p>
</div>
<div class="paragraph data-line-2318">
<p><span id="_bookmark113 " class="anchor">#</span>#This is a serialisation method for encoding arbitrarily structured binary data (byte arrays). We define the set of possible structures T:</p>
</div>
<div class="paragraph data-line-2320">
<p>(188)</p>
</div>
<div class="paragraph data-line-2322">
<p>(189)</p>
</div>
<div class="paragraph data-line-2324">
<p>(190)</p>
</div>
<div class="paragraph data-line-2326">
<p>T ≡ L \± B</p>
</div>
<div class="paragraph data-line-2328">
<p>L ≡ \{<strong>t</strong> : <strong>t</strong> = (<strong>t</strong><em class="0">,</em> <strong>t</strong><em class="1">, &#8230;&#8203;</em>) ∧ ∀<em>n &lt;</em> ll<strong>t</strong>ll : <strong>t</strong>[<em>n</em>] ∈ T}</p>
</div>
<div class="paragraph data-line-2330">
<p>B ≡ \{<strong>b</strong> : <strong>b</strong> = (<strong>b</strong><em class="0">,</em> <strong>b</strong><em class="1">, &#8230;&#8203;</em>) ∧ ∀<em>n &lt;</em> ll<strong>b</strong>ll : <strong>b</strong>[<em>n</em>] ∈ O}</p>
</div>
<div class="paragraph data-line-2332">
<p>Where O is the set of (8-bit) bytes. Thus B is the set of all sequences of bytes (otherwise known as byte arrays, and a leaf if imagined as a tree), L is the set of all tree-like (sub-)structures that are not a single leaf (a branch node if imagined as a tree) and T is the set of all byte arrays and such structural sequences. The disjoint union \± is needed only</p>
</div>
<div class="paragraph data-line-2334">
<p>to distinguish the empty byte array () ∈ B from the empty list () ∈ L, which are encoded differently as defined below; as</p>
</div>
<div class="paragraph data-line-2336">
<p>common, we will abuse notation and leave the disjoint union indices implicit, inferable from context.</p>
</div>
<div class="paragraph data-line-2338">
<p>We define the RLP function as RLP through two sub-functions, the first handling the instance when the value is a byte array, the second when it is a sequence of further values:</p>
</div>
<div class="paragraph data-line-2340">
<p>(191) RLP(<strong>x</strong>) <em>R</em>b(<strong>x</strong>) if <strong>x</strong> ∈ B</p>
</div>
<div class="paragraph data-line-2342">
<p><em>R</em><sub>l</sub>(<strong>x</strong>) otherwise</p>
</div>
<div class="paragraph data-line-2344">
<p>If the value to be serialised is a byte array, the RLP serialisation takes one of three forms:</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-2347">
<ul>
<li class="data-line-2347">
<p>If the byte array contains solely a single byte and that single byte is less than 128, then the input is exactly equal to the output.</p>
</li>
<li class="data-line-2348">
<p>If the byte array contains fewer than 56 bytes, then the output is equal to the input prefixed by the byte equal to the length of the byte array plus 128.</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-2350">
<blockquote>
<div class="paragraph data-line-2351">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 20</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-2354">
<ul>
<li class="data-line-2354">
<p>Otherwise, the output is equal to the input, provided that it contains fewer than 2 bytes, prefixed by the</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-2356">
<blockquote>
<div class="paragraph data-line-2357">
<p>minimal-length byte array which when interpreted as a big-endian integer is equal to the length of the input byte</p>
</div>
<div class="paragraph data-line-2359">
<p>array, which is itself prefixed by the number of bytes required to faithfully encode this length value plus 183.</p>
</div>
<div class="paragraph data-line-2361">
<p>Byte arrays containing 2<sup>64</sup> or more bytes cannot be encoded. This restriction ensures that the first byte of the encoding <span id="_bookmark114 " class="anchor">#</span>#of a byte array is always below 192, and thus it can be readily distinguished from the encodings of sequences in L.</p>
</div>
<div class="paragraph data-line-2363">
<p>Formally, we define <em>R</em><sub>b</sub>:</p>
</div>
<div class="paragraph data-line-2365">
<p>(192)</p>
</div>
<div class="paragraph data-line-2367">
<p>[<mark><em>bookmark115 .anchor]</mark>#_R</em><sub>b</sub>(<strong>x</strong>) ≡</p>
</div>
<div class="paragraph data-line-2369">
<p><strong>x</strong> if ll<strong>x</strong>ll = 1 ∧ <strong>x</strong>[0] <em>&lt;</em> 128</p>
</div>
<div class="paragraph data-line-2371">
<p>(128 + ll<strong>x</strong>ll) · <strong>x</strong> else if ll<strong>x</strong>ll <em>&lt;</em> 56</p>
</div>
<div class="paragraph data-line-2373">
<p>∅ otherwise</p>
</div>
<div class="paragraph data-line-2375">
<p><strong>b</strong> −1</p>
</div>
<div class="paragraph data-line-2377">
<p>(193)</p>
</div>
<div class="paragraph data-line-2379">
<p>BE(<em>x</em>) ≡ (<em>b</em>0<em>, b</em>1<em>, &#8230;&#8203;</em>) : <em>b</em>0</p>
</div>
<div class="paragraph data-line-2381">
<p>0 ∧ <em>x</em> =</p>
</div>
<div class="paragraph data-line-2383">
<p><em>n</em> =0</p>
</div>
<div class="paragraph data-line-2385">
<p><em>bn</em> · 256 <strong>b</strong> −1−<em>n</em></p>
</div>
<div class="paragraph data-line-2387">
<p>(194) (<em>x</em>1<em>, &#8230;&#8203;, xn</em>) · (<em>y</em>1<em>, &#8230;&#8203;, ym</em>) = (<em>x</em>1<em>, &#8230;&#8203;, xn, y</em>1<em>, &#8230;&#8203;, ym</em>)</p>
</div>
<div class="paragraph data-line-2389">
<p>Thus BE is the function that expands a non-negative integer value to a big-endian byte array of minimal length and the dot operator performs sequence concatenation.</p>
</div>
<div class="paragraph data-line-2391">
<p>If instead, the value to be serialised is a sequence of other items then the RLP serialisation takes one of two forms:</p>
</div>
</blockquote>
</div>
<div class="ulist data-line-2394">
<ul>
<li class="data-line-2394">
<p>If the concatenated serialisations of each contained item is less than 56 bytes in length, then the output is equal to that concatenation prefixed by the byte equal to the length of this byte array plus 192.</p>
</li>
<li class="data-line-2395">
<p>Otherwise, the output is equal to the concatenated serialisations, provided that they contain fewer than 2 bytes,</p>
</li>
</ul>
</div>
<div class="quoteblock data-line-2397">
<blockquote>
<div class="paragraph data-line-2398">
<p>prefixed by the minimal-length byte array which when interpreted as a big-endian integer is equal to the length</p>
</div>
<div class="paragraph data-line-2400">
<p>of the concatenated serialisations byte array, which is itself prefixed by the number of bytes required to faithfully encode this length value plus 247.</p>
</div>
<div class="paragraph data-line-2402">
<p>Sequences whose concatenated serialized items contain 2<sup>64</sup> or more bytes cannot be encoded. This restriction ensures <span id="_bookmark116 " class="anchor">#</span>#that the first byte of the encoding does not exceed 255 (otherwise it would not be a byte).</p>
</div>
<div class="paragraph data-line-2404">
<p>Thus we finish by formally defining <em>R</em><sub>l</sub>:</p>
</div>
<div class="paragraph data-line-2406">
<p>(195)</p>
</div>
<div class="paragraph data-line-2408">
<p><em>R</em><sub>l</sub>(<strong>x</strong>) ≡</p>
</div>
<div class="paragraph data-line-2410">
<p>247 + BE(ll<em>s</em>(<strong>x</strong>)ll) · BE(ll<em>s</em>(<strong>x</strong>)ll) · <em>s</em>(<strong>x</strong>) else if <em>s</em>(<strong>x</strong>) = ∅ ∧ ll<em>s</em>(<strong>x</strong>)ll <em>&lt;</em> 2<sup>64</sup></p>
</div>
<div class="paragraph data-line-2412">
<p>f</p>
</div>
<div class="paragraph data-line-2414">
<p>If RLP is used to encode a scalar, defined only as a non-negative integer (in N, or in N<em>x</em> for any <em>x</em>), it must be encoded as the shortest byte array whose big-endian interpretation is the scalar. Thus the RLP of some non-negative integer <em>i</em> is defined as:</p>
</div>
<div class="paragraph data-line-2416">
<p>(197) RLP(<em>i</em> : <em>i</em> ∈ N) ≡ RLP(BE(<em>i</em>))</p>
</div>
<div class="paragraph data-line-2418">
<p>When interpreting RLP data, if an expected fragment is decoded as a scalar and leading zeroes are found in the byte sequence, clients are required to consider it non-canonical and treat it in the same manner as otherwise invalid RLP data, dismissing it completely.</p>
</div>
<div class="paragraph data-line-2420">
<p>There is no specific canonical encoding format for signed or floating-point values.</p>
</div>
<div class="paragraph data-line-2422">
<p>Appendix C. Hex-Prefix Encoding</p>
</div>
<div class="paragraph data-line-2424">
<p>Hex-prefix encoding is an efficient method of encoding an arbitrary number of nibbles as a byte array. It is able to store an additional flag which, when used in the context of the trie (the only context in which it is used), disambiguates between node types.</p>
</div>
<div class="paragraph data-line-2426">
<p>It is defined as the function HP which maps from a sequence of nibbles (represented by the set Y) together with a boolean value to a sequence of bytes (represented by the set B):</p>
</div>
<div class="paragraph data-line-2428">
<p>(198)</p>
</div>
<div class="paragraph data-line-2430">
<p>HP(<strong>x*<em>, t</em>) : *x</strong> Y (16<em>f</em> (<em>t</em>)<em>,</em> 16<strong>x</strong>[0] + <strong>x</strong><em class="1">,</em> 16<strong>x</strong>[2] + <strong>x</strong><em class="3">, &#8230;&#8203;</em>) if ll<strong>x</strong>ll is even</p>
</div>
<div class="paragraph data-line-2432">
<p>(16(<em>f</em> (<em>t</em>) + 1) + <strong>x</strong><em class="0">,</em> 16<strong>x</strong>[1] + <strong>x</strong><em class="2">,</em> 16<strong>x</strong>[3] + <strong>x</strong><em class="4">, &#8230;&#8203;</em>) otherwise</p>
</div>
<div class="paragraph data-line-2434">
<p>(199)</p>
</div>
<div class="paragraph data-line-2436">
<p><em>f</em> (<em>t</em>) ≡ f2 if <em>t</em> 0</p>
</div>
<div class="paragraph data-line-2438">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-2440">
<p>Thus the high nibble of the first byte contains two flags; the lowest bit encoding the oddness of the length and the second-lowest encoding the flag <em>t</em>. The low nibble of the first byte is zero in the case of an even number of nibbles and the first nibble in the case of an odd number. All remaining nibbles (now an even number) fit properly into the remaining bytes.</p>
</div>
<div class="paragraph data-line-2442">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 21</p>
</div>
<div class="paragraph data-line-2444">
<p><span id="Appendix_D" class="_Modified_Merkle_Patricia_Tre  anchor">#</span>#Appendix D. Modified Merkle Patricia Tree</p>
</div>
<div class="paragraph data-line-2446">
<p><span id="_bookmark118 " class="anchor">#</span>#The modified Merkle Patricia tree (trie) provides a persistent data structure to map between arbitrary-length binary data (byte arrays). It is defined in terms of a mutable data structure to map between 256-bit binary fragments and arbitrary-length binary data, typically implemented as a database. The core of the trie, and its sole requirement in terms of the protocol specification, is to provide a single value that identifies a given set of key-value pairs, which may be either a 32-byte sequence or the empty byte sequence. It is left as an implementation consideration to store and maintain the structure of the trie in a manner that allows effective and efficient realisation of the protocol.</p>
</div>
<div class="paragraph data-line-2448">
<p>Formally, we assume the input value I, a set containing pairs of byte sequences with unique keys:</p>
</div>
<div class="paragraph data-line-2450">
<p>(200) I = \{(<strong>k</strong>0 ∈ B<em>,</em> <strong>v</strong>0 ∈ B)<em>,</em> (<strong>k</strong>1 ∈ B<em>,</em> <strong>v</strong>1 ∈ B)<em>,</em> }</p>
</div>
<div class="paragraph data-line-2452">
<p>When considering such a sequence, we use the common numeric subscript notation to refer to a tuple’s key or value, thus:</p>
</div>
<div class="paragraph data-line-2454">
<p>(201) ∀<em>I</em> ∈ I : <em>I</em> ≡ (<em>I</em>0<em>, I</em>1)</p>
</div>
<div class="paragraph data-line-2456">
<p>Any series of bytes may also trivially be viewed as a series of nibbles, given an endian-specific notation; here we assume big-endian. Thus:</p>
</div>
<div class="paragraph data-line-2458">
<p>(202)</p>
</div>
<div class="paragraph data-line-2460">
<p>(203)</p>
</div>
<div class="paragraph data-line-2462">
<p>∀<em>n</em> : ∀<em>i &lt;</em> 2ll<strong>k</strong><em>n</em></p>
</div>
<div class="paragraph data-line-2464">
<p><em>y</em>(I) = \{(<strong>k</strong><sub>0</sub> ∈ Y<em>,</em> <strong>v</strong><sub>0</sub> ∈ B)<em>,</em> (<strong>k</strong><sub>1</sub> ∈ Y<em>,</em> <strong>v</strong><sub>1</sub> ∈ B)<em>, &#8230;&#8203;</em>}</p>
</div>
<div class="paragraph data-line-2466">
<p>*k*<em>n</em>[<em>i</em> 2] 16 if <em>i</em> is even</p>
</div>
<div class="paragraph data-line-2468">
<p><em>n</em></p>
</div>
<div class="paragraph data-line-2470">
<p>*k*<em>n</em>[l<em>i</em> ÷ 2J] mod 16 otherwise</p>
</div>
<div class="paragraph data-line-2472">
<p>We define the function TRIE, which evaluates to the root of the trie that represents this set when encoded in this structure:</p>
</div>
<div class="paragraph data-line-2474">
<p>(204) TRIE(I) ≡ KEC RLP(<em>c</em>(I<em>,</em> 0))</p>
</div>
<div class="paragraph data-line-2476">
<p>We also assume a function <em>n</em>, the trie’s node cap function. When composing a node, we use RLP to encode the structure. As a means of reducing storage complexity, we store nodes whose composed RLP is fewer than 32 bytes directly; for those larger we assert prescience of the byte array whose Keccak-256 hash evaluates to our reference. Thus we define in terms of <em>c</em>, the node composition function:</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-2479">
<p>() if I = ∅</p>
</div>
<div class="paragraph data-line-2481">
<p>KEC RLP(<em>c</em>(I<em>, i</em>)) otherwise</p>
</div>
<div class="quoteblock data-line-2483">
<blockquote>
<div class="paragraph data-line-2484">
<p>In a manner similar to a radix tree, when the trie is traversed from root to leaf, one may build a single key-value pair. The key is accumulated through the traversal, acquiring a single nibble from each branch node (just as with a radix tree). Unlike a radix tree, in the case of multiple keys sharing the same prefix or in the case of a single key having a unique suffix, two optimising nodes are provided. Thus while traversing, one may potentially acquire multiple nibbles from each of the other two node types, extension and leaf. There are three kinds of nodes in the trie:</p>
</div>
<div class="paragraph data-line-2486">
<p><strong>Leaf:</strong> A two-item structure whose first item corresponds to the nibbles in the key not already accounted for by the accumulation of keys and branches traversed from the root. The hex-prefix encoding method is used and the second parameter to the function is required to be 1.</p>
</div>
<div class="paragraph data-line-2488">
<p><strong>Extension:</strong> A two-item structure whose first item corresponds to a series of nibbles of size greater than one that are shared by at least two distinct keys past the accumulation of the keys of nibbles and the keys of branches as traversed from the root. The hex-prefix encoding method is used and the second parameter to the function is required to be 0.</p>
</div>
<div class="paragraph data-line-2490">
<p><strong>Branch:</strong> A 17-item structure whose first sixteen items correspond to each of the sixteen possible nibble values for the keys at this point in their traversal. The 17th item is used in the case of this being a terminator node and thus a key being ended at this point in its traversal.</p>
</div>
<div class="paragraph data-line-2492">
<p>A branch is then only used when necessary; no branch nodes may exist that contain only a single non-zero entry. We may formally define this structure with the structural composition function <em>c</em>:</p>
</div>
<div class="paragraph data-line-2494">
<p>HP(<em>I</em> <em class="_i.._( _I_ 1)">,</em> 1)<em>, I</em> if I = 1 where <em>I</em> : <em>I</em> I</p>
</div>
<div class="paragraph data-line-2496">
<p>HP(<em>I</em>0[<em>i..</em>(<em>j</em> − 1)]<em>,</em> 0)<em>, n</em>(I<em>, j</em>) if <em>i</em> = <em>j</em> where <em>j</em> = max\{<em>x</em> : ∃<strong>l</strong> : ll<strong>l</strong>ll = <em>x</em> ∧ ∀<em>I</em> ∈ I : <em>I</em>0[0<em>..</em>(<em>x</em> − 1)] = <strong>l</strong>}</p>
</div>
<div class="paragraph data-line-2498">
<p>(206) <em>c</em>(I<em>, i</em>) ≡ <strong></strong>(<em>u</em>(0)<em>, u</em>(1)<em>, &#8230;&#8203;, u</em>(15)<em>, v</em>) otherwise where <em>u</em>(<em>j</em>) ≡ <em>n</em>f(\{<em>I</em> : <em>I</em> ∈ I ∧ <em>I</em>0[<em>i</em>] = <em>j</em>}_, i_ + 1)</p>
</div>
<div class="paragraph data-line-2500">
<p>D.1. <strong>Trie Database.</strong> Thus no explicit assumptions are made concerning what data is stored and what is not, since that is an implementation-specific consideration; we simply define the identity function mapping the key-value set I to a 32-byte hash and assert that only a single such hash exists for any I, which though not strictly true is accurate within acceptable precision given the Keccak hash’s collision resistance. In reality, a sensible implementation will not fully recompute the trie root hash for each set.</p>
</div>
<div class="paragraph data-line-2502">
<p>A reasonable implementation will maintain a database of nodes determined from the computation of various tries or, more formally, it will memoise the function <em>c</em>. This strategy uses the nature of the trie to both easily recall the contents of</p>
</div>
<div class="paragraph data-line-2504">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 22</p>
</div>
<div class="paragraph data-line-2506">
<p>any previous key-value set and to store multiple such sets in a very efficient manner. Due to the dependency relationship, Merkle-proofs may be constructed with an <em>O</em>(log <em>N</em> ) space requirement that can demonstrate a particular leaf must exist within a trie of a given root hash.</p>
</div>
<div class="paragraph data-line-2508">
<p><span id="Appendix_E" class="_Precompiled_Contracts  anchor">#</span>#Appendix E. Precompiled Contracts</p>
</div>
<div class="paragraph data-line-2510">
<p>For each precompiled contract, we make use of a template function, ΞPRE, which implements the out-of-gas checking.</p>
</div>
<div class="paragraph data-line-2512">
<p>(207) <span id="_bookmark120 " class="anchor">#</span>#Ξ</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-2515">
<p>PRE</p>
</div>
<div class="paragraph data-line-2517">
<p>(<em>*σ*, g, A, I</em>) (∅<em>,</em> 0<em>, A,</em> ()) if <em>g &lt; g</em>r</p>
</div>
<div class="paragraph data-line-2519">
<p>(<em>*σ*, g</em> − <em>g</em>r<em>, A,</em> <strong>o</strong>) otherwise</p>
</div>
<div class="quoteblock data-line-2521">
<blockquote>
<div class="paragraph data-line-2522">
<p>The precompiled contracts each use these definitions and provide specifications for the <strong>o</strong> (the output data) and <em>g</em>r, the gas requirements.</p>
</div>
<div class="paragraph data-line-2524">
<p>We define ΞECREC as a precompiled contract for the elliptic curve digital signature algorithm (ECDSA) public key recovery function (ecrecover). See Appendix <a href="#Appendix_F.<em>Signing_Transactions" data-href="#Appendix_F.<em>Signing_Transactions">F</a> for the definition of the function ECDSARECOVER. We also define <strong>d</strong> to be the input data, well-defined for an infinite length by appending zeroes as required. In the case of an invalid signature (ECDSARECOVER(_h, v, r, s</em>) = ∅), we return no output.</p>
</div>
<div class="paragraph data-line-2526">
<p>(208)</p>
</div>
<div class="paragraph data-line-2528">
<p>(209)</p>
</div>
<div class="paragraph data-line-2530">
<p>(210)</p>
</div>
<div class="paragraph data-line-2532">
<p>ΞECREC ≡ ΞPRE where:</p>
</div>
<div class="paragraph data-line-2534">
<p><em>g</em>r = 3000</p>
</div>
<div class="paragraph data-line-2536">
<p><strong>o</strong> = 0 if ECDSARECOVER(<em>h, v, r, s</em>) = ∅</p>
</div>
<div class="paragraph data-line-2538">
<p>32 otherwise</p>
</div>
<div class="paragraph data-line-2540">
<p>(211)</p>
</div>
<div class="paragraph data-line-2542">
<p>(212)</p>
</div>
<div class="paragraph data-line-2544">
<p>(213)</p>
</div>
<div class="paragraph data-line-2546">
<p>(214)</p>
</div>
<div class="paragraph data-line-2548">
<p>if ll<strong>o</strong>ll = 32 :</p>
</div>
<div class="paragraph data-line-2550">
<p><strong>o</strong>[0<em>..</em>11] = 0</p>
</div>
<div class="paragraph data-line-2552">
<p><strong>o</strong>[12<em>..</em>31] = KEC ECDSARECOVER(<em>h, v, r, s</em>) [12<em>..</em>31] where:</p>
</div>
<div class="paragraph data-line-2554">
<p><strong>d</strong>[0<em>..</em>(ll<a href="#<em>bookmark54" data-href="#<em>bookmark54">_I</em>*<sub>d</sub><strong></a>ll − 1)] = <em>I</em></strong><sub>d</sub>*</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2558">
<colgroup>
<col style="width: 35%;">
<col style="width: 39%;">
<col style="width: 7%;">
<col style="width: 19%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
(215)
</em>_</em></th>
<th class="tableblock halign-left valign-top"><strong>d</strong>[ll<em>I</em><strong><sub>d</sub></strong>ll<em>..</em>]</th>
<th class="tableblock halign-left valign-top">=</th>
<th class="tableblock halign-left valign-top"><em><em>_
(0</em>,<em> 0</em>, &#8230;&#8203;<em>)
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(216)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>h</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>d</strong>[0<em>..</em>31]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(217)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>v</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>d</strong>[32<em>..</em>63]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(218)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>r</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>d</strong>[64<em>..</em>95]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(219)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>s</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>d</strong>[96<em>..</em>127]</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-2611">
<blockquote>
<div class="paragraph data-line-2612">
<p>We define ΞSHA256 and ΞRIP160 as precompiled contracts implementing the SHA2-256 and RIPEMD-160 hash functions respectively. Their gas usage is dependent on the input data size, a factor rounded up to the nearest number of words.</p>
</div>
<div class="paragraph data-line-2614">
<p>(220) ΞSHA256 ≡ ΞPRE where:</p>
</div>
<div class="paragraph data-line-2616">
<p>(221)</p>
</div>
<div class="paragraph data-line-2618">
<p><em>g</em> = 60 + 12 ll__I__**d**ll</p>
</div>
<div class="paragraph data-line-2620">
<p>32</p>
</div>
<div class="paragraph data-line-2622">
<p>(222) <strong>o</strong>[0<em>..</em>31] = SHA256(<em>I</em>*<sub>d</sub>*)</p>
</div>
<div class="paragraph data-line-2624">
<p>(223) ΞRIP160 ≡ ΞPRE where:</p>
</div>
<div class="paragraph data-line-2626">
<p>(224)</p>
</div>
<div class="paragraph data-line-2628">
<p><em>g</em> = 600 + 120 ll__I__**d**ll</p>
</div>
<div class="paragraph data-line-2630">
<p>32</p>
</div>
<div class="paragraph data-line-2632">
<p>(225) <strong>o</strong>[0<em>..</em>11] = 0</p>
</div>
<div class="paragraph data-line-2634">
<p>(226) <strong>o</strong>[12<em>..</em>31] = RIPEMD160(<em>I</em>*<sub>d</sub>*)</p>
</div>
<div class="paragraph data-line-2636">
<p>For the purposes here, we assume we have well-defined standard cryptographic functions for RIPEMD-160 and SHA2-256 of the form:</p>
</div>
<div class="paragraph data-line-2638">
<p>(227)</p>
</div>
<div class="paragraph data-line-2640">
<p>(228)</p>
</div>
<div class="paragraph data-line-2642">
<p>SHA256(<strong>i</strong> ∈ B) ≡ <em>o</em> ∈ B32</p>
</div>
<div class="paragraph data-line-2644">
<p>RIPEMD160(<strong>i</strong> ∈ B) ≡ <em>o</em> ∈ B20</p>
</div>
<div class="paragraph data-line-2646">
<p>The fourth contract, the identity function ΞID simply defines the output as the input:</p>
</div>
<div class="paragraph data-line-2648">
<p>(229) ΞID ≡ ΞPRE where:</p>
</div>
<div class="paragraph data-line-2650">
<p>(230)</p>
</div>
<div class="paragraph data-line-2652">
<p><em>g</em> = 15 + 3 ll__I__**d**ll</p>
</div>
<div class="paragraph data-line-2654">
<p>32</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2658">
<ol class="arabic" start="231">
<li class="data-line-2658">
<p><strong>o</strong> = <em>I</em>*<sub>d</sub>*</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2660">
<blockquote>
<div class="paragraph data-line-2661">
<p>The fifth contract performs arbitrary-precision exponentiation under modulo. Here, 0<sup>0</sup> is taken to be one, and <em>x</em> mod 0 is zero for all <em>x</em>. The first word in the input specifies the number of bytes that the first non-negative integer <em>B</em> occupies. The second word in the input specifies the number of bytes that the second non-negative integer <em>E</em> occupies. The third word in the input specifies the number of bytes that the third non-negative integer <em>M</em> occupies. These three words are</p>
</div>
<div class="paragraph data-line-2663">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 23</p>
</div>
<div class="paragraph data-line-2665">
<p>followed by <em>B</em>, <em>E</em> and <em>M</em> . The rest of the input is discarded. Whenever the input is too short, the missing bytes are considered to be zero. The output is encoded big-endian into the same format as <em>M</em> ’s.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2669">
<ol class="arabic" start="232">
<li class="data-line-2669">
<p>ΞEXPMOD ≡ ΞPRE except:</p>
</li>
<li class="data-line-2670">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2672">
<blockquote>
<div class="paragraph data-line-2673">
<p><em>g</em> = max 200<em>,</em> I <em>f</em> max(<em>.€</em><sub>M</sub><em>, .€</em><sub>B</sub>) max(<em>.€</em> <sub>E</sub><em>,</em> 1)</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2677">
<ol class="arabic" start="234">
<li class="data-line-2677">
<p></p>
</li>
<li class="data-line-2678">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2680">
<blockquote>
<div class="paragraph data-line-2681">
<p><em>G</em>quaddivisor ≡ 3</p>
</div>
<div class="paragraph data-line-2683">
<p><em>f</em> (<em>x</em>) ≡ <em>x</em> l2</p>
</div>
<div class="paragraph data-line-2685">
<p>quaddivisor</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2689">
<ol class="arabic" start="236">
<li class="data-line-2689">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2691">
<blockquote>
<div class="paragraph data-line-2692">
<p><em>.€</em><sub>E</sub> =</p>
</div>
<div class="paragraph data-line-2694">
<p>0 if <em>.€</em>E ≤ 32 ∧ <em>E</em> = 0</p>
</div>
<div class="paragraph data-line-2696">
<p>llog<sub>2</sub>(<em>E</em>)J if <em>.€</em>E ≤ 32 ∧ <em>E</em> = 0</p>
</div>
<div class="paragraph data-line-2698">
<p>8(<em>.€</em>E − 32) + llog<sub>2</sub>(<em>i</em>[(96 + <em>.€</em>B)<em>..</em>(127 + <em>.€</em>B)])J if 32 <em>&lt; .€</em>E ∧ <em>i</em>[(96 + <em>.€</em>B)<em>..</em>(127 + <em>.€</em>B)] = 0</p>
</div>
<div class="paragraph data-line-2700">
<p>8(<em>.€</em>E − 32) otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2704">
<ol class="arabic" start="237">
<li class="data-line-2704">
<p><strong>o</strong> = <em>B<sup>E</sup></em> mod <em>M</em> ∈ N<sub>8<em>£</em></sub></p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2707">
<colgroup>
<col style="width: 19%;">
<col style="width: 14%;">
<col style="width: 6%;">
<col style="width: 61%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
(238)
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em>.€</em>B</th>
<th class="tableblock halign-left valign-top">≡</th>
<th class="tableblock halign-left valign-top"><em><em>_
_i</em>[0</em>..<em>31]
</em>__</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(239)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>.€</em>E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">≡</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>i</em>[32<em>..</em>63]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(240)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>.€</em>M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">≡</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>i</em>[64<em>..</em>95]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(241)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">≡</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>i</em>[96<em>..</em>(95 + <em>.€</em>B)]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(242)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>E</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">≡</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>i</em>[(96 + <em>.€</em>B)<em>..</em>(95 + <em>.€</em>B + <em>.€</em>E)]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(243)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>M</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">≡</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>i</em>[(96 + <em>.€</em>B + <em>.€</em>E)<em>..</em>(95 + <em>.€</em>B + <em>.€</em>E + <em>.€</em>M)]</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-2770">
<blockquote>
<div class="paragraph data-line-2771">
<p>(244)</p>
</div>
<div class="paragraph data-line-2773">
<p><em>i</em>[<em>x</em>] <em>I</em>*<sub>d</sub>*[<em>x</em>] if <em>x &lt;</em> ll<em>I</em><strong><sub>d</sub></strong>ll</p>
</div>
<div class="paragraph data-line-2775">
<p>0 otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2779">
<ol class="arabic">
<li class="data-line-2779">
<p><strong>zkSNARK Related Precompiled Contracts.</strong> We choose two numbers, both of which are prime.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2781">
<blockquote>
<div class="paragraph data-line-2782">
<p>(245) <em>p</em> ≡ 21888242871839275222246405745257275088696311157297823662689037894645226208583</p>
</div>
<div class="paragraph data-line-2784">
<p>(246) <em>q</em> ≡ 21888242871839275222246405745257275088548364400416034343698204186575808495617</p>
</div>
<div class="paragraph data-line-2786">
<p>Since <em>p</em> is a prime number, \{0<em>,</em> 1<em>, . . . , p</em> − 1} forms a field with addition and multiplication modulo <em>p</em>. We call this field <em>F</em>p.</p>
</div>
<div class="paragraph data-line-2788">
<p>We define a set <em>C</em>1 with</p>
</div>
<div class="paragraph data-line-2790">
<p>(247) <em>C</em>1 ≡ \{(<em>X, Y</em> ) ∈ <em>F</em>p × <em>F</em>p | <em>Y</em> 2 = <em>X</em>3 + 3} ∪ \{(0<em>,</em> 0)}</p>
</div>
<div class="paragraph data-line-2792">
<p>We define a binary operation + on <em>C</em>1 for distinct elements (<em>X</em>1<em>, Y</em>1)<em>,</em> (<em>X</em>2<em>, Y</em>2) with</p>
</div>
<div class="paragraph data-line-2794">
<p>(248)</p>
</div>
<div class="paragraph data-line-2796">
<p>[<mark><em>bookmark121 .anchor]</mark>#(_X , Y</em> ) + (<em>X , Y</em> ) ≡ f(<em>X, Y</em> ) if <em>X</em>1 = <em>X</em>2</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-2799">
<p><em>λ Y</em>2 − __Y__1</p>
</div>
<div class="paragraph data-line-2801">
<p><em>X</em>2 − <em>X</em>1</p>
</div>
<div class="quoteblock data-line-2803">
<blockquote>
<div class="paragraph data-line-2804">
<p><em>X</em> ≡ <em>λ</em>2 − <em>X</em>1 − <em>X</em>2</p>
</div>
<div class="paragraph data-line-2806">
<p><em>Y</em> ≡ <em>λ</em>(<em>X</em>1 − <em>X</em>) − <em>Y</em>1</p>
</div>
<div class="paragraph data-line-2808">
<p>In the case where (<em>X</em>1<em>, Y</em>1) = (<em>X</em>2<em>, Y</em>2), we define + on <em>C</em>1 with</p>
</div>
<div class="paragraph data-line-2810">
<p>(249) [<mark><em>bookmark122 .anchor]</mark>#(_X , Y</em> ) + (<em>X , Y</em> ) ≡ f(<em>X, Y</em> ) if <em>Y</em>1 0</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-2813">
<p>1 1 2 2</p>
</div>
<div class="paragraph data-line-2815">
<p><em>λ</em> ≡</p>
</div>
<div class="quoteblock data-line-2817">
<blockquote>
<div class="paragraph data-line-2818">
<p>(0<em>,</em> 0) otherwise</p>
</div>
<div class="paragraph data-line-2820">
<p>3<em>X</em><sup>2</sup></p>
</div>
<div class="paragraph data-line-2822">
<p>2<em>Y</em>1</p>
</div>
<div class="paragraph data-line-2824">
<p><em>X</em> ≡ <em>λ</em>2 − 2<em>X</em>1</p>
</div>
<div class="paragraph data-line-2826">
<p><em>Y</em> ≡ <em>λ</em>(<em>X</em>1 − <em>X</em>) − <em>Y</em>1</p>
</div>
<div class="paragraph data-line-2828">
<p>(<em>C</em>1<em>,</em> +) is known to form a group. We define scalar multiplication [<mark>_bookmark123 .anchor]</mark>#· with</p>
</div>
<div class="paragraph data-line-2830">
<p>(250) <em>n</em> · <em>P</em> ≡ (0<em>,</em> 0) + <em>P</em> + · · · + <em>P</em></p>
</div>
<div class="paragraph data-line-2832">
<p><em>n</em></p>
</div>
<div class="paragraph data-line-2834">
<p>for a natural number <em>n</em> and a point <em>P</em> in <em>C</em>1.</p>
</div>
<div class="paragraph data-line-2836">
<p>We define <em>P</em>1 to be a point (1<em>,</em> 2) on <em>C</em>1. Let <em>G</em>1 be the subgroup of (<em>C</em>1<em>,</em> +) generated by <em>P</em>1. <em>G</em>1 is known to be a cyclic group of order <em>q</em>. For a point <em>P</em> in <em>G</em>1, we define log<sub><em>P</em>1</sub> (<em>P</em> ) to be the smallest natural number <em>n</em> satisfying <em>n</em> · <em>P</em>1 = <em>P</em> . log<em>P</em>1 (<em>P</em> ) is at most <em>q</em> − 1.</p>
</div>
<div class="paragraph data-line-2838">
<p>Let <em>F<sub>p</sub></em>2 be a field <em>F<sub>p</sub></em>[<em>i</em>]<em>/</em>(<em>i</em><sup>2</sup> + 1). We define a set <em>C</em><sub>2</sub> with</p>
</div>
<div class="paragraph data-line-2840">
<p>(251) <em>C</em><sub>2</sub> ≡ \{(<em>X, Y</em> ) ∈ <em>F<sub>p</sub></em>2 × <em>F<sub>p</sub></em>2 | <em>Y</em> <sup>2</sup> = <em>X</em><sup>3</sup> + 3(<em>i</em> + 9)<sup>−1</sup>} ∪ \{(0<em>,</em> 0)}</p>
</div>
<div class="paragraph data-line-2842">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 24</p>
</div>
<div class="paragraph data-line-2844">
<p>We define a binary operation + and scalar multiplication · with the same equations <a href="#_bookmark121" data-href="#_bookmark121">(248),</a> <a href="#_bookmark122" data-href="#_bookmark122">(249)</a> and <a href="#_bookmark123" data-href="#_bookmark123">(250).</a> (<em>C</em>2<em>,</em> +) is also known to be a group. We define <em>P</em>2 in <em>C</em>2 with</p>
</div>
<div class="paragraph data-line-2846">
<p>(252)</p>
</div>
<div class="paragraph data-line-2848">
<p><em>P</em>2 ≡ (11559732032986387107991004021392285783925812861821192530917403151452391805634 × <em>i</em></p>
</div>
<div class="paragraph data-line-2850">
<p>+10857046999023057135944570762232829481370756359578518086990519993285655852781<em>,</em></p>
</div>
<div class="paragraph data-line-2852">
<p>4082367875863433681332203403145435568316851327593401208105741076214120093531 × <em>i</em></p>
</div>
<div class="paragraph data-line-2854">
<p>+8495653923123431417604973247489272438418190587263600148770280649306958101930)</p>
</div>
<div class="paragraph data-line-2856">
<p>We define <em>G</em>2 to be the subgroup of (<em>C</em>2<em>,</em> +) generated by <em>P</em>2. <em>G</em>2 is known to be the only cyclic group of order <em>q</em> on <em>C</em>2. For a point <em>P</em> in <em>G</em>2, we define log<sub><em>P</em>2</sub> (<em>P</em> ) be the smallest natural number <em>n</em> satisfying <em>n</em> · <em>P</em>2 = <em>P</em> . With this definition, log<em>P</em>2 (<em>P</em> ) is at most <em>q</em> − 1.</p>
</div>
<div class="paragraph data-line-2858">
<p>Let <em>G<sub>T</sub></em> be the multiplicative abelian group underlying <em>F<sub>q</sub></em>12 . It is known that a non-degenerate bilinear map <em>e</em> : <em>G</em>1 × <em>G</em>2 → <em>GT</em> exists. This bilinear map is a type three pairing. There are several such bilinear maps, it does not matter which is chosen to be <em>e</em>. Let <em>PT</em> = <em>e</em>(<em>P</em>1<em>, P</em>2), <em>a</em> be a set of <em>k</em> points in <em>G</em>1, and <em>b</em> be a set of <em>k</em> points in <em>G</em>2. It follows from the definition of a pairing that the following are equivalent</p>
</div>
<div class="paragraph data-line-2860">
<p>(253)</p>
</div>
<div class="paragraph data-line-2862">
<p>(254)</p>
</div>
<div class="paragraph data-line-2864">
<p><span id="<em>bookmark124 " class="anchor">#</span>#log<em>P</em>1 (_a</em><sub>1</sub>) × log<em>P</em>2 (<em>b</em><sub>1</sub>) + · · · + log<em>P</em>1 (<em>a<sub>k</sub></em>) × log<em>P</em>2 (<em>b<sub>k</sub></em>) ≡ 1 mod <em>q</em></p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-2867">
<p><em>k</em></p>
</div>
<div class="quoteblock data-line-2869">
<blockquote>
<div class="paragraph data-line-2870">
<p><em>e</em> (<em>ai, bi</em>) = <em>PT</em></p>
</div>
<div class="paragraph data-line-2872">
<p><em>i</em>=0</p>
</div>
<div class="paragraph data-line-2874">
<p>Thus the pairing operation provides a method to verify <a href="#_bookmark124" data-href="#_bookmark124">(253).</a></p>
</div>
<div class="paragraph data-line-2876">
<p>A 32 byte number <strong>x</strong> ∈ <strong>P</strong>256 might and might not represent an element of <em>F</em>p.</p>
</div>
<div class="paragraph data-line-2878">
<p>(255) <em>δ</em> (<strong>x</strong>) ≡ f<strong>x</strong> if <strong>x</strong> <em>&lt; p</em></p>
</div>
<div class="paragraph data-line-2880">
<p>∅ otherwise</p>
</div>
<div class="paragraph data-line-2882">
<p>A 64 byte data <strong>x</strong> ∈ <strong>B</strong>512 might and might not represent an element of <em>G</em>1.</p>
</div>
<div class="paragraph data-line-2884">
<p>(256)</p>
</div>
<div class="paragraph data-line-2886">
<p><em>δ</em> (<strong>x</strong>) ≡ f<em>g</em>1 if <em>g</em>1 ∈ <em>G</em>1</p>
</div>
<div class="paragraph data-line-2888">
<p>(257)</p>
</div>
<div class="paragraph data-line-2890">
<p>∅ otherwise</p>
</div>
</blockquote>
</div>
<div class="olist loweralpha data-line-2894">
<ol class="loweralpha" type="a" start="7">
<li class="data-line-2894">
<p>(<em>x, y</em>) if <em>x</em> = ∅ ∧ <em>y</em> ∅</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-2896">
<blockquote>
<div class="paragraph data-line-2897">
<p>∅ otherwise</p>
</div>
<div class="paragraph data-line-2899">
<p>(258) <em>x</em> ≡ <em>δ</em>p(<strong>x</strong>[0<em>..</em>31])</p>
</div>
<div class="paragraph data-line-2901">
<p>(259) <em>y</em> ≡ <em>δ</em>p(<strong>x</strong>[32<em>..</em>63])</p>
</div>
<div class="paragraph data-line-2903">
<p>A 128 byte data <strong>x</strong> ∈ <strong>B</strong>1024 might and might not represent an element of <em>G</em>2.</p>
</div>
<div class="paragraph data-line-2905">
<p>(260)</p>
</div>
<div class="paragraph data-line-2907">
<p><em>δ</em> (<strong>x</strong>) ≡ f<em>g</em>2 if <em>g</em>2 ∈ <em>G</em>2</p>
</div>
<div class="paragraph data-line-2909">
<p>(261)</p>
</div>
<div class="paragraph data-line-2911">
<p>∅ otherwise</p>
</div>
<div class="paragraph data-line-2913">
<p><em>g</em> <em>x</em>0<em>i</em> + <em>y</em>0)<em>,</em> (<em>x</em>1<em>i</em> + <em>y</em>1 if <em>x</em>0 = ∅ ∧ <em>y</em>0 = ∅ ∧ <em>x</em>1</p>
</div>
<div class="paragraph data-line-2915">
<p>∅ otherwise</p>
</div>
<div class="paragraph data-line-2917">
<p>∅ ∧ <em>y</em>1 = ∅</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2921">
<colgroup>
<col style="width: 33%;">
<col style="width: 27%;">
<col style="width: 8%;">
<col style="width: 32%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
(262)
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em>x</em>0</th>
<th class="tableblock halign-left valign-top"><em><em>_
≡
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
</em>δ<em>p(<strong>x</strong>[0</em>..<em>31])
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(263)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>y</em>0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>δ</em>p(<strong>x</strong>[32<em>..</em>63])</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(264)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>x</em>1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>δ</em>p(<strong>x</strong>[64<em>..</em>95])</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(265)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>y</em>1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>δ</em>p(<strong>x</strong>[96<em>..</em>127])</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-2984">
<blockquote>
<div class="paragraph data-line-2985">
<p>We define ΞSNARKV as a precompiled contract which checks if <a href="#_bookmark124" data-href="#_bookmark124">(253)</a> holds, for intended use in zkSNARK verification.</p>
</div>
<div class="paragraph data-line-2987">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 25</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-2991">
<ol class="arabic" start="266">
<li class="data-line-2991">
<p>ΞSNARKV ≡ ΞPRE except:</p>
</li>
<li class="data-line-2992">
<p>ΞSNARKV(<em>*σ*, g, A, I</em>) = (∅<em>,</em> 0<em>, A,</em> ()) if <em>F</em></p>
</li>
<li class="data-line-2993">
<p></p>
</li>
<li class="data-line-2994">
<p></p>
</li>
<li class="data-line-2995">
<p></p>
</li>
<li class="data-line-2996">
<p></p>
</li>
<li class="data-line-2997">
<p></p>
</li>
<li class="data-line-2998">
<p></p>
</li>
<li class="data-line-2999">
<p></p>
</li>
<li class="data-line-3000">
<p></p>
</li>
<li class="data-line-3001">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3003">
<blockquote>
<div class="paragraph data-line-3004">
<p><em>F</em> ≡ (ll<em>I</em><strong><sub>d</sub></strong>ll mod 192 = 0 ∨ (∃<em>j. a</em><sub>j</sub> = ∅ ∨ <em>b</em><sub>j</sub> = ∅))</p>
</div>
<div class="paragraph data-line-3006">
<p><em>k</em> = ll__I__**~d~**ll</p>
</div>
<div class="paragraph data-line-3008">
<p>192</p>
</div>
<div class="paragraph data-line-3010">
<p><em>g</em>r = 34000<em>k</em> + 45000</p>
</div>
<div class="paragraph data-line-3012">
<p><strong>o</strong>[0<em>..</em>31] 0<em>x</em>0000000000000000000000000000000000000000000000000000000000000001 if <em>v</em> ∧ ¬<em>F</em></p>
</div>
<div class="paragraph data-line-3014">
<p>0<em>x</em>0000000000000000000000000000000000000000000000000000000000000000 if ¬<em>v</em> ∧ ¬<em>F</em></p>
</div>
<div class="paragraph data-line-3016">
<p><em>v</em> ≡ (log<em>P</em>1 (<em>a</em><sub>1</sub>) × log<em>P</em>2 (<em>b</em><sub>1</sub>) + · · · + log<em>P</em>1 (<em>a<sub>k</sub></em>) × log<em>P</em>2 (<em>b<sub>k</sub></em>) ≡ 1 mod <em>q</em>) <em>a</em><sub>1</sub> ≡ <em>δ</em><sub>1</sub>(<em>I</em>*<sub>d</sub>*[0<em>..</em>63])</p>
</div>
<div class="paragraph data-line-3018">
<p><em>b</em><sub>1</sub> ≡ <em>δ</em><sub>2</sub>(<em>I</em>*<sub>d</sub>*[64<em>..</em>191])</p>
</div>
<div class="paragraph data-line-3020">
<p>.</p>
</div>
<div class="paragraph data-line-3022">
<p><em>a<sub>k</sub></em> ≡ <em>δ</em><sub>1</sub>(<em>I</em>*<sub>d</sub>*[(ll<em>I</em><strong><sub>d</sub></strong>ll − 192)<em>..</em>(ll<em>I</em><strong><sub>d</sub></strong>ll − 129)])</p>
</div>
<div class="paragraph data-line-3024">
<p><em>b<sub>k</sub></em> ≡ <em>δ</em><sub>2</sub>(<em>I</em>*<sub>d</sub>*[(ll<em>I</em><strong><sub>d</sub></strong>ll − 128)<em>..</em>(ll<em>I</em><strong><sub>d</sub></strong>ll − 1)])</p>
</div>
<div class="paragraph data-line-3026">
<p>We define a precompiled contract for addition on <em>G</em>1.</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3030">
<ol class="arabic" start="277">
<li class="data-line-3030">
<p>(277)</p>
</li>
<li class="data-line-3031">
<p></p>
</li>
<li class="data-line-3032">
<p></p>
</li>
<li class="data-line-3033">
<p></p>
</li>
<li class="data-line-3034">
<p></p>
</li>
<li class="data-line-3035">
<p></p>
</li>
<li class="data-line-3036">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3038">
<blockquote>
<div class="paragraph data-line-3039">
<p><span id="_bookmark125 " class="anchor">#</span>#ΞBN ADD ≡ ΞBN PRE except:</p>
</div>
<div class="paragraph data-line-3041">
<p>ΞBN ADD(<em>*σ*, g, A, I</em>) = (∅<em>,</em> 0<em>, A,</em> ()) if <em>x</em> = ∅ ∨ <em>y</em> = ∅</p>
</div>
<div class="paragraph data-line-3043">
<p><em>g</em>r = 150</p>
</div>
<div class="paragraph data-line-3045">
<p><strong>o</strong> ≡ <em>δ</em>−1(<em>x</em> + <em>y</em>) where + is the group operation in <em>G</em>1 <em>x δ</em><sub>1</sub> <em>I</em>¯<strong>d</strong>[0<em>..</em>63]</p>
</div>
<div class="paragraph data-line-3047">
<p><em>y</em> ≡ <em>δ</em><sub>1</sub> <em>I</em>¯<strong>d</strong>[64<em>..</em>127]</p>
</div>
<div class="paragraph data-line-3049">
<p><strong>d</strong></p>
</div>
<div class="paragraph data-line-3051">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-3053">
<p>We define a precompiled contract for scalar multiplication on <em>G</em><sub>1</sub>, where <em>I</em>¯<strong>d</strong> is defined in <a href="#_bookmark125" data-href="#_bookmark125">(283).</a></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3057">
<ol class="arabic" start="284">
<li class="data-line-3057">
<p></p>
</li>
<li class="data-line-3058">
<p></p>
</li>
<li class="data-line-3059">
<p></p>
</li>
<li class="data-line-3060">
<p></p>
</li>
<li class="data-line-3061">
<p></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3063">
<blockquote>
<div class="paragraph data-line-3064">
<p>ΞBN MUL ≡ ΞPRE except:</p>
</div>
<div class="paragraph data-line-3066">
<p>ΞBN MUL(<em>*σ*, g, A, I</em>) = (∅<em>,</em> 0<em>, A,</em> ()) if <em>x</em> = ∅</p>
</div>
<div class="paragraph data-line-3068">
<p><em>g</em>r = 6000</p>
</div>
<div class="paragraph data-line-3070">
<p><strong>o</strong> ≡ <em>δ</em>−1(<em>n</em> · <em>x</em>) where · is the scalar multiplication in <em>G</em>1 <em>x</em> ≡ <em>δ</em><sub>1</sub> <em>I</em>¯<strong>d</strong>[0<em>..</em>63]</p>
</div>
<div class="paragraph data-line-3072">
<p>(289) <em>n</em> ≡ <em>I</em>¯<strong>d</strong>[64<em>..</em>95]</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3076">
<ol class="arabic">
<li class="data-line-3076">
<p><strong>BLAKE2 Precompiled Contract.</strong> EIP-152 by <a href="#_bookmark104" data-href="#_bookmark104">Hess et al.</a> <a href="#_bookmark104" data-href="#_bookmark104">[2016</a>] defines ΞBLAKE2 F as a precompiled contract implementing the compression function F used in the BLAKE2 cryptographic hashing algorithm. The F compression function is specified in RFC 7693 by <a href="#_bookmark92" data-href="#_bookmark92">Saarinen and Aumasson [2015</a>.]</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3078">
<blockquote>
<div class="paragraph data-line-3079">
<p>(290)</p>
</div>
<div class="paragraph data-line-3081">
<p>(291)</p>
</div>
<div class="paragraph data-line-3083">
<p>(292)</p>
</div>
<div class="paragraph data-line-3085">
<p>(293)</p>
</div>
<div class="paragraph data-line-3087">
<p>ΞBLAKE2 F ≡ ΞPRE except:</p>
</div>
<div class="paragraph data-line-3089">
<p>Ξ<sub>BLAKE2</sub> <sub>F</sub>(<em>*σ*, g, A, I</em>) = (∅<em>,</em> 0<em>, A,</em> ()) if ll<em>I</em><strong><sub>d</sub></strong>ll =</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-3092">
<p><em>g</em>r = <em>r</em></p>
</div>
<div class="quoteblock data-line-3094">
<blockquote>
<div class="paragraph data-line-3095">
<p><strong>o</strong> ≡ LE<sub>8</sub>(<em>h</em><sub>0</sub>) · <em>&#8230;&#8203;</em> · LE<sub>8</sub>(<em>h</em><sub>7</sub>)</p>
</div>
<div class="paragraph data-line-3097">
<p>213 ∨ <em>f</em> ∈<em>/</em> \{0<em>,</em> 1}</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-3101">
<colgroup>
<col style="width: 20%;">
<col style="width: 25%;">
<col style="width: 5%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
(294)
</em>_</em></th>
<th class="tableblock halign-left valign-top">(<em>h</em><sub>0</sub><em>, . . . , h</em><sub>7</sub>)</th>
<th class="tableblock halign-left valign-top"><em><em>_
≡
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
F(_h, m, t</em><sub>low</sub><em>, t</em><sub>high</sub><em>, f</em> ) with <em>r</em> rounds and <em>w</em> = 64
</em>__</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(295)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BE4(<em>r</em>)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[0<em>..</em>4]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(296)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE8(<em>h</em>0)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[4<em>..</em>12]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(297)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>. . .</em></p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(298)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE8(<em>h</em>7)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[60<em>..</em>68]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(299)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE8(<em>m</em>0)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[68<em>..</em>76]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(300)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>. . .</em></p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(301)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE8(<em>m</em>15)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[188<em>..</em>196]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(302)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE<sub>8</sub>(<em>t</em><sub>low</sub>)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[196<em>..</em>204]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(303)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE8(<em>t</em>high)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[204<em>..</em>212]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(304)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>f</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>≡</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>I</em>*<sub>d</sub>*[212]</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-3261">
<blockquote>
<div class="paragraph data-line-3262">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 26</p>
</div>
<div class="paragraph data-line-3264">
<p>where <em>r</em> ∈ B<sub>32</sub>, ∀<em>i</em> ∈ 0<em>..</em>7 : <em>h<sub>i</sub></em> ∈ B<sub>64</sub>, ∀<em>i</em> ∈ 0<em>..</em>15 : <em>m<sub>i</sub></em> ∈ B<sub>64</sub>, <em>t</em><sub>low</sub> ∈ B<sub>64</sub>, <em>t</em><sub>high</sub> ∈ B<sub>64</sub>, <em>f</em> ∈ B<sub>8</sub>, BE<em><sub>k</sub></em> is the <em>k</em>-byte big-endian representation—compare <a href="#_bookmark115" data-href="#_bookmark115">with(193):</a></p>
</div>
<div class="paragraph data-line-3266">
<p><em>k</em>−1</p>
</div>
<div class="paragraph data-line-3268">
<p>(305) BE<em><sub>k</sub></em>(<em>x</em>) ≡ (<em>b</em><sub>0</sub><em>, b</em><sub>1</sub><em>, &#8230;&#8203;, b<sub>k</sub></em><sub>−1</sub>) : <em>x</em> = <em>b<sub>n</sub></em> · 256 <sup>−</sup> <sup>−</sup></p>
</div>
<div class="paragraph data-line-3270">
<p><em>n</em>=0</p>
</div>
<div class="paragraph data-line-3272">
<p>and LE<em><sub>k</sub></em> is the <em>k</em>-byte little-endian representation:</p>
</div>
<div class="paragraph data-line-3274">
<p><em>k</em>−1</p>
</div>
<div class="paragraph data-line-3276">
<p>(306) LE<em><sub>k</sub></em>(<em>x</em>) ≡ (<em>b</em><sub>0</sub><em>, b</em><sub>1</sub><em>, &#8230;&#8203;, b<sub>k</sub></em><sub>−1</sub>) : <em>x</em> = <em>b<sub>n</sub></em> · 256<em><sup>n</sup></em></p>
</div>
<div class="paragraph data-line-3278">
<p><em>n</em>=0</p>
</div>
<div class="paragraph data-line-3280">
<p><span id="Appendix_F" class="_Signing_Transactions  anchor">#</span>#Appendix F. Signing Transactions</p>
</div>
<div class="paragraph data-line-3282">
<p>Transactions are signed using recoverable ECDSA signatures. This method utilises the SECP-256k1 curve as described by <a href="#_bookmark84" data-href="#_bookmark84">Courtois et al. [2014</a>,] and is implemented similarly to as described by <a href="#_bookmark99" data-href="#_bookmark99">Gura et al.</a> [<a href="#_bookmark99" data-href="#_bookmark99">2004</a>] on p. 9 of 15, para. 3.</p>
</div>
<div class="paragraph data-line-3284">
<p>It is assumed that the sender has a valid private key <em>p</em>r, which is a randomly selected positive integer (represented as a byte array of length 32 in big-endian form) in the range [1<em>,</em> secp256k1n − 1].</p>
</div>
<div class="paragraph data-line-3286">
<p>We assume the existence of functions ECDSAPUBKEY, ECDSASIGN and ECDSARECOVER. These are formally defined in the</p>
</div>
<div class="paragraph data-line-3288">
<p>literature, e.g. by <a href="#_bookmark108" data-href="#_bookmark108">Johnson et al. [2001</a>.]</p>
</div>
<div class="paragraph data-line-3290">
<p>(307)</p>
</div>
<div class="paragraph data-line-3292">
<p>(308)</p>
</div>
<div class="paragraph data-line-3294">
<p>(309)</p>
</div>
<div class="paragraph data-line-3296">
<p>ECDSAPUBKEY(<em>p</em>r ∈ B32) ≡ <em>p</em>u ∈ B64</p>
</div>
<div class="paragraph data-line-3298">
<p>ECDSASIGN(<em>e</em> ∈ B32<em>, p</em>r ∈ B32) ≡ (<em>v</em> ∈ B1<em>, r</em> ∈ B32<em>, s</em> ∈ B32)</p>
</div>
<div class="paragraph data-line-3300">
<p>ECDSARECOVER(<em>e</em> ∈ B32<em>, v</em> ∈ B1<em>, r</em> ∈ B32<em>, s</em> ∈ B32) ≡ <em>p</em>u ∈ B64</p>
</div>
<div class="paragraph data-line-3302">
<p>Where <em>p</em>u is the public key, assumed to be a byte array of size 64 (formed from the concatenation of two positive integers each <em>&lt;</em> 2<sup>256</sup>), <em>p</em>r is the private key, a byte array of size 32 (or a single positive integer in the aforementioned range) and <em>e</em> is the hash of the transaction, <a href="#<em>bookmark130" data-href="#<em>bookmark130">_h</em>(<em>T</em></a> ). It is assumed that [<mark><em>bookmark127 .anchor]</mark>#_v</em> is the ‘recovery identifier’. The recovery identifier</p>
</div>
<div class="paragraph data-line-3304">
<p>is a 1 byte value specifying the parity and finiteness of the coordinates of the curve point for which <em>r</em> is the x-value; this value is in the range of [0<em>,</em> 3], however we declare the upper two possibilities, representing infinite values, invalid. The value 0 represents an even <em>y</em> value and 1 represents an odd <em>y</em> value.</p>
</div>
<div class="paragraph data-line-3306">
<p>We declare that an ECDSA signature is invalid unless all the following conditions are true:</p>
</div>
<div class="paragraph data-line-3308">
<p>(310)</p>
</div>
<div class="paragraph data-line-3310">
<p>(311)</p>
</div>
<div class="paragraph data-line-3312">
<p>(312)</p>
</div>
<div class="paragraph data-line-3314">
<p>where: (313)</p>
</div>
<div class="paragraph data-line-3316">
<p>0 <em>&lt;</em><span id="<em>bookmark128 " class="anchor"> [#_bookmark129 .anchor]</span>_r &lt;</em> secp256k1n</p>
</div>
<div class="paragraph data-line-3318">
<p>0 <em>&lt; s &lt;</em> secp256k1n ÷ 2 + 1</p>
</div>
<div class="paragraph data-line-3320">
<p><a href="#<em>bookmark127" data-href="#<em>bookmark127">_v</em></a> ∈ \{0<em>,</em> 1}</p>
</div>
<div class="paragraph data-line-3322">
<p>secp256k1n = 115792089237316195423570985008687907852837564279074904382605163141518161494337</p>
</div>
<div class="paragraph data-line-3324">
<p>For a given private key, <em>p</em>r, the Ethereum address <em>A</em>(<em>p</em>r) (a 160-bit value) to which it corresponds is defined as the rightmost 160-bits of the Keccak-256 hash of the corresponding ECDSA public key:</p>
</div>
<div class="paragraph data-line-3326">
<p>(314) <em>A</em>(<em>p</em>r) = <span id="_bookmark130 " class="anchor">#</span>#B96<em>..</em>255 KEC ECDSAPUBKEY(<em>p</em>r)</p>
</div>
<div class="paragraph data-line-3328">
<p>The message hash, <em>h</em>(<em>T</em> ), to be signed is the Keccak-256 hash of the transaction. Three different flavours of signing schemes are available:</p>
</div>
<div class="paragraph data-line-3330">
<p>(315)</p>
</div>
<div class="paragraph data-line-3332">
<p><em>L</em>X(<em>T</em> ) ≡</p>
</div>
<div class="paragraph data-line-3334">
<p>where</p>
</div>
<div class="paragraph data-line-3336">
<p>(<em>T</em>n<em>, T</em>p<em>, T</em>g<em>, T</em>t<em>, T</em>v<em>,</em> <strong>p</strong>) if <em>T</em>x = 0 ∧ <em>T</em>w ∈ \{27<em>,</em> 28}</p>
</div>
<div class="paragraph data-line-3338">
<p>(<em>T</em>n<em>, T</em>p<em>, T</em>g<em>, T</em>t<em>, T</em>v<em>,</em> *p*<em>, β,</em> ()<em>,</em> ()) if <em>T</em>x = 0 ∧ <em>T</em>w ∈ \{2<em>β</em> + 35<em>,</em> 2<em>β</em> + 36}</p>
</div>
<div class="paragraph data-line-3340">
<p>(<em>T</em><sub>c</sub><em>, T</em><sub>n</sub><em>, T</em><sub>p</sub><em>, T</em><sub>g</sub><em>, T</em><sub>t</sub><em>, T</em><sub>v</sub><em>,</em> <strong>p*<em>, T</em></strong><sub>A</sub>*) if <em>T</em><sub>x</sub> = 1</p>
</div>
<div class="paragraph data-line-3342">
<p>(316)</p>
</div>
<div class="paragraph data-line-3344">
<p><strong>p</strong> <em>T</em>*<sub>i</sub>* if <em>T</em><sub>t</sub> = ∅</p>
</div>
<div class="paragraph data-line-3346">
<p><em>T</em>*<sub>d</sub>* otherwise</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-3349">
<p><em>h</em>(<em>T</em> ) KEC(RLP(<em>L</em>X(<em>T</em> ))) if <em>T</em>x = 0</p>
</div>
<div class="paragraph data-line-3351">
<p>KEC(<em>T</em>x · RLP(<em>L</em>X(<em>T</em> ))) otherwise</p>
</div>
<div class="quoteblock data-line-3353">
<blockquote>
<div class="paragraph data-line-3354">
<p>The signed transaction <em>G</em>(<em>T, p</em>r) is defined as: (317)</p>
</div>
<div class="paragraph data-line-3356">
<p><em>G</em>(<em>T, p</em>r) ≡ <em>T</em> except:</p>
</div>
<div class="paragraph data-line-3358">
<p>(318)</p>
</div>
<div class="paragraph data-line-3360">
<p><a href="#_bookmark8" data-href="#_bookmark8">Reiterating from previously:</a> (319)</p>
</div>
<div class="paragraph data-line-3362">
<p>(320)</p>
</div>
<div class="paragraph data-line-3364">
<p>(<em>T</em>y<em>, T</em>r<em>, T</em>s) = ECDSASIGN(<em>h</em>(<em>T</em> )<em>, p</em>r)</p>
</div>
<div class="paragraph data-line-3366">
<p><em>T</em>r = <em><a href="#<em>bookmark128" data-href="#<em>bookmark128">r</a> T</em>s = <a href="#_bookmark129" data-href="#_bookmark129">_s</em></a></p>
</div>
<div class="paragraph data-line-3368">
<p>and <a href="#<em>bookmark11" data-href="#<em>bookmark11"><em>T</em>w</a> of legacy transcations is either 27 + <em>T</em>y or 2<a href="#_bookmark1" data-href="#_bookmark1">_β</em></a> + 35 + <em>T</em>y.</p>
</div>
<div class="paragraph data-line-3370">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 27</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-3374">
<colgroup>
<col style="width: 17%;">
<col style="width: 83%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
We may then define the sender function _S</em> of the transaction as:
</em>__</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(321)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>S</em>(<em>T</em> ) ≡ B96<em>..</em>255 KEC ECDSARECOVER(<em>h</em>(<em>T</em> )<em>, v, T</em>r<em>, T</em>s)</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(322)</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>T</em>w − 27 if <em>T</em>x = 0 ∧ <em>T</em>w ∈ \{27<em>,</em> 28}</p>
</div>
<div class="paragraph">
<p><em>v</em> ≡ (<em>T</em>w − 35) mod 2 if <em>T</em>x = 0 ∧ <em>T</em>w ∈ \{2<em>β</em> + 35<em>,</em> 2<em>β</em> + 36}</p>
</div>
<div class="paragraph">
<p><em>T</em>y if <em>T</em>x = 1</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The assertion that the sender of a signed transaction equals the address of the signer should be self-evident:</p>
</div>
<div class="paragraph">
<p>(323) ∀<em>T</em> : ∀<em>p</em>r : <em>S</em>(<em>G</em>(<em>T, p</em>r)) ≡ <em>A</em>(<em>p</em>r)</p>
</div>
<div class="paragraph">
<p><span id="Appendix_G" class="_Fee_Schedule  anchor">#</span>#Appendix G. Fee Schedule</p>
</div>
<div class="paragraph">
<p>The fee schedule <em>G</em> is a tuple of scalar values corresponding to the relative costs, in gas, of a number of abstract operations that a transaction may effect.</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-3420">
<colgroup>
<col style="width: 16%;">
<col style="width: 6%;">
<col style="width: 78%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
Name
</em>_</em></th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top"><em><em>_
Description
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>zero</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Nothing paid for operations of the set <em>W</em>zero.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>jumpdest</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for a JUMPDEST operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>base</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for operations of the set <em>W</em><sub>base</sub>.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>verylow</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for operations of the set <em>W</em><sub>verylow</sub>.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>low</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for operations of the set <em>W</em><sub>low</sub>.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>mid</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for operations of the set <em>W</em><sub>mid</sub>.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>high</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for operations of the set <em>W</em><sub>high</sub>.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>warmaccess</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cost of a warm account or storage access.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark132 .anchor]</mark>#<em>G</em>accesslistaddress</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2400</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cost of warming up an account with the access list.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark133 .anchor]</mark>#<em>G</em>accessliststorage</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1900</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cost of warming up a storage with the access list.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>coldaccountaccess</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2600</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cost of a cold account access.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>coldsload</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cost of a cold storage access.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>sset</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for an SSTORE operation when the storage value is set to non-zero from zero.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>sreset</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2900</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for an SSTORE operation when the storage value’s zeroness remains unchanged or is set to zero.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>R</em>sclear</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Refund given (added into refund counter) when the storage value is set to zero from</p>
</div>
<div class="paragraph">
<p>non-zero.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>R</em>selfdestruct</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Refund given (added into refund counter) for self-destructing an account.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>selfdestruct</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amount of gas to pay for a SELFDESTRUCT operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>create</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for a CREATE operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>codedeposit</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid per byte for a CREATE operation to succeed in placing code into state.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>callvalue</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for a non-zero value transfer as part of the CALL operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark134 .anchor]</mark>#<em>G</em>callstipend</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2300</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A stipend for the called contract subtracted from <em>G</em><sub>callvalue</sub> for a non-zero value transfer.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>newaccount</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for a CALL or SELFDESTRUCT operation which creates an account.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>exp</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Partial payment for an EXP operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>expbyte</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Partial payment when multiplied by the number of bytes in the exponent for the EXP operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>memory</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for every additional word when expanding memory.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark135 .anchor]</mark>#<em>G</em>txcreate</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid by all contract-creating transactions after the <em>Homestead</em> transition.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark136 .anchor]</mark>#<em>G</em>txdatazero</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for every zero byte of data or code for a transaction.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark137 .anchor]</mark>#<em>G</em>txdatanonzero</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for every non-zero byte of data or code for a transaction.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[<mark>_bookmark138 .anchor]</mark>#<em>G</em>transaction</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21000</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for every transaction.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>log</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">375</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Partial payment for a LOG operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>logdata</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for each byte in a LOG operation’s data.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>logtopic</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">375</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for each topic of a LOG operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>keccak256</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for each KECCAK256 operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>keccak256word</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Paid for each word (rounded up) for input data to a KECCAK256 operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>copy</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Partial payment for *COPY operations, multiplied by words copied, rounded up.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>G</em>blockhash</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Payment for each BLOCKHASH operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-3795">
<blockquote>
<div class="paragraph data-line-3796">
<p><span id="Appendix_H" class="_Virtual_Machine_Specificatio  anchor">#</span>#Appendix H. Virtual Machine Specification</p>
</div>
<div class="paragraph data-line-3798">
<p>When interpreting 256-bit binary values as integers, the representation is big-endian.</p>
</div>
<div class="paragraph data-line-3800">
<p>When a 256-bit machine datum is converted to and from a 160-bit address or hash, the rightwards (low-order for BE) 20 bytes are used and the leftmost 12 are discarded or filled with zeroes, thus the integer values (when the bytes are interpreted as big-endian) are equivalent.</p>
</div>
<div class="paragraph data-line-3802">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 28</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3806">
<ol class="arabic">
<li class="data-line-3806">
<p><strong>Gas Cost.</strong> The general gas cost function, <em>C</em>, is defined as:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3808">
<blockquote>
<div class="paragraph data-line-3809">
<p>(324)</p>
</div>
<div class="paragraph data-line-3811">
<p><em>C</em>(<em>*σ*, <strong>µ</strong>, A, I</em>) ≡ <em>C</em>mem(<strong><em>µ</em></strong>i) − <em>C</em>mem(<strong><em>µ</em></strong><sub>i</sub>)<br></p>
</div>
<div class="paragraph data-line-3813">
<p><em>C</em>SSTORE(<em>*σ*, <strong>µ</strong>, A, I</em>) if <em>w</em> = SSTORE</p>
</div>
<div class="paragraph data-line-3815">
<p><em>G</em>exp if <em>w</em> = EXP ∧ <strong><em>µ</em><sub>s</sub></strong>[1] = 0</p>
</div>
<div class="paragraph data-line-3817">
<p><em>G</em><sub>exp</sub> + <em>G</em><sub>expbyte</sub> × (1 + llog256(<strong><em>µ</em>s</strong>[1])J) if <em>w</em> = EXP ∧ <strong><em>µ</em>s</strong>[1] <em>&gt;</em> 0 <em>G</em><sub>verylow</sub> + <em>G</em><sub>copy</sub> × r<strong><em>µ</em>s</strong>[2] ÷ 321 if <em>w</em> ∈ <em>W</em><sub>copy</sub> <em>C</em>aaccess(<strong><em>µ</em><sub>s</sub></strong>[0] mod 2<sup>160</sup><em>, A</em>) + <em>G</em>copy × r<strong><em>µ</em><sub>s</sub></strong>[3] ÷ 321 if <em>w</em> = EXTCODECOPY <em>C</em>aaccess(<strong><em>µ</em>s</strong>[0] mod 2160<em>, A</em>) if <em>w</em> ∈ <em>W</em>extaccount</p>
</div>
<div class="paragraph data-line-3819">
<p><em>G</em><sub>log</sub> + <em>G</em><sub>logdata</sub> × <strong><em>µ</em>s</strong>[1] if <em>w</em> = LOG0</p>
</div>
<div class="paragraph data-line-3821">
<p><em>G</em>log + <em>G</em>logdata × <strong><em>µ</em>s</strong>[1] + <em>G</em>logtopic if <em>w</em> = LOG1</p>
</div>
<div class="paragraph data-line-3823">
<p><em>G</em>log + <em>G</em>logdata × <strong><em>µ</em>s</strong>[1] + 2<em>G</em>logtopic if <em>w</em> = LOG2</p>
</div>
<div class="paragraph data-line-3825">
<p><em>G</em>log + <em>G</em>logdata × <strong><em>µ</em>s</strong>[1] + 3<em>G</em>logtopic if <em>w</em> = LOG3</p>
</div>
<div class="paragraph data-line-3827">
<p><em>G</em>log + <em>G</em>logdata × <strong><em>µ</em>s</strong>[1] + 4<em>G</em>logtopic if <em>w</em> = LOG4</p>
</div>
<div class="paragraph data-line-3829">
<p><em>C</em><sub>CALL</sub>(<em>*σ*, <strong>µ</strong>, A</em>) if <em>w</em> ∈ <em>W</em><sub>call</sub></p>
</div>
<div class="paragraph data-line-3831">
<p><em>C</em>SELFDESTRUCT(<em>*σ*, *µ*</em>) if <em>w</em> = SELFDESTRUCT</p>
</div>
<div class="paragraph data-line-3833">
<p><em>G</em>create if <em>w</em> = CREATE</p>
</div>
<div class="paragraph data-line-3835">
<p><em>G</em>create + <em>G</em>keccak256word × r<strong><em>µ</em>s</strong>[2] ÷ 321 if <em>w</em> = <a href="#<em>bookmark150" data-href="#<em>bookmark150">CREATE2</a> <em>G</em>keccak256 + <em>G</em>keccak256word × r<strong><em>µ</em>s</strong>[1] ÷ 321 if _w</em> = KECCAK256 <em>G</em>jumpdest if <em>w</em> = JUMPDEST</p>
</div>
<div class="paragraph data-line-3837">
<p><em>C</em>SLOAD(<em>*µ*, A, I</em>) if <em>w</em> = SLOAD</p>
</div>
<div class="paragraph data-line-3839">
<p><em>G</em>zero if <em>w</em> ∈ <em>W</em>zero</p>
</div>
<div class="paragraph data-line-3841">
<p><em>G</em>base if <em>w</em> ∈ <em>W</em>base</p>
</div>
<div class="paragraph data-line-3843">
<p><em>G</em>verylow if <em>w</em> ∈ <em>W</em>verylow</p>
</div>
<div class="paragraph data-line-3845">
<p><em>G</em>low if <em>w</em> ∈ <em>W</em>low</p>
</div>
<div class="paragraph data-line-3847">
<p><em>G</em>mid if <em>w</em> ∈ <em>W</em>mid</p>
</div>
<div class="paragraph data-line-3849">
<p><em>G</em>high if <em>w</em> ∈ <em>W</em>high</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-3852">
<p><em>G</em>blockhash if <em>w</em> = <a href="#_bookmark144" data-href="#_bookmark144">BLOCKHASH</a></p>
</div>
<div class="olist arabic data-line-3855">
<ol class="arabic" start="325">
<li class="data-line-3855">
<p><em>w I</em>*<sub>b</sub>*[<strong><em>µ</em></strong>pc] if <strong><em>µ</em></strong>pc <em>&lt;</em> ll<em>I</em><strong><sub>b</sub></strong>ll</p>
</li>
</ol>
</div>
<div class="paragraph data-line-3857">
<p>STOP otherwise</p>
</div>
<div class="quoteblock data-line-3859">
<blockquote>
<div class="paragraph data-line-3860">
<p>where:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3864">
<ol class="arabic" start="326">
<li class="data-line-3864">
<p><em>C</em>mem(<em>a</em>) ≡ <em>G</em>memory · <em>a</em><br></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3866">
<blockquote>
<div class="paragraph data-line-3867">
<p><em>a</em>2</p>
</div>
<div class="paragraph data-line-3869">
<p>512</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3873">
<ol class="arabic" start="327">
<li class="data-line-3873">
<p>[<mark><em>bookmark140 .anchor]</mark>#_C</em></p>
</li>
</ol>
</div>
<div class="paragraph data-line-3875">
<p>aaccess</p>
</div>
<div class="paragraph data-line-3877">
<p>(<em>x, A</em>) <em>G</em>warmaccess if <em>x</em> ∈ <a href="#<em>bookmark39" data-href="#<em>bookmark39">_A</em>*a*</a> <em>G</em>coldaccountaccess otherwise</p>
</div>
<div class="quoteblock data-line-3879">
<blockquote>
<div class="paragraph data-line-3880">
<p>with <em>C</em>CALL, <em>C</em>SELFDESTRUCT, <em>C</em>SLOAD and <em>C</em>SSTORE as specified in the appropriate section below. We define the following subsets of instructions:</p>
</div>
<div class="paragraph data-line-3882">
<p><em>W</em>zero = \{STOP, RETURN, REVERT}</p>
</div>
<div class="paragraph data-line-3884">
<p><em>W</em><sub>base</sub> = \{ADDRESS, ORIGIN, CALLER, CALLVALUE, CALLDATASIZE, CODESIZE, GASPRICE, COINBASE, TIMESTAMP, NUMBER, DIFFICULTY, GASLIMIT, CHAINID, RETURNDATASIZE, POP, PC, MSIZE, GAS}</p>
</div>
<div class="paragraph data-line-3886">
<p><em>W</em><sub>verylow</sub> = \{ADD, SUB, NOT, LT, GT, SLT, SGT, EQ, ISZERO, AND, OR, XOR, BYTE, SHL, SHR, SAR, CALLDATALOAD, MLOAD, MSTORE, MSTORE8, PUSH*, DUP*, SWAP*}</p>
</div>
<div class="paragraph data-line-3888">
<p><em>W</em><sub>low</sub> = \{MUL, DIV, SDIV, MOD, SMOD, SIGNEXTEND, SELFBALANCE}</p>
</div>
<div class="paragraph data-line-3890">
<p><em>W</em><sub>mid</sub> = \{ADDMOD, MULMOD, JUMP}</p>
</div>
<div class="paragraph data-line-3892">
<p><em>W</em><sub>high</sub> = {JUMPI}</p>
</div>
<div class="paragraph data-line-3894">
<p><em>W</em>copy = \{CALLDATACOPY, CODECOPY, RETURNDATACOPY} <em>W</em><sub>call</sub> = \{CALL, CALLCODE, DELEGATECALL, STATICCALL} <em>W</em>extaccount = \{BALANCE, EXTCODESIZE, EXTCODEHASH}</p>
</div>
<div class="paragraph data-line-3896">
<p>Note the memory cost component, given as the product of <em>G</em>memory and the maximum of 0 &amp; the ceiling of the number of words in size that the memory must be over the current number of words, <strong><em>µ</em></strong>i in order that all accesses reference valid memory whether for read or write. Such accesses must be for non-zero number of bytes.</p>
</div>
<div class="paragraph data-line-3898">
<p>Referencing a zero length range (e.g. by attempting to pass it as the input range to a CALL) does not require memory to be extended to the beginning of the range. <strong><em>µ</em></strong>i is defined as this new maximum number of words of active memory; special-cases are given where these two are not equal.</p>
</div>
<div class="paragraph data-line-3900">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 29</p>
</div>
<div class="paragraph data-line-3902">
<p>Note also that <em>C</em>mem is the memory cost function (the expansion function being the difference between the cost before and after). It is a polynomial, with the higher-order coefficient divided and floored, and thus linear up to 724B of memory used, after which it costs substantially more.</p>
</div>
<div class="paragraph data-line-3904">
<p>While defining the instruction set, we defined the memory-expansion for range function, <em>M</em> , thus:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3908">
<ol class="arabic" start="328">
<li class="data-line-3908">
<p><em>M</em> (<em>s, f, l</em>) <em>s</em> if <em>l</em> = 0 max(<em>s,</em> r(<em>f</em> + <em>l</em>) ÷ 321) otherwise</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3910">
<blockquote>
<div class="paragraph data-line-3911">
<p>Another useful function is “all but one 64th” function <em>L</em> defined as:</p>
</div>
<div class="paragraph data-line-3913">
<p>(329) [<mark><em>bookmark141 .anchor]</mark>#_L</em>(<em>n</em>) ≡ <em>n</em> − l<em>n/</em>64J</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-3917">
<ol class="arabic">
<li class="data-line-3917">
<p>[<mark>H.2.<em>Instruction_Set .anchor]</mark>#<strong>Instruction Set.</strong> As previously specified in section <a href="#9._Execution_Model" data-href="#9._Execution_Model">9,</a> these definitions take place in the final context there. In particular we assume _O</em> is the EVM state-progression function and define the terms pertaining to the next cycle’s state (<em>*σ* , *µ *</em>) such that:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-3919">
<blockquote>
<div class="paragraph data-line-3920">
<p>(330) <em>O</em>(<em>*σ*, <strong>µ</strong>, A, I</em>) ≡ (<em>*σ* , <strong>µ</strong> , A , I</em>) with exceptions, as noted</p>
</div>
<div class="paragraph data-line-3922">
<p>Here given are the various exceptions to the state transition rules given in section <a href="#9.<em>Execution_Model" data-href="#9.<em>Execution_Model">9</a> specified for each instruction, together with the additional instruction-specific definitions of _J</em> and <em>C</em>. For each instruction, also specified is <em>α</em>, the additional items placed on the stack and <em>δ</em>, the items removed from stack, as defined in section <a href="#9._Execution_Model" data-href="#9._Execution_Model">9.</a></p>
</div>
<div class="paragraph data-line-3924">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 30</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-3927">
<h2 id="_0s_stop_and_arithmetic_operations">0s: Stop and Arithmetic Operations</h2>
<div class="sectionbody">
<div class="quoteblock data-line-3929">
<blockquote>
<div class="paragraph data-line-3930">
<p>All arithmetic is modulo 2<sup>256</sup> unless otherwise noted. The zero-th power of zero 0<sup>0</sup> is defined to be one.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-3933">
<h2 id="_value_mnemonic_δ_α_description">Value Mnemonic <em>δ α</em> Description</h2>
<div class="sectionbody">
<div class="quoteblock data-line-3935">
<blockquote>
<div class="paragraph data-line-3936">
<p><span id="_bookmark143 " class="anchor">#</span>#0x00 STOP 0 0 Halts execution.</p>
</div>
<div class="paragraph data-line-3938">
<p>0x01 ADD 2 1 Addition operation.</p>
</div>
<div class="paragraph data-line-3940">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[0] + <strong><em>µ</em>s</strong>[1]</p>
</div>
<div class="paragraph data-line-3942">
<p>0x02 MUL 2 1 Multiplication operation.</p>
</div>
<div class="paragraph data-line-3944">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[0] × <strong><em>µ</em>s</strong>[1]</p>
</div>
<div class="paragraph data-line-3946">
<p>0x03 SUB 2 1 Subtraction operation.</p>
</div>
<div class="paragraph data-line-3948">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[0] − <strong><em>µ</em>s</strong>[1]</p>
</div>
<div class="paragraph data-line-3950">
<p>0x04 DIV 2 1 Integer division operation.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-3953">
<p>0 if <strong><em>µ</em>s</strong>[1] = 0</p>
</div>
<div class="quoteblock data-line-3955">
<blockquote>
<div class="paragraph data-line-3956">
<p><strong>s</strong></p>
</div>
<div class="paragraph data-line-3958">
<p>l<strong><em>µ</em>s</strong>[0] ÷ <strong><em>µ</em>s</strong>[1]J otherwise</p>
</div>
<div class="paragraph data-line-3960">
<p>0x05 SDIV 2 1 Signed integer division operation (truncated).</p>
</div>
<div class="paragraph data-line-3962">
<p><strong>sgn</strong>(<strong><em>µ</em>s</strong>[0] ÷ <strong><em>µ</em>s</strong>[1])l|<strong><em>µ</em>s</strong>[0] ÷ <strong><em>µ</em>s</strong>[1]|J otherwise</p>
</div>
<div class="paragraph data-line-3964">
<p>Where all values are treated as two’s complement signed 256-bit integers. Note the overflow semantic when −2<sup>255</sup> is negated.</p>
</div>
<div class="paragraph data-line-3966">
<p>0x06 MOD 2 1 Modulo remainder operation.</p>
</div>
<div class="paragraph data-line-3968">
<p><strong><em>µ</em></strong> [0] ≡ 0 if <strong><em>µ</em>s</strong>[1] = 0</p>
</div>
<div class="paragraph data-line-3970">
<p>0x07 SMOD 2 1 Signed modulo remainder operation.</p>
</div>
<div class="paragraph data-line-3972">
<p><strong><em>µ</em></strong> [0] ≡ 0 if <strong><em>µ</em>s</strong>[1] = 0</p>
</div>
<div class="paragraph data-line-3974">
<p><strong>sgn</strong>(<strong><em>µ</em></strong> [0])(|<strong><em>µ</em></strong> [0]| mod |<strong><em>µ</em></strong> [1]|) otherwise</p>
</div>
<div class="paragraph data-line-3976">
<p>Where all values are treated as two’s complement signed 256-bit integers.</p>
</div>
<div class="paragraph data-line-3978">
<p>0x08 ADDMOD 3 1 Modulo addition operation.</p>
</div>
<div class="paragraph data-line-3980">
<p><strong><em>µ</em></strong> [0] ≡ 0 if <strong><em>µ</em>s</strong>[2] = 0</p>
</div>
<div class="paragraph data-line-3982">
<p>All intermediate calculations of this operation are not subject to the 2<sup>256</sup> modulo.</p>
</div>
<div class="paragraph data-line-3984">
<p>0x09 MULMOD 3 1 Modulo multiplication operation.</p>
</div>
<div class="paragraph data-line-3986">
<p><strong><em>µ</em></strong> [0] ≡ 0 if <strong><em>µ</em>s</strong>[2] = 0</p>
</div>
<div class="paragraph data-line-3988">
<p>(<strong><em>µ</em></strong> [0] × <strong><em>µ</em></strong> [1]) mod <strong><em>µ</em></strong> [2] otherwise</p>
</div>
<div class="paragraph data-line-3990">
<p>All intermediate calculations of this operation are not subject to the 2<sup>256</sup> modulo.</p>
</div>
<div class="paragraph data-line-3992">
<p>0x0a EXP 2 1 Exponential operation.</p>
</div>
<div class="paragraph data-line-3994">
<p><strong><em>µ</em></strong> [0] ≡ <strong><em>µ</em></strong> <strong class="0"><em><sup>µ</sup></em>s</strong>[1]</p>
</div>
<div class="paragraph data-line-3996">
<p>0x0b SIGNEXTEND 2 1 Extend length of two’s complement signed integer.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-3999">
<p>∀<em>i</em> ∈ [0<em>..</em>255] : <strong><em>µ</em></strong> [0]</p>
</div>
<div class="quoteblock data-line-4001">
<blockquote>
<div class="paragraph data-line-4002">
<p>≡ f<strong><em>µ</em><sub>s</sub></strong>[1]t if <em>i</em> <em>t</em> where <em>t</em> = 256 − 8(<strong><em>µ</em><sub>s</sub></strong>[0] + 1)</p>
</div>
<div class="paragraph data-line-4004">
<p><strong><em>µ</em><sub>s</sub></strong>[<em>x</em>]i gives the <em>i</em>th bit (counting from zero) of <strong><em>µ</em><sub>s</sub></strong>[<em>x</em>]</p>
</div>
<div class="paragraph data-line-4006">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 31</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4009">
<h2 id="_10s_comparison_bitwise_logic_operations">10s: Comparison &amp; Bitwise Logic Operations</h2>
<div class="sectionbody">
<div class="quoteblock data-line-4011">
<blockquote>
<div class="paragraph data-line-4012">
<p><strong><em>µ</em></strong> [0] ≡ f1 if <strong><em>µ</em>s</strong>[0] <em>&lt; <strong>µ*</em>*s</strong>[1]</p>
</div>
<div class="paragraph data-line-4014">
<p>0x11 GT 2 1 Greater-than comparison.</p>
</div>
<div class="paragraph data-line-4016">
<p><strong><em>µ</em></strong> [0] ≡ 1 if <strong><em>µ</em>s</strong>[0] <em>&gt; <strong>µ*</em>*s</strong>[1]</p>
</div>
<div class="paragraph data-line-4018">
<p>0x12 SLT 2 1 Signed less-than comparison.</p>
</div>
<div class="paragraph data-line-4020">
<p><strong><em>µ</em></strong> [0] ≡ 1 if <strong><em>µ</em>s</strong>[0] <em>&lt; <strong>µ*</em>*s</strong>[1]</p>
</div>
<div class="paragraph data-line-4022">
<p>Where all values are treated as two’s complement signed 256-bit integers.</p>
</div>
<div class="paragraph data-line-4024">
<p>0x13 SGT 2 1 Signed greater-than comparison.</p>
</div>
<div class="paragraph data-line-4026">
<p><strong><em>µ</em></strong> [0] ≡ 1 if <strong><em>µ</em>s</strong>[0] <em>&gt; <strong>µ*</em>*s</strong>[1]</p>
</div>
<div class="paragraph data-line-4028">
<p>Where all values are treated as two’s complement signed 256-bit integers.</p>
</div>
<div class="paragraph data-line-4030">
<p>0x14 EQ 2 1 Equality comparison.</p>
</div>
<div class="paragraph data-line-4032">
<p><strong><em>µ</em></strong> [0] ≡ 1 if <strong><em>µ</em>s</strong>[0] = <strong><em>µ</em>s</strong>[1]</p>
</div>
<div class="paragraph data-line-4034">
<p>0x15 ISZERO 1 1 Simple not operator.</p>
</div>
<div class="paragraph data-line-4036">
<p><strong><em>µ</em></strong> [0] ≡ 1 if <strong><em>µ</em>s</strong>[0] = 0</p>
</div>
<div class="paragraph data-line-4038">
<p>0x16 AND 2 1 Bitwise AND operation.</p>
</div>
<div class="paragraph data-line-4040">
<p>∀<em>i</em> ∈ [0<em>..</em>255] : <strong><em>µ</em><sub>s</sub></strong>[0]i ≡ <strong><em>µ</em><sub>s</sub></strong>[0]i ∧ <strong><em>µ</em><sub>s</sub></strong>[1]i</p>
</div>
<div class="paragraph data-line-4042">
<p>0x17 OR 2 1 Bitwise OR operation.</p>
</div>
<div class="paragraph data-line-4044">
<p>∀<em>i</em> ∈ [0<em>..</em>255] : <strong><em>µ</em><sub>s</sub></strong>[0]i ≡ <strong><em>µ</em><sub>s</sub></strong>[0]i ∨ <strong><em>µ</em><sub>s</sub></strong>[1]i</p>
</div>
<div class="paragraph data-line-4046">
<p>0x18 XOR 2 1 Bitwise XOR operation.</p>
</div>
<div class="paragraph data-line-4048">
<p>∀<em>i</em> ∈ [0<em>..</em>255] : <strong><em>µ</em><sub>s</sub></strong>[0]i ≡ <strong><em>µ</em><sub>s</sub></strong>[0]i ⊕ <strong><em>µ</em><sub>s</sub></strong>[1]i</p>
</div>
<div class="paragraph data-line-4050">
<p>0x19 NOT 1 1 Bitwise NOT operation.</p>
</div>
<div class="paragraph data-line-4052">
<p>∀<em>i</em> ∈ [0<em>..</em>255] : <strong><em>µ</em><sub>s</sub></strong>[0]i</p>
</div>
<div class="paragraph data-line-4054">
<p>1 if <strong><em>µ</em><sub>s</sub></strong>[0]i = 0</p>
</div>
<div class="paragraph data-line-4056">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-4058">
<p>0x1a BYTE 2 1 Retrieve single byte from word.</p>
</div>
<div class="paragraph data-line-4060">
<p>∀<em>i</em> ∈ [0<em>..</em>255] : <strong><em>µ</em><sub>s</sub></strong>[0]i</p>
</div>
<div class="paragraph data-line-4062">
<p><strong><em>µ</em>s</strong><sub class="1">(<em>i</em>−248+8<strong><em>µ</em></strong></sub><strong>s</strong>[0]) if <em>i</em> ≥ 248 ∧ <strong><em>µ</em>s</strong>[0] <em>&lt;</em> 32</p>
</div>
<div class="paragraph data-line-4064">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-4066">
<p>For the Nth byte, we count from the left (i.e. N=0 would be the most significant in big endian).</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-4070">
<colgroup>
<col style="width: 9%;">
<col style="width: 9%;">
<col style="width: 6%;">
<col style="width: 76%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">0x1b</th>
<th class="tableblock halign-left valign-top"><em><em>_
SHL
</em>_</em></th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top"><em><em>_
1 Left shift operation.

<strong>_µ</em></strong> [0] ≡ (<strong><em>µ</em></strong> [1] × 2<strong></em><sup>µ</sup><em>s</strong>[0]) mod 2<sup>256</sup>

<strong>s s</strong>
</em>__</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1c</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SHR</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1 Logical right shift operation.</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em></strong> [0] ≡ l<strong><em>µ</em></strong> [1] ÷ 2<strong><em><sup>µ</sup></em>s</strong>[0]J</p>
</div>
<div class="paragraph">
<p><strong>s s</strong></p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1d</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SAR</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1 Arithmetic (signed) right shift operation.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4111">
<blockquote>
<div class="paragraph data-line-4112">
<p><strong><em>µ</em></strong> [0] ≡ l<strong><em>µ</em></strong> [1] ÷ 2<strong><em><sup>µ</sup></em>s</strong>[0]J</p>
</div>
<div class="paragraph data-line-4114">
<p>Where <strong><em>µ</em>s</strong>[0] and <strong><em>µ</em>s</strong>[1] are treated as two’s complement signed 256-bit integers, while <strong><em>µ</em>s</strong>[0] is treated as unsigned.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4117">
<h2 id="_20s_keccak256">20s: KECCAK256</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch data-line-4120">
<colgroup>
<col style="width: 12%;">
<col style="width: 23%;">
<col style="width: 5%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Mnemonic</strong> _δ</em>
</em>__</th>
<th class="tableblock halign-left valign-top"><em>α</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Description</strong>
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>KECCAK256 2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Compute Keccak-256 hash.</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em>s</strong>[0] ≡ KEC(<strong><em>µ</em>m</strong>[<strong><em>µ</em>s</strong>[0] <em>. . .</em> (<strong><em>µ</em>s</strong>[0] + <strong><em>µ</em>s</strong>[1] − 1)])</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[1])</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4152">
<blockquote>
<div class="paragraph data-line-4153">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 32</p>
</div>
<div class="paragraph data-line-4155">
<p>∀<em>i</em> ∈ \{0 <em>. . . <strong>µ *</em>[2] − 1} : *<em>µ</em></strong></p>
</div>
<div class="paragraph data-line-4157">
<p>[<strong><em>µ</em></strong> [0] + <em>i</em>] ≡ f<em>I</em>*<sub>d</sub><strong>[*<em>µ</em>s</strong>[1] + <em>i</em>] if <strong><em>µ</em>s</strong>[1] + <em>i &lt;</em> ll<em>I</em><strong><sub>d</sub></strong>ll</p>
</div>
<div class="paragraph data-line-4159">
<p>The additions in <strong><em>µ</em></strong> [1] + <em>i</em> are not subject to the 2<sup>256</sup> modulo.</p>
</div>
<div class="paragraph data-line-4161">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[2])</p>
</div>
<div class="paragraph data-line-4163">
<p>This pertains to the input data passed with the message call instruction</p>
</div>
<div class="paragraph data-line-4165">
<p>or transaction.</p>
</div>
<div class="paragraph data-line-4167">
<p>0x38 CODESIZE 0 1 Get size of code running in current environment.</p>
</div>
<div class="paragraph data-line-4169">
<p><strong><em>µ</em>s</strong>[0] ≡ ll<em>I</em><strong><sub>b</sub></strong>ll</p>
</div>
<div class="paragraph data-line-4171">
<p>0x39 CODECOPY 3 0 Copy code running in current environment to memory.</p>
</div>
<div class="paragraph data-line-4173">
<p>∀<em>i</em> ∈ \{0 <em>. . . <strong>µ *</em>[2] − 1} : *<em>µ</em></strong></p>
</div>
<div class="paragraph data-line-4175">
<p>[<strong><em>µ</em></strong> [0] + <em>i</em>] ≡ f<em>I</em>*<sub>b</sub><strong>[*<em>µ</em>s</strong>[1] + <em>i</em>] if <strong><em>µ</em>s</strong>[1] + <em>i &lt;</em> ll<em>I</em><strong><sub>b</sub></strong>ll</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4178">
<p><strong>s m s</strong></p>
</div>
<div class="quoteblock data-line-4180">
<blockquote>
<div class="paragraph data-line-4181">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[2])</p>
</div>
<div class="paragraph data-line-4183">
<p>STOP otherwise</p>
</div>
<div class="paragraph data-line-4185">
<p>The additions in <strong><em>µ</em></strong> [1] + <em>i</em> are not subject to the 2<sup>256</sup> modulo.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4188">
<p><strong><em>µ</em>s</strong>[0] ≡</p>
</div>
<div class="quoteblock data-line-4190">
<blockquote>
<div class="paragraph data-line-4191">
<p>160</p>
</div>
<div class="paragraph data-line-4193">
<p><strong>s</strong></p>
</div>
<div class="paragraph data-line-4195">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-4197">
<p>where KEC(<strong>b</strong>) ≡ <strong><em>σ</em></strong>[<strong><em>µ</em></strong> [0] mod 2<sup>160</sup>]c</p>
</div>
<div class="paragraph data-line-4199">
<p><em>A</em>*<sub>a</sub>* ≡ <em>A</em>*<sub>a</sub>* ∪ \{<strong><em>µ</em></strong> [0] mod 2<sup>160</sup>}</p>
</div>
<div class="paragraph data-line-4201">
<p>0x3c EXTCODECOPY 4 0 Copy an account’s code to memory.</p>
</div>
<div class="paragraph data-line-4203">
<p>∀<em>i</em> ∈ \{0 <em>. . . <strong>µ *</em>[3] − 1} : *<em>µ</em></strong></p>
</div>
<div class="paragraph data-line-4205">
<p>[<strong><em>µ</em></strong> [1] + <em>i</em>] ≡ f<strong>b</strong>[<strong><em>µ</em>s</strong>[2] + <em>i</em>] if <strong><em>µ</em>s</strong>[2] + <em>i &lt;</em> ll<strong>b</strong>ll</p>
</div>
<div class="paragraph data-line-4207">
<p>where KEC(<strong>b</strong>) ≡ <strong><em>σ</em></strong>[<strong><em>µ</em></strong> [0] mod 2<sup>160</sup>]c</p>
</div>
<div class="paragraph data-line-4209">
<p>We assume <strong>b</strong> ≡ () if <strong><em>σ</em></strong>[<strong><em>µ</em></strong> [0] mod 2<sup>160</sup>] = ∅.</p>
</div>
<div class="paragraph data-line-4211">
<p><strong><em>µ</em></strong>i <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="1">, <strong>µ*</em>*s</strong>[3])</p>
</div>
<div class="paragraph data-line-4213">
<p>The additions in <strong><em>µ</em></strong> [2] + <em>i</em> are not subject to the 2<sup>256</sup> modulo.</p>
</div>
<div class="paragraph data-line-4215">
<p><em>A</em>*<sub>a</sub>* ≡ <em>A</em>*<sub>a</sub>* ∪ \{<strong><em>µ</em></strong> [0] mod 2<sup>160</sup>}</p>
</div>
<div class="paragraph data-line-4217">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 33</p>
</div>
<div class="paragraph data-line-4219">
<p>0x3d RETURNDATASIZE 0 1 Get size of output data from the previous call from the current</p>
</div>
<div class="paragraph data-line-4221">
<p>environment.</p>
</div>
<div class="paragraph data-line-4223">
<p><strong><em>µ</em>s</strong>[0] ≡ ll<strong><em>µ</em>o</strong>ll</p>
</div>
<div class="paragraph data-line-4225">
<p>0x3e RETURNDATACOPY 3 0 Copy output data from the previous call to memory.</p>
</div>
<div class="paragraph data-line-4227">
<p>∀<em>i</em> ∈ \{0 <em>. . . <strong>µ *</em>[2] − 1} : *<em>µ</em></strong></p>
</div>
<div class="paragraph data-line-4229">
<p>[<strong><em>µ</em></strong> [0] + <em>i</em>] ≡ f<strong><em>µ</em>o</strong>[<strong><em>µ</em>s</strong>[1] + <em>i</em>] if <strong><em>µ</em>s</strong>[1] + <em>i &lt;</em> ll<strong><em>µ</em>o</strong>ll</p>
</div>
<div class="paragraph data-line-4231">
<p>The additions in <strong><em>µ</em></strong> [1] + <em>i</em> are not subject to the 2<sup>256</sup> modulo.</p>
</div>
<div class="paragraph data-line-4233">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[2])</p>
</div>
<div class="paragraph data-line-4235">
<p>0x3f EXTCODEHASH 1 1 Get hash of an account’s code.</p>
</div>
<div class="paragraph data-line-4237">
<p>0 if DEAD(<em>*σ*, *µ *</em>[0] mod 2<sup>160</sup>)</p>
</div>
<div class="paragraph data-line-4239">
<p><em>A</em>*<sub>a</sub>* ≡ <em>A</em>*<sub>a</sub>* ∪ \{<strong><em>µ</em></strong> [0] mod 2<sup>160</sup>}</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4242">
<h2 id="_40s_block_information">40s: Block Information</h2>
<div class="sectionbody">
<div class="quoteblock data-line-4244">
<blockquote>
<div class="paragraph data-line-4245">
<p><span id="<em>bookmark144 " class="anchor">#</span>#where _P</em> is the hash of a block of a particular number, up to a maximum age. 0 is left on the stack if the looked for block number is greater than or</p>
</div>
<div class="paragraph data-line-4247">
<p>equal to the current block number or more than 256 blocks behind the current block.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4250">
<p><em>P</em> (<em>h, n, a</em>) ≡</p>
</div>
<div class="olist loweralpha data-line-4253">
<ol class="loweralpha" type="a" start="8">
<li class="data-line-4253">
<p>if <em>n</em> = <em>H</em>i</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-4255">
<blockquote>
<div class="paragraph data-line-4256">
<p><em>P</em> (<em>H</em>p<em>, n, a</em> + 1) otherwise</p>
</div>
<div class="paragraph data-line-4258">
<p>and we assert the header <em>H</em> can be determined from its hash <em>h</em> unless <em>h</em> is zero (as is the case for the parent hash of the genesis block).</p>
</div>
<div class="paragraph data-line-4260">
<p>0x41 COINBASE 0 1 Get the current block’s beneficiary address.</p>
</div>
<div class="paragraph data-line-4262">
<p><strong><em>µ</em><sub>s</sub></strong>[0] ≡ <em>I</em>Hc</p>
</div>
<div class="paragraph data-line-4264">
<p>0x42 TIMESTAMP 0 1 Get the current block’s timestamp.</p>
</div>
<div class="paragraph data-line-4266">
<p><strong><em>µ</em><sub>s</sub></strong>[0] ≡ <em>I</em>Hs</p>
</div>
<div class="paragraph data-line-4268">
<p>0x43 NUMBER 0 1 Get the current block’s number.</p>
</div>
<div class="paragraph data-line-4270">
<p><strong><em>µ</em><sub>s</sub></strong>[0] ≡ <em>I</em>Hi</p>
</div>
<div class="paragraph data-line-4272">
<p>0x44 DIFFICULTY 0 1 Get the current block’s difficulty.</p>
</div>
<div class="paragraph data-line-4274">
<p><strong><em>µ</em><sub>s</sub></strong>[0] ≡ <em>I</em>Hd</p>
</div>
<div class="paragraph data-line-4276">
<p>0x45 GASLIMIT 0 1 Get the current block’s gas limit.</p>
</div>
<div class="paragraph data-line-4278">
<p><strong><em>µ</em><sub>s</sub></strong>[0] ≡ <em>I</em>Hl</p>
</div>
<div class="paragraph data-line-4280">
<p>0x46 CHAINID 0 1 Get the <a href="#_bookmark1" data-href="#_bookmark1">chain ID.</a></p>
</div>
<div class="paragraph data-line-4282">
<p><strong><em>µ</em>s</strong>[0] ≡ <em>β</em></p>
</div>
<div class="paragraph data-line-4284">
<p>0x47 SELFBALANCE 0 1 Get balance of currently executing account.</p>
</div>
<div class="paragraph data-line-4286">
<p><strong><em>µ</em></strong> <strong>s</strong>[0] ≡ <strong><em>σ</em></strong><sub class="<em>I</em>~a~">b</sub></p>
</div>
<div class="paragraph data-line-4288">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 34</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4291">
<h2 id="_50s_stack_memory_storage_and_flow_operations">50s: Stack, Memory, Storage and Flow Operations</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch data-line-4294">
<colgroup>
<col style="width: 10%;">
<col style="width: 13%;">
<col style="width: 3%;">
<col style="width: 3%;">
<col style="width: 71%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Value</strong>

0x50
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Mnemonic</strong>

POP
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em>δ</em>

<em><em>_
1
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
_α</em>

0
</em>__</th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Description</strong>

Remove item from stack.
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x51</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>MLOAD</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Load word from memory.</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>m</strong>[<strong><em>µ</em>s</strong>[0] <em>. . .</em> (<strong><em>µ</em>s</strong>[0] + 31)]</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em></strong>i ≡ max(<strong><em>µ</em></strong>i<em>,</em> r(<strong><em>µ</em>s</strong>[0] + 32) ÷ 321)</p>
</div>
<div class="paragraph">
<p>The addition in the calculation of <strong><em>µ</em></strong> is not subject to the 2<sup>256</sup> modulo.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>i</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x52</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>MSTORE</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Save word to memory.</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em>m</strong>[<strong><em>µ</em>s</strong>[0] <em>. . .</em> (<strong><em>µ</em>s</strong>[0] + 31)] ≡ <strong><em>µ</em>s</strong>[1] <strong><em>µ</em></strong>i ≡ max(<strong><em>µ</em></strong>i<em>,</em> r(<strong><em>µ</em>s</strong>[0] + 32) ÷ 321)</p>
</div>
<div class="paragraph">
<p>The addition in the calculation of <strong><em>µ</em></strong> is not subject to the 2<sup>256</sup> modulo.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>i</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x53</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>MSTORE8</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Save byte to memory.</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em>m</strong>[<strong><em>µ</em>s</strong>[0]] ≡ (<strong><em>µ</em>s</strong>[1] mod 256)</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em></strong>i ≡ max(<strong><em>µ</em></strong>i<em>,</em> r(<strong><em>µ</em>s</strong>[0] + 1) ÷ 321)</p>
</div>
<div class="paragraph">
<p>The addition in the calculation of <strong><em>µ</em></strong> is not subject to the 2<sup>256</sup> modulo.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>i</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x54</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SLOAD</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Load word from storage.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4414">
<blockquote>
<div class="paragraph data-line-4415">
<p><strong><em>µ</em><sub>s</sub></strong>[0] ≡ <strong><em>σ</em></strong>[<em>I</em>a]<strong>s</strong>[<strong><em>µ</em><sub>s</sub></strong>[0]]</p>
</div>
<div class="paragraph data-line-4417">
<p><em>A</em> <strong>K</strong> ≡ <em>A</em>*<sub>K</sub>* ∪ \{(<em>I</em><sub>a</sub><em>, *µ*</em>f<strong>s</strong>[0])}</p>
</div>
<div class="paragraph data-line-4419">
<p><span id="_bookmark145 " class="anchor">#</span>#0x55 SSTORE 2 0 Save word to storage.</p>
</div>
<div class="paragraph data-line-4421">
<p><strong><em>σ</em></strong> <strong class="<em>I</em>a">s</strong>[<strong><em>µ</em><sub>s</sub></strong>[0]] ≡ <strong><em>µ</em><sub>s</sub></strong>[1]</p>
</div>
<div class="paragraph data-line-4423">
<p><em>A</em>*K* ≡ <em>A</em>*<sub>K</sub>* ∪ \{(<em>I</em><sub>a</sub><em>, <strong>µ*</em>*s</strong>[0])}</p>
</div>
<div class="paragraph data-line-4425">
<p>[<mark><em>bookmark146 .anchor]</mark>#_C</em><sub>SSTORE</sub>(<em>*σ*, *µ*</em>) and <em>A</em><sub>r</sub> are specified by EIP-2200 as follows.</p>
</div>
<div class="paragraph data-line-4427">
<p>We remind the reader that the checkpoint (“original”) state <a href="#<em>bookmark41" data-href="#<em>bookmark41"><strong>_σ</em></strong>0</a> is the state if the current transaction were to revert.</p>
</div>
<div class="paragraph data-line-4429">
<p>Let <em>v</em>0 = <strong><em>σ</em></strong>0[<em>I</em>a]<strong>s</strong>[<strong><em>µ</em><sub>s</sub></strong>[0]] be the original value of the storage slot. Let <em>v</em> = <strong><em>σ</em></strong>[<em>I</em>a]<strong>s</strong>[<strong><em>µ</em><sub>s</sub></strong>[0]] be the current value.</p>
</div>
<div class="paragraph data-line-4431">
<p>Let <em>v</em> = <strong><em>µ</em>s</strong>[1] be the new value.</p>
</div>
<div class="paragraph data-line-4433">
<p>Then:</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4436">
<p><em>C</em>SSTORE</p>
</div>
<div class="paragraph data-line-4438">
<p>(<em>*σ*, <strong>µ</strong>, A, I</em>) 0 if (<em>I</em><sub>a</sub><em>, <strong>µ*</em>*s</strong>[0]) ∈ <em>A</em>*<sub>K</sub>* <em>G</em><sub>coldsload</sub> otherwise</p>
</div>
<div class="quoteblock data-line-4440">
<blockquote>
<div class="paragraph data-line-4441">
<p><em>G</em>warmaccess if <em>v</em> = <em>v</em> ∨ <em>v</em>0 = <em>v</em></p>
</div>
<div class="paragraph data-line-4443">
<p>+ <em>G</em>sset if <em>v</em> = <em>v</em> ∧ <em>v</em>0 = <em>v</em> ∧ <em>v</em>0 = 0</p>
</div>
<div class="paragraph data-line-4445">
<p> <em>G</em>sreset if <em>v</em> = <em>v</em> ∧ <em>v</em>0 = <em>v</em> ∧ <em>v</em>0 = 0</p>
</div>
<div class="paragraph data-line-4447">
<p><em>R</em><sub>sclear</sub> if <em>v</em> = <em>v</em> ∧ <em>v</em><sub>0</sub> = <em>v</em> ∧ <em>v</em> = 0</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4450">
<p>where</p>
</div>
<div class="quoteblock data-line-4452">
<blockquote>
<div class="paragraph data-line-4453">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-4455">
<p>−<em>R</em><sub>sclear</sub> if <em>v</em><sub>0</sub> = 0 ∧ <em>v</em> = 0</p>
</div>
<div class="paragraph data-line-4457">
<p><em>r</em>dirtyclear ≡</p>
</div>
<div class="paragraph data-line-4459">
<p><em>r</em>dirtyreset ≡</p>
</div>
<div class="paragraph data-line-4461">
<p><em>R</em><sub>sclear</sub> if <em>v</em><sub>0</sub> = 0 ∧ <em>v</em> = 0</p>
</div>
<div class="paragraph data-line-4463">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-4465">
<p><em>G</em>sset − <em>G</em>warmaccess if <em>v</em>0 = <em>v</em> ∧ <em>v</em>0 = 0</p>
</div>
<div class="paragraph data-line-4467">
<p><em>G</em>sreset − <em>G</em>warmaccess if <em>v</em>0 = <em>v</em> ∧ <em>v</em>0 = 0</p>
</div>
<div class="paragraph data-line-4469">
<p><span id="_bookmark147 " class="anchor">#</span>#0 otherwise</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-4473">
<colgroup>
<col style="width: 11%;">
<col style="width: 10%;">
<col style="width: 5%;">
<col style="width: 3%;">
<col style="width: 71%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">0x56</th>
<th class="tableblock halign-left valign-top"><em><em>_
JUMP
</em>_</em></th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top"><em><em>_
0 Alter the program counter.
</em>_</em></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>J</em>JUMP(<strong><em>µ</em></strong>) ≡ <strong><em>µ</em><sub>s</sub></strong>[0]</p>
</div>
<div class="paragraph">
<p>This has the effect of writing said value to <strong><em>µ</em></strong>pc. See section <a href="#9._Execution_Model" data-href="#9._Execution_Model">9.</a></p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span id="_bookmark148 " class="anchor">#</span>#0x57</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>JUMPI</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Conditionally alter the program counter.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-4509">
<p><em>J</em>JUMPI</p>
</div>
<div class="paragraph data-line-4511">
<p>(<strong><em>µ</em></strong>) <strong><em>µ</em>s</strong>[0] if <strong><em>µ</em>s</strong>[1] = 0</p>
</div>
<div class="quoteblock data-line-4513">
<blockquote>
<div class="paragraph data-line-4514">
<p><strong><em>µ</em></strong>pc + 1 otherwise</p>
</div>
<div class="paragraph data-line-4516">
<p>This has the effect of writing said value to <strong><em>µ</em></strong>pc. See section <a href="#9._Execution_Model" data-href="#9._Execution_Model">9.</a></p>
</div>
<div class="paragraph data-line-4518">
<p>0x58 PC 0 1 Get the value of the program counter <em>prior</em> to the increment corresponding to this instruction.</p>
</div>
<div class="paragraph data-line-4520">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em></strong>pc</p>
</div>
<div class="paragraph data-line-4522">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 35</p>
</div>
<div class="paragraph data-line-4524">
<p>0x59 MSIZE 0 1 Get the size of active memory in bytes.</p>
</div>
<div class="paragraph data-line-4526">
<p><strong><em>µ</em>s</strong>[0] ≡ 32<strong><em>µ</em></strong>i</p>
</div>
<div class="paragraph data-line-4528">
<p>0x5a GAS 0 1 Get the amount of available gas, including the corresponding reduction for the cost of this instruction.</p>
</div>
<div class="paragraph data-line-4530">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em></strong>g</p>
</div>
<div class="paragraph data-line-4532">
<p>0x5b JUMPDEST 0 0 Mark a valid destination for jumps.</p>
</div>
<div class="paragraph data-line-4534">
<p>This operation has no effect on machine state during execution.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4537">
<h2 id="_60s_70s_push_operations_value_mnemonic_δ_α_description">60s &amp; 70s: Push Operations Value Mnemonic <em>δ α</em> Description</h2>
<div class="sectionbody">
<div class="quoteblock data-line-4539">
<blockquote>
<div class="paragraph data-line-4540">
<p>0x60 PUSH1 0 1 Place 1 byte item on stack.</p>
</div>
<div class="paragraph data-line-4542">
<p><strong><em>µ</em></strong> <strong>s</strong>[0] ≡ <em>c</em>(<strong><em>µ</em></strong>pc +f1)</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-4546">
<colgroup>
<col style="width: 9%;">
<col style="width: 10%;">
<col style="width: 81%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em><em>_
The bytes are read in line from the program code’s bytes array.

The function _c</em> ensures the bytes default to zero if they extend past the limits. The byte is right-aligned (takes the lowest significant place in big endian).
</em>__</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0x61</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>PUSH2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0 1 Place 2-byte item on stack.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4571">
<blockquote>
<div class="olist arabic data-line-4572">
<ol class="arabic">
<li class="data-line-4572">
<p>. .</p>
</li>
</ol>
</div>
<div class="paragraph data-line-4574">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>c</em></strong> (<strong><em>µ</em></strong>pc + 1) <em>. . .</em> (<strong><em>µ</em></strong>pc + 2)</p>
</div>
<div class="paragraph data-line-4576">
<p>with <strong><em>c</em></strong>(<strong><em>x</em></strong>) ≡ (<em>c</em>(<strong><em>x</em></strong><sub>0</sub>)<em>, &#8230;&#8203;, c</em>(<em>*x* ~x <sub></em></sub>−1~)) with <em>c</em> as defined as above.</p>
</div>
<div class="paragraph data-line-4578">
<p>The bytes are right-aligned (takes the lowest significant place in big endian).</p>
</div>
<div class="olist arabic data-line-4580">
<ol class="arabic">
<li class="data-line-4580">
<p>.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-4582">
<p>0x7f PUSH32 0 1 Place 32-byte (full word) item on stack.</p>
</div>
<div class="paragraph data-line-4584">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>c</em></strong> (<strong><em>µ</em></strong>pc + 1) <em>. . .</em> (<strong><em>µ</em></strong>pc + 32) where <strong><em>c</em></strong> is defined as above.</p>
</div>
<div class="paragraph data-line-4586">
<p>The bytes are right-aligned (takes the lowest significant place in big endian).</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4589">
<h2 id="_80s_duplication_operations">80s: Duplication Operations</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch data-line-4592">
<colgroup>
<col style="width: 16%;">
<col style="width: 24%;">
<col style="width: 7%;">
<col style="width: 7%;">
<col style="width: 46%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Mnemonic</strong>
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
_δ</em>
</em>__</th>
<th class="tableblock halign-left valign-top"><em>α</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Description</strong>
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>DUP1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Duplicate 1st stack item.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>DUP2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[0]</p>
</div>
<div class="paragraph">
<p>Duplicate 2nd stack item.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[1]</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4647">
<blockquote>
<div class="olist arabic data-line-4648">
<ol class="arabic">
<li class="data-line-4648">
<p>. . . .</p>
</li>
</ol>
</div>
<div class="paragraph data-line-4650">
<p>0x8f DUP16 16 17 Duplicate 16th stack item.</p>
</div>
<div class="paragraph data-line-4652">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[15]</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4655">
<h2 id="_90s_exchange_operations">90s: Exchange Operations</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch data-line-4658">
<colgroup>
<col style="width: 14%;">
<col style="width: 21%;">
<col style="width: 6%;">
<col style="width: 6%;">
<col style="width: 53%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Mnemonic</strong>
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
_δ</em>
</em>__</th>
<th class="tableblock halign-left valign-top"><em>α</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Description</strong>
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x90</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SWAP1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Exchange 1st and 2nd stack items.</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[1]</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em>s</strong>[1] ≡ <strong><em>µ</em>s</strong>[0]</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x91</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SWAP2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>3</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Exchange 1st and 3rd stack items.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4710">
<blockquote>
<div class="olist arabic data-line-4711">
<ol class="arabic">
<li class="data-line-4711">
<p>. .</p>
</li>
</ol>
</div>
<div class="paragraph data-line-4713">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[2]</p>
</div>
<div class="paragraph data-line-4715">
<p><strong><em>µ</em>s</strong>[2] ≡ <strong><em>µ</em>s</strong>[0]</p>
</div>
<div class="olist arabic data-line-4717">
<ol class="arabic">
<li class="data-line-4717">
<p>.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-4719">
<p>0x9f SWAP16 17 17 Exchange 1st and 17th stack items.</p>
</div>
<div class="paragraph data-line-4721">
<p><strong><em>µ</em>s</strong>[0] ≡ <strong><em>µ</em>s</strong>[16]</p>
</div>
<div class="paragraph data-line-4723">
<p><strong><em>µ</em>s</strong>[16] ≡ <strong><em>µ</em>s</strong>[0]</p>
</div>
<div class="paragraph data-line-4725">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 36</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4728">
<h2 id="_a0s_logging_operations">a0s: Logging Operations</h2>
<div class="sectionbody">
<div class="quoteblock data-line-4730">
<blockquote>
<div class="paragraph data-line-4731">
<p>For all logging operations, the state change is to append an additional log entry on to the substate’s log series:</p>
</div>
<div class="paragraph data-line-4733">
<p><em>A</em>*l* ≡ <em>A</em>*<sub>l</sub>* · (<em>I</em><sub>a</sub><em>,</em> <strong>t*<em>, *µ*</em>*m</strong>[<strong><em>µ</em>s</strong>[0] <em>. . .</em> (<strong><em>µ</em>s</strong>[0] + <strong><em>µ</em>s</strong>[1] − 1)]) and to update the memory consumption counter: <strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[1])</p>
</div>
<div class="paragraph data-line-4735">
<p>The entry’s topic series, <strong>t</strong>, differs accordingly:</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-4739">
<colgroup>
<col style="width: 12%;">
<col style="width: 16%;">
<col style="width: 3%;">
<col style="width: 4%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Mnemonic</strong>
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em>δ</em></th>
<th class="tableblock halign-left valign-top"><em>α</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
<strong>Description</strong>
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>LOG0</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Append log record with no topics.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>LOG1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>3</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>t</strong> ≡ ()</p>
</div>
<div class="paragraph">
<p>Append log record with one topic.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>t</strong> ≡ (<strong><em>µ</em>s</strong>[2])</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-4789">
<blockquote>
<div class="olist arabic data-line-4790">
<ol class="arabic">
<li class="data-line-4790">
<p>. . . .</p>
</li>
</ol>
</div>
<div class="paragraph data-line-4792">
<p>0xa4 LOG4 6 0 Append log record with four topics.</p>
</div>
<div class="paragraph data-line-4794">
<p><strong>t</strong> ≡ (<strong><em>µ</em>s</strong><em class="2">, <strong>µ*</em>*s</strong><em class="3">, <strong>µ*</em>*s</strong><em class="4">, <strong>µ*</em>*s</strong>[5])</p>
</div>
<div class="paragraph data-line-4796">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 37</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1 data-line-4799">
<h2 id="_f0s_system_operations">f0s: System operations</h2>
<div class="sectionbody">
<div class="quoteblock data-line-4801">
<blockquote>
<div class="paragraph data-line-4802">
<p><strong>Value Mnemonic</strong> <em>δ α</em> <strong>Description</strong></p>
</div>
<div class="paragraph data-line-4804">
<p>0xf0 CREATE 3 1 Create a new account with associated code.</p>
</div>
<div class="paragraph data-line-4806">
<p><strong>i</strong> ≡ <strong><em>µ</em>m</strong>[<strong><em>µ</em>s</strong>[1] <em>. . .</em> (<strong><em>µ</em>s</strong>[1] + <strong><em>µ</em>s</strong>[2] − 1)]</p>
</div>
<div class="paragraph data-line-4808">
<p><a href="#<em>bookmark43" data-href="#<em>bookmark43">_ζ</em></a> ≡ ∅</p>
</div>
<div class="paragraph data-line-4810">
<p>(<em>*σ* , <strong>µ*</em>g<em>, A , z,</em> *o</strong>) ≡</p>
</div>
<div class="paragraph data-line-4812">
<p><a href="#<em>bookmark44" data-href="#<em>bookmark44">Λ(</a><strong>_σ</em></strong><sup>∗</sup><em>, A, I</em><sub>a</sub><em>, I</em><sub>o</sub><em>, L</em>(<strong><em>µ</em></strong>g)<em>, I</em><sub>p</sub><em>, <strong>µ*</em>*s</strong><em class="0">,</em> <strong>i*<em>, I</em><sub>e</sub> + 1<em>, ζ, I</em><sub>w</sub>) if *<em>µ</em>s</strong>[0] <strong><em>σ</em></strong><sub class="<em>I</em>~a~">b</sub></p>
</div>
<div class="paragraph data-line-4814">
<p> <em>*σ*, *µ*</em>g<em>, A,</em> 0<em>,</em> () otherwise</p>
</div>
<div class="paragraph data-line-4816">
<p><strong><em>σ</em></strong><sup>∗</sup> ≡ <strong><em>σ</em></strong> except <strong><em>σ</em></strong><sup>∗</sup>[<em>I</em>a]n = <strong><em>σ</em></strong>[<em>I</em>a]n + 1</p>
</div>
<div class="paragraph data-line-4818">
<p><strong><em>µ</em>s</strong>[0] ≡ <em>x</em></p>
</div>
<div class="paragraph data-line-4820">
<p>where <em>x</em> = 0 if <em>z</em> = 0, i.e., the <a href="#_bookmark48" data-href="#_bookmark48">contract creation process failed,</a> or <em>I</em>e = 1024</p>
</div>
<div class="paragraph data-line-4822">
<p>(the maximum call depth limit is reached) or <strong><em>µ</em>s</strong>[0] <em>&gt; <strong>σ*</em><sub class="<em>I</em>~a~">b</sub> (balance of the caller is too low to fulfil the value transfer); and otherwise <em>x</em> = ADDR(<em>I</em>a<em>, *σ*</em>[<em>I</em>a]n<em>, ζ,</em> *i</strong>), the address of the newly created account <a href="#_bookmark45" data-href="#_bookmark45">(86).</a></p>
</div>
<div class="paragraph data-line-4824">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="1">, <strong>µ*</em>*s</strong>[2])</p>
</div>
<div class="paragraph data-line-4826">
<p><strong><em>µ</em>o</strong> ≡ ()</p>
</div>
<div class="paragraph data-line-4828">
<p>Thus the operand order is: value, input offset, input size.</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4831">
<p>0xf1 CALL 7 1 Message-call into an account.</p>
</div>
<div class="paragraph data-line-4833">
<p>(<em>*σ* , g , A , x,</em> <strong>o</strong>) ≡</p>
</div>
<div class="quoteblock data-line-4835">
<blockquote>
<div class="paragraph data-line-4836">
<p>link:#<em>bookmark47<em class="Θ(">*σ*, A , I</em>a<em>, I</em>o<em>, t, t, C</em>CALLGAS(</em>*σ*, <strong>µ</strong>, A_)<em>,</em></p>
</div>
<div class="paragraph data-line-4838">
<p><em>I</em>p<em>, <strong>µ*</em></strong><sub>s</sub><strong><em class="2">, *µ*</em></strong><sub>s</sub>*<em class="2">,</em> *i*<em>, I</em>e + 1<em>, I</em>w)</p>
</div>
<div class="paragraph data-line-4840">
<p>if <strong><em>µ</em>s</strong>[2] <strong><em>σ</em></strong><sub class="<em>I</em>~a~">b</sub> ∧</p>
</div>
<div class="paragraph data-line-4842">
<p><em>I</em>e <em>&lt;</em> 1024</p>
</div>
<div class="paragraph data-line-4844">
<p>(<em>*σ*, g, A,</em> 0<em>,</em> ()) otherwise</p>
</div>
<div class="paragraph data-line-4846">
<p><em>n</em> ≡ min(\{<strong><em>µ</em>s</strong><em class="6">,</em> ll<strong>o</strong>ll})</p>
</div>
<div class="paragraph data-line-4848">
<p><strong><em>µ</em>m</strong>[<strong><em>µ</em>s</strong>[5] <em>. . .</em> (<strong><em>µ</em>s</strong>[5] + <em>n</em> − 1)] = <strong>o</strong>[0 <em>. . .</em> (<em>n</em> − 1)]</p>
</div>
<div class="paragraph data-line-4850">
<p><strong><em>µ</em>o</strong> = <strong>o</strong></p>
</div>
<div class="paragraph data-line-4852">
<p><strong><em>µ</em></strong>g ≡ <strong><em>µ</em></strong>g + <em>g</em></p>
</div>
<div class="paragraph data-line-4854">
<p><strong><em>µ</em>s</strong>[0] ≡ <em>x</em></p>
</div>
<div class="paragraph data-line-4856">
<p><em>A</em><sup>∗</sup> ≡ <em>A</em> except <em>A</em><sup>∗</sup><strong><sub>a</sub></strong> ≡ <em>A</em>*<sub>a</sub>* ∪ \{<em>t</em>}</p>
</div>
<div class="paragraph data-line-4858">
<p><em>t</em> ≡ <strong><em>µ</em></strong> [1] mod 2<sup>160</sup></p>
</div>
<div class="paragraph data-line-4860">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="3">, <strong>µ*</em>*s</strong>[4])<em>, <strong>µ*</em>*s</strong><em class="5">, <strong>µ*</em>*s</strong>[6])</p>
</div>
<div class="paragraph data-line-4862">
<p>where <em>x</em> = 0 if the <a href="#_bookmark50" data-href="#_bookmark50">code execution for this operation failed,</a> or if</p>
</div>
<div class="paragraph data-line-4864">
<p><strong><em>µ</em>s</strong>[2] <em>&gt; *σ*</em><sub class="<em>I</em>~a~">b</sub> (not enough funds) or <em>I</em><sub>e</sub> = 1024 (call depth limit reached); <em>x</em> = 1 otherwise.</p>
</div>
<div class="paragraph data-line-4866">
<p>Thus the operand order is: gas, to, value, in offset, in size, out offset, out size.</p>
</div>
<div class="paragraph data-line-4868">
<p><em>C</em>CALL(<em>*σ*, <strong>µ</strong>, A</em>) ≡ <em>C</em>GAfSCAP(<em>*σ*, <strong>µ</strong>, A</em>) + <em>C</em>EXTRA(<em>*σ*, <strong>µ</strong>, A</em>)</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4871">
<p><em>C</em>GASCAP</p>
</div>
<div class="paragraph data-line-4873">
<p>(<em>*σ*, <strong>µ</strong>, A</em>) min\{<a href="#<em>bookmark141" data-href="#<em>bookmark141">_L</em></a>(<strong><em>µ</em></strong><sub>g</sub> − <em>C</em>EXTRA(<em>*σ*, <strong>µ</strong>, A</em>))<em>, <strong>µ*</em></strong><sub>s</sub><strong>[0]} if *<em>µ</em></strong><sub>g</sub> ≥ <em>C</em>EXTRA(<em>*σ*, <strong>µ</strong>, A</em>)</p>
</div>
<div class="quoteblock data-line-4875">
<blockquote>
<div class="paragraph data-line-4876">
<p><strong><em>µ</em>s</strong>[0] otherwise</p>
</div>
<div class="paragraph data-line-4878">
<p><em>C</em>EXTRA(<em>*σ*, <strong>µ*</em>f<em>, A</em>) ≡ <a href="#<em>bookmark140" data-href="#<em>bookmark140"><em>C</em>aaccess</a>(_t, A</em>) + <em>C</em>XFER(*<em>µ</em></strong>) + <em>C</em>NEW(<em>*σ*, *µ*</em>)</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4881">
<p><em>C</em>NEW</p>
</div>
<div class="paragraph data-line-4883">
<p>(<em>*σ*, <strong>µ*</em>) <em>G</em>newaccount if DEAD(<em>*σ</strong>, t</em>) ∧ <strong><em>µ</em><sub>s</sub></strong>[2] 0</p>
</div>
<div class="quoteblock data-line-4885">
<blockquote>
<div class="paragraph data-line-4886">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-4888">
<p>0xf2 CALLCODE 7 1 Message-call into this account with an alternative account’s code.</p>
</div>
<div class="paragraph data-line-4890">
<p>Exactly equivalent to CALL except:</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4893">
<p>(<em>*σ* , g , A , x,</em> <strong>o</strong>) ≡</p>
</div>
<div class="quoteblock data-line-4895">
<blockquote>
<div class="paragraph data-line-4896">
<p>Θ(<em>*σ*, A</em><sup>∗</sup><em>, I</em>a<em>, I</em>o<em>, I</em>a<em>, t, C</em>CALLGAS(<strong><em>µ</em></strong>)<em>,</em></p>
</div>
<div class="paragraph data-line-4898">
<p><em>I</em>p<em>, <strong>µ*</em></strong><sub>s</sub><strong><em class="2">, *µ*</em></strong><sub>s</sub>*<em class="2">,</em> *i*<em>, I</em>e + 1<em>, I</em>w)</p>
</div>
<div class="paragraph data-line-4900">
<p>if <strong><em>µ</em>s</strong>[2] <strong><em>σ</em></strong><sub class="<em>I</em>~a~">b</sub> ∧</p>
</div>
<div class="paragraph data-line-4902">
<p><em>I</em>e <em>&lt;</em> 1024</p>
</div>
<div class="paragraph data-line-4904">
<p>(<em>*σ*, g, A,</em> 0<em>,</em> ()) otherwise</p>
</div>
<div class="paragraph data-line-4906">
<p>Note the change in the fourth parameter to the call <a href="#<em>bookmark47" data-href="#<em>bookmark47">Θ</a> from the 2nd stack value <strong>_µ</em><sub>s</sub></strong>[1] (as in CALL) to the present address <em>I</em>a. This means that the recipient is in fact the same account as at present, simply that the code is overwritten.</p>
</div>
<div class="paragraph data-line-4908">
<p><span id="_bookmark149 " class="anchor">#</span>#0xf3 RETURN 2 0 Halt execution returning output data.</p>
</div>
<div class="paragraph data-line-4910">
<p><em>H</em>RETURN(<strong><em>µ</em></strong>) ≡ <strong><em>µ</em><sub>m</sub></strong>[<strong><em>µ</em><sub>s</sub></strong>[0] <em>. . .</em> (<strong><em>µ</em><sub>s</sub></strong>[0] + <strong><em>µ</em><sub>s</sub></strong>[1] − 1)]</p>
</div>
<div class="paragraph data-line-4912">
<p>This has the effect of halting the execution at this point with output defined.</p>
</div>
<div class="paragraph data-line-4914">
<p>See section <a href="#9._Execution_Model" data-href="#9._Execution_Model">9.</a></p>
</div>
<div class="paragraph data-line-4916">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[1])</p>
</div>
<div class="paragraph data-line-4918">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 38</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-4921">
<p>0xf4 DELEGATECALL 6 1 Message-call into this account with an alternative account’s code, but</p>
</div>
<div class="quoteblock data-line-4923">
<blockquote>
<div class="paragraph data-line-4924">
<p>persisting the current values for <em>sender</em> and <em>value</em>.</p>
</div>
<div class="paragraph data-line-4926">
<p>Compared with CALL, DELEGATECALL takes one fewer arguments. The omitted argument is <strong><em>µ</em>s</strong>[2]. As a result, <strong><em>µ</em>s</strong>[3], <strong><em>µ</em>s</strong>[4], <strong><em>µ</em>s</strong>[5] and <strong><em>µ</em>s</strong>[6] in the definition of CALL should respectively be replaced with <strong><em>µ</em>s</strong>[2], <strong><em>µ</em>s</strong>[3], <strong><em>µ</em>s</strong>[4] and <strong><em>µ</em>s</strong>[5]. Otherwise it is equivalent to CALL except:</p>
</div>
<div class="paragraph data-line-4928">
<p> Θ(<em>*σ*, A</em><sup>∗</sup><em>, I</em>s<em>, I</em>o<em>, I</em>a<em>, t, C</em>CALLGAS(<strong><em>µ</em></strong>)<em>,</em></p>
</div>
<div class="paragraph data-line-4930">
<p>if <em>I</em></p>
</div>
<div class="paragraph data-line-4932">
<p><em>&lt;</em> 1024</p>
</div>
<div class="paragraph data-line-4934">
<p>(<em>*σ*, g, A,</em> 0<em>,</em> ()) otherwise</p>
</div>
<div class="paragraph data-line-4936">
<p>Note the changes (in addition to that of the fourth parameter) to the second and ninth parameters to the call <a href="#_bookmark47" data-href="#_bookmark47">Θ.</a></p>
</div>
<div class="paragraph data-line-4938">
<p>This means that the recipient is in fact the same account as at present, simply that the code is overwritten <em>and</em> the context is almost entirely identical.</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-4942">
<colgroup>
<col style="width: 8%;">
<col style="width: 16%;">
<col style="width: 3%;">
<col style="width: 73%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
<span id="_bookmark150 " class="anchor">#</span>#0xf5
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
CREATE2
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
4
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
1 Create a new account with associated code. Exactly equivalent to CREATE except:

The salt _ζ</em> ≡ <strong></em>µ<em>s</strong>[3].
</em>__</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0xfa</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>STATICCALL</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>6</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1 Static message-call into an account. Exactly equivalent to CALL except:</p>
</div>
<div class="paragraph">
<p>The argument <strong><em>µ</em>s</strong>[2] is replaced with 0.</p>
</div>
<div class="paragraph">
<p>The deeper argument <strong><em>µ</em>s</strong>[3], <strong><em>µ</em>s</strong>[4], <strong><em>µ</em>s</strong>[5] and <strong><em>µ</em>s</strong>[6] are respectively replaced with <strong><em>µ</em>s</strong>[2], <strong><em>µ</em>s</strong>[3], <strong><em>µ</em>s</strong>[4] and <strong><em>µ</em>s</strong>[5].</p>
</div>
<div class="paragraph">
<p>The last argument of <a href="#_bookmark47" data-href="#_bookmark47">Θ</a> is ⊥.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><span id="_bookmark151 " class="anchor">#</span>#0xfd</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>REVERT</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>2</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0 Halt execution reverting state changes but returning data and remaining gas. The effect of this operation is described in <a href="#_bookmark55" data-href="#_bookmark55">(143).</a></p>
</div>
<div class="paragraph">
<p>For the gas calculation, we use the memory expansion function,</p>
</div>
<div class="paragraph">
<p><strong><em>µ</em></strong>i ≡ <em>M</em> (<strong><em>µ</em></strong>i<em>, <strong>µ*</em>*s</strong><em class="0">, <strong>µ*</em>*s</strong>[1])</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0xfe</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>INVALID</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>∅</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>∅ Designated invalid instruction.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><span id="_bookmark152 " class="anchor">#</span>#0xff</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SELFDESTRUCT</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>0 Halt execution and register account for later deletion.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="quoteblock data-line-5057">
<blockquote>
<div class="paragraph data-line-5058">
<p><em>A</em>*<sub>s</sub>* ≡ <em>A</em>*<sub>s</sub>* ∪ \{<em>I</em><sub>a</sub>}</p>
</div>
<div class="paragraph data-line-5060">
<p><em>A</em>*<sub>a</sub>* ≡ <em>A</em>*<sub>a</sub>* ∪ \{<em>r</em>}</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-5063">
<p><strong><em>σ</em></strong> [<em>r</em>] ≡</p>
</div>
<div class="quoteblock data-line-5065">
<blockquote>
<div class="paragraph data-line-5066">
<p>(<strong><em>σ</em></strong><sub class="<em>r</em>">n</sub><em>, <strong>σ*</em><sub class="<em>r</em>">b</sub> + *<em>σ</em></strong><sub class="<em>I</em>~a~">b</sub><em>, <strong>σ*</em>[<em>r</em>]</strong><sub>s</sub>*<em>, *σ*</em><sub class="<em>r</em>">c</sub>) if <em>r</em> = <em>I</em><sub>a</sub></p>
</div>
<div class="paragraph data-line-5068">
<p>(<strong><em>σ</em></strong>[<em>r</em>]n<em>,</em> 0<em>, *σ*</em>[<em>r</em>]*s*<em>, *σ*</em>[<em>r</em>]c) otherwise</p>
</div>
<div class="paragraph data-line-5070">
<p>where <em>r</em> = <strong><em>µ</em></strong> [0] mod 2<sup>160</sup></p>
</div>
<div class="paragraph data-line-5072">
<p><strong><em>σ</em></strong> <sub class="<em>I</em>~a~">b</sub> = 0</p>
</div>
<div class="paragraph data-line-5074">
<p><em>C</em>SELFDESTRUCT</p>
</div>
</blockquote>
</div>
<div class="paragraph data-line-5077">
<p>(<em>*σ*, *µ*</em>) ≡ <em>G</em></p>
</div>
<div class="paragraph data-line-5079">
<p>selfdestruct</p>
</div>
<div class="quoteblock data-line-5081">
<blockquote>
<div class="paragraph data-line-5082">
<p>+ 0 if <em>r</em> ∈ <a href="#<em>bookmark39" data-href="#<em>bookmark39">_A</em>*a*</a></p>
</div>
<div class="paragraph data-line-5084">
<p><em>G</em>coldaccountaccess otherwise</p>
</div>
<div class="paragraph data-line-5086">
<p>+ <em>G</em><sub>newaccount</sub> if DEAD(<em>*σ*, r</em>) ∧ <strong><em>σ</em></strong><sub class="<em>I</em>~a~">b</sub> = 0</p>
</div>
<div class="paragraph data-line-5088">
<p>0 otherwise</p>
</div>
<div class="paragraph data-line-5090">
<p>Appendix I. Genesis Block</p>
</div>
<div class="paragraph data-line-5092">
<p><span id="_bookmark153 " class="anchor">#</span>#The genesis block is 15 items, and is specified thus:</p>
</div>
<div class="paragraph data-line-5094">
<p>(331) 0256<em>,</em> KEC RLP () <em>,</em> 0160<em>, stateRoot,</em> 0<em>,</em> 0<em>,</em> 02048<em>,</em> 234<em>,</em> 0<em>,</em> 0<em>,</em> 3141592<em>, time,</em> 0<em>,</em> 0256<em>,</em> KEC (42) <em>,</em> ()<em>,</em> ()</p>
</div>
<div class="paragraph data-line-5096">
<p>Where 0256 refers to the parent hash, a 256-bit hash which is all zeroes; 0160 refers to the beneficiary address, a 160-bit hash which is all zeroes; 02048 refers to the log bloom, 2048-bit of all zeros; 2<sup>34</sup> refers to the difficulty; the transaction trie root, receipt trie root, gas used, block number and extradata are both 0, being equivalent to the empty byte array. The sequences of both ommers and transactions are empty and represented by (). KEC (42) refe rs to th e Keccak-256 hash of</p>
</div>
<div class="paragraph data-line-5098">
<p>The proof-of-concept series include a development premine, making the state root hash some value <em>stateRoot</em>. Also <em>time</em> will be set to the initial timestamp of the genesis block. The latest documentation should be consulted for those values.</p>
</div>
<div class="paragraph data-line-5100">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 39</p>
</div>
<div class="paragraph data-line-5102">
<p><span id="Appendix_J" class="_Ethash  anchor">#</span>#Appendix J. Ethash</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5106">
<ol class="arabic">
<li class="data-line-5106">
<p><strong>Definitions.</strong> We employ the following definitions: Name Value Description</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5108">
<blockquote>
<div class="paragraph data-line-5109">
<p><em>J</em><sub>wordbytes</sub> 4 Bytes in word.</p>
</div>
<div class="paragraph data-line-5111">
<p><span id="<em>bookmark156 " class="anchor">_J</em><sub>datasetinit</sub> 2<sup>30</sup> Bytes in dataset at genesis. <em>J</em><sub>datasetgrowth</sub> 2<sup>23</sup> Dataset growth per epoch. [#<em>bookmark155 .anchor]</span>_J</em><sub>cacheinit</sub> 2<sup>24</sup> Bytes in cache at genesis. <em>J</em><sub>cachegrowth</sub> 2<sup>17</sup> Cache growth per epoch.</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch data-line-5115">
<colgroup>
<col style="width: 21%;">
<col style="width: 13%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em><em>_
[<mark>_bookmark157 .anchor]</mark>#</em>J<em>epoch
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
30000
</em>_</em></th>
<th class="tableblock halign-left valign-top"><em><em>_
Blocks per epoch.
</em>_</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>J</em>mixbytes</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>128</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>mix length in bytes.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>J</em>hashbytes</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>64</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Hash length in bytes.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>J</em>parents</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>256</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Number of parents of each dataset element.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>J</em>cacherounds</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>3</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Number of rounds in cache production.</p>
</div>
</blockquote>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>J</em>accesses</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>64</p>
</div>
</blockquote>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Number of accesses in hashimoto loop.</p>
</div>
</blockquote>
</div></div></td>
</tr>
</tbody>
</table>
<div class="olist arabic data-line-5209">
<ol class="arabic" start="2">
<li class="data-line-5209">
<p><strong>Size of dataset and cache.</strong> The size for Ethash’s cache <strong>c</strong> ∈ B and dataset <strong>d</strong> ∈ B depend on the epoch, which in turn depends on the block number.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5211">
<blockquote>
<div class="paragraph data-line-5212">
<p>(332) <em>E</em> (<em>H</em> ) = __H__i</p>
</div>
<div class="paragraph data-line-5214">
<p>The size of the dataset growth by <em>J</em><sub>datasetgrowth</sub> bytes, and the size of the cache by <em>J</em><sub>cachegrowth</sub> bytes, every epoch. In order to avoid regularity leading to cyclic behavior, the size must be a prime number. Therefore the size is reduced by a multiple of <em>J</em><sub>mixbytes</sub>, for the dataset, and <em>J</em><sub>hashbytes</sub> for the cache. Let <em>d</em><sub>size</sub> = ll<strong>d</strong>ll be the size of the dataset. Which is calculated using</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5218">
<ol class="arabic" start="333">
<li class="data-line-5218">
<p><em>d</em>size = <em>E</em>prime(<em>J</em>datasetinit + <em>J</em>datasetgrowth · <em>E</em>epoch − <em>J</em>mixbytes<em>, J</em>mixbytes)</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5220">
<blockquote>
<div class="paragraph data-line-5221">
<p>The size of the cache, <em>c</em>size, is calculated using</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5225">
<ol class="arabic" start="334">
<li class="data-line-5225">
<p><em>c</em>size = <em>E</em>prime(<em>J</em>cacheinit + <em>J</em>cachegrowth · <em>E</em>epoch − <em>J</em>hashbytes<em>, J</em>hashbytes)</p>
</li>
<li class="data-line-5226">
<p><em>E</em></p>
</li>
</ol>
</div>
<div class="paragraph data-line-5228">
<p>prime</p>
</div>
<div class="paragraph data-line-5230">
<p>(<em>x, y</em>) = <em>x</em> if <em>x/y</em> ∈ N</p>
</div>
<div class="quoteblock data-line-5232">
<blockquote>
<div class="paragraph data-line-5233">
<p><em>E</em>prime(<em>x</em> − 2 · <em>y, y</em>) otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5237">
<ol class="arabic">
<li class="data-line-5237">
<p><strong>Dataset generation.</strong> In order to generate the dataset we need the cache <strong>c</strong>, which is an array of bytes. It depends on the cache size <em>c</em>size and the seed hash <strong>s</strong> ∈ B32.</p>
<div class="olist arabic data-line-5239">
<ol class="arabic">
<li class="data-line-5239">
<p><em>Seed hash.</em> The seed hash is different for every epoch. For the first epoch it is the Keccak-256 hash of a series of 32 bytes of zeros. For every other epoch it is always the Keccak-256 hash of the previous seed hash:</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic data-line-5242">
<ol class="arabic" start="336">
<li class="data-line-5242">
<p><strong>s</strong> = <em>C</em><sub>seedhash</sub>(<em>H</em><sub>i</sub>)</p>
</li>
<li class="data-line-5243">
<p><em>C</em>seedhash</p>
</li>
</ol>
</div>
<div class="paragraph data-line-5245">
<p>(<em>H</em> ) = f<strong>0</strong><sub>32</sub> if <em>E</em><sub>epoch</sub>(<em>H</em><sub>i</sub>) = 0</p>
</div>
<div class="quoteblock data-line-5247">
<blockquote>
<div class="paragraph data-line-5248">
<p>With <strong>0</strong>32 being 32 bytes of zeros.</p>
</div>
<div class="paragraph data-line-5250">
<p>KEC(<em>C</em><sub>seedhash</sub>(<em>H</em><sub>i</sub> − <em>J</em><sub>epoch</sub>)) otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5254">
<ol class="arabic">
<li class="data-line-5254">
<p><em>Cache.</em> The cache production process involves using the seed hash to first sequentially filling up <em>c</em>size bytes of memory, then performing <em>J</em><sub>cacherounds</sub> passes of the RandMemoHash algorithm created by <a href="#_bookmark85" data-href="#_bookmark85">Lerner [2014</a>]. The initial cache <strong>c</strong> , being an array of arrays of single bytes, will be constructed as follows.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5256">
<blockquote>
<div class="paragraph data-line-5257">
<p>We define the array *c*<em>i</em>, consisting of 64 single bytes, as the <em>i</em>th element of the initial cache:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5261">
<ol class="arabic" start="338">
<li class="data-line-5261">
<p>*c*<em>i</em></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5263">
<blockquote>
<div class="paragraph data-line-5264">
<p>Therefore <strong>c</strong> can be defined as</p>
</div>
</blockquote>
</div>
</div>
</div>
<h1 id="_kec512s_if_i_0" class="sect0 data-line-5267">KEC512(<strong>s</strong>) if <em>i</em> = 0</h1>
<div class="paragraph data-line-5269">
<p>KEC512(*c*<em>i</em>−1) otherwise</p>
</div>
<div class="olist arabic data-line-5272">
<ol class="arabic" start="339">
<li class="data-line-5272">
<p><strong>c</strong> [<em>i</em>] = *c*<em>i</em> ∀ <em>i &lt; n</em></p>
</li>
<li class="data-line-5273">
<p><em>n</em> = __c__size</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5275">
<blockquote>
<div class="paragraph data-line-5276">
<p><em>J</em>hashbytes</p>
</div>
<div class="paragraph data-line-5278">
<p>The cache is calculated by performing <em>J</em><sub>cacherounds</sub> rounds of the RandMemoHash algorithm to the initial cache <strong>c</strong> :</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5282">
<ol class="arabic" start="341">
<li class="data-line-5282">
<p><strong>c</strong> = <em>E</em>cacherounds(<strong>c</strong> <em>, J</em>cacherounds)</p>
</li>
<li class="data-line-5283">
<p><em>E</em><sub>cacherounds</sub>(*x*<em>, y</em>) =</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5285">
<blockquote>
<div class="paragraph data-line-5286">
<p><em>E</em>RMH(<strong>x</strong>) if <em>y</em> = 1</p>
</div>
<div class="paragraph data-line-5288">
<p><em>E</em><sub>cacherounds</sub>(<em>E</em><sub>RMH</sub>(<strong>x</strong>)<em>, y</em> − 1) otherwise</p>
</div>
<div class="paragraph data-line-5290">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 40</p>
</div>
<div class="paragraph data-line-5292">
<p>Where a single round modifies each subset of the cache as follows:</p>
</div>
<div class="paragraph data-line-5294">
<p>(343) <em>E</em><sub>RMH</sub>(<strong>x</strong>) = <em>E</em><sub>rmh</sub>(*x*<em>,</em> 0)<em>, E</em><sub>rmh</sub>(*x*<em>,</em> 1)<em>, , E</em><sub>rmh</sub>(*x*<em>, n</em> − 1)</p>
</div>
<div class="paragraph data-line-5296">
<p>(344) <em>E</em><sub>rmh</sub>(<strong>x*<em>, i</em>) = KEC512(*x</strong> [(<em>i</em> − 1 + <em>n</em>) mod <em>n</em>] ⊕ <strong>x</strong> [<strong>x</strong> [<em>i</em>][0] mod <em>n</em>])</p>
</div>
<div class="paragraph data-line-5298">
<p>with <strong>x</strong> = <strong>x</strong> except <strong>x</strong> [<em>j</em>] = <em>E</em><sub>rmh</sub>(*x*<em>, j</em>) ∀ <em>j &lt; i</em></p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5302">
<ol class="arabic">
<li class="data-line-5302">
<p>[<mark><em>bookmark158 .anchor]</mark>#_Full dataset calculation.</em> Essentially, we combine data from <em>J</em>parents pseudorandomly selected cache nodes, and hash that to compute the dataset. The entire dataset is then generated by a number of items, each <em>J</em><sub>hashbytes</sub> bytes in size:</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5304">
<blockquote>
<div class="paragraph data-line-5305">
<p>(345) <strong>d</strong>[<em>i</em>] = <em>E</em><sub>datasetitem</sub>(*c*<em>, i</em>) ∀ <em>i &lt;</em></p>
</div>
<div class="paragraph data-line-5307">
<p>__d__size</p>
</div>
<div class="paragraph data-line-5309">
<p>hashbytes</p>
</div>
<div class="paragraph data-line-5311">
<p>In order to calculate the single item we use an algorithm inspired by the FNV hash <a href="#_bookmark97" data-href="#_bookmark97">(Glenn Fowler [1991</a>)] in some cases as a non-associative substitute for XOR.</p>
</div>
<div class="paragraph data-line-5313">
<p>(346) <em>E</em> (<strong>x*<em>,</em> *y</strong>) = (<strong>x</strong> · (0x01000193 ⊕ <strong>y</strong>)) mod 2<sup>32</sup></p>
</div>
<div class="paragraph data-line-5315">
<p>The single item of the dataset can now be calculated as:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5319">
<ol class="arabic" start="347">
<li class="data-line-5319">
<p><em>E</em><sub>datasetitem</sub>(*c*<em>, i</em>) = <em>E</em><sub>parents</sub>(*c*<em>, i,</em> −1<em>,</em> ∅)</p>
</li>
<li class="data-line-5320">
<p><em>E</em></p>
</li>
</ol>
</div>
<div class="paragraph data-line-5322">
<p>parents</p>
</div>
<div class="paragraph data-line-5324">
<p>(<strong>c*<em>, i, p,</em> *m</strong>) = <em>E</em>parents(*c*<em>, i, p</em> + 1<em>, E</em>mix(*m*<em>,</em> *c*<em>, i, p</em> + 1)) if <em>p &lt; J</em>parents − 2</p>
</div>
<div class="quoteblock data-line-5326">
<blockquote>
<div class="paragraph data-line-5327">
<p><em>E</em>mix(*m*<em>,</em> *c*<em>, i, p</em> + 1) otherwise</p>
</div>
<div class="paragraph data-line-5329">
<p>fKEC512(<strong>c</strong>[<em>i</em> mod <em>c</em>size] ⊕ <em>i</em>) if <em>p</em> = 0</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5333">
<ol class="arabic">
<li class="data-line-5333">
<p><strong>Proof-of-work function.</strong> Essentially, we maintain a “mix” <em>J</em><sub>mixbytes</sub> bytes wide, and repeatedly sequentially fetch <em>J</em><sub>mixbytes</sub> bytes from the full dataset and use the <em>E</em><sub>FNV</sub> function to combine it with the mix. <em>J</em><sub>mixbytes</sub> bytes of sequential access are used so that each round of the algorithm always fetches a full page from RAM, minimizing translation lookaside buffer misses which ASICs would theoretically be able to avoid.</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5335">
<blockquote>
<div class="paragraph data-line-5336">
<p>If the output of this algorithm is below the desired target, then the nonce is valid. Note that the extra application of KEC at the end ensures that there exists an intermediate nonce which can be provided to prove that at least a small amount of work was done; this quick outer PoW verification can be used for anti-DDoS purposes. It also serves to provide statistical assurance that the result is an unbiased, 256 bit number.</p>
</div>
<div class="paragraph data-line-5338">
<p>The PoW-function returns an array with the compressed mix as its first item and the Keccak-256 hash of the concatenation of the compressed mix with the seed hash as the second item:</p>
</div>
<div class="paragraph data-line-5340">
<p>(350)</p>
</div>
<div class="paragraph data-line-5342">
<p>PoW(<em>H</em>n<em>, H</em><sub>n</sub><em>,</em> <strong>d</strong>) = \{<strong>m</strong><sub>c</sub>(KEC(RLP(<em>L</em><sub>H</sub>(<em>H</em>n)))<em>, H</em><sub>n</sub><em>,</em> <strong>d</strong>)<em>,</em> KEC(<strong>s</strong><sub>h</sub>(KEC(RLP(<em>L</em><sub>H</sub>(<em>H</em>n)))<em>, H</em><sub>n</sub>) + <strong>m</strong><sub>c</sub>(KEC(RLP(<em>L</em><sub>H</sub>(<em>H</em>n)))<em>, H</em><sub>n</sub><em>,</em> <strong>d</strong>))}</p>
</div>
<div class="paragraph data-line-5344">
<p>With <em>H</em>n being the hash of the header without the nonce. The compressed mix <strong>m</strong>c is obtained as follows:</p>
</div>
<div class="paragraph data-line-5346">
<p><em>n</em>mix</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5350">
<ol class="arabic" start="351">
<li class="data-line-5350">
<p><strong>m</strong><sub>c</sub>(<strong>h*<em>,</em> *n*<em>,</em> *d</strong>) = <em>E</em><sub>compress</sub>(<em>E</em><sub>accesses</sub>(<strong>d*<em>,</em> *s</strong><sub>h</sub>(<strong>h*<em>,</em> *n</strong>)<em>,</em> <strong>s</strong><sub>h</sub>(<strong>h*<em>,</em> *n</strong>)<em>,</em> −1)<em>,</em> −4)</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5352">
<blockquote>
<div class="paragraph data-line-5353">
<p><em>i</em>=0</p>
</div>
<div class="paragraph data-line-5355">
<p>The seed hash being:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5359">
<ol class="arabic" start="352">
<li class="data-line-5359">
<p><strong>s</strong><sub>h</sub>(<strong>h*<em>,</em> *n</strong>) = KEC512(<strong>h</strong> + <em>E</em><sub>revert</sub>(<strong>n</strong>)) <em>E</em>revert(<strong>n</strong>) returns the reverted bytes sequence of the nonce <strong>n</strong>:</p>
</li>
<li class="data-line-5360">
<p><em>E</em>revert(<strong>n</strong>)[<em>i</em>] = <strong>n</strong>[ll<strong>n</strong>ll − <em>i</em>]</p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5362">
<blockquote>
<div class="paragraph data-line-5363">
<p>We note that the “+”-operator between two byte sequences results in the concatenation of both sequences.</p>
</div>
<div class="paragraph data-line-5365">
<p>The dataset <strong>d</strong> is obtained as described in section <a href="#_bookmark158" data-href="#_bookmark158">J.3.3.</a> The number of replicated sequences in the mix is:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5369">
<ol class="arabic" start="354">
<li class="data-line-5369">
<p><em>n</em></p>
</li>
</ol>
</div>
<div class="paragraph data-line-5371">
<p>mix</p>
</div>
<div class="quoteblock data-line-5373">
<blockquote>
<div class="paragraph data-line-5374">
<p>= __J__mixbytes</p>
</div>
<div class="paragraph data-line-5376">
<p>hashbytes</p>
</div>
<div class="paragraph data-line-5378">
<p>In order to add random dataset nodes to the mix, the <em>E</em>accesses function is used:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5382">
<ol class="arabic" start="355">
<li class="data-line-5382">
<p><em>E</em></p>
</li>
</ol>
</div>
<div class="paragraph data-line-5384">
<p>accesses</p>
</div>
<div class="paragraph data-line-5386">
<p>(*d*<em>,</em> *m*<em>,</em> *s*<em>, i</em>) = <em>E</em>mixdataset(*d*<em>,</em> *m*<em>,</em> *s*<em>, i</em>) if <em>i</em> = <em>J</em>accesses − 2</p>
</div>
<div class="quoteblock data-line-5388">
<blockquote>
<div class="paragraph data-line-5389">
<p><em>E</em><sub>accesses</sub>(<em>E</em><sub>mixdataset</sub>(*d*<em>,</em> *m*<em>,</em> *s*<em>, i</em>)<em>,</em> *s*<em>, i</em> + 1) otherwise</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5393">
<ol class="arabic" start="356">
<li class="data-line-5393">
<p><em>E</em><sub>mixdataset</sub>(*d*<em>,</em> *m*<em>,</em> *s*<em>, i</em>) = <em>E</em><sub>FNV</sub>(*m*<em>, E</em><sub>newdata</sub>(*d*<em>,</em> *m*<em>,</em> *s*<em>, i</em>)) <em>E</em><sub>newdata</sub> returns an array with <em>n</em><sub>mix</sub> elements:</p>
</li>
<li class="data-line-5394">
<p><em>E</em> (<strong>d*<em>,</em> *m*<em>,</em> *s*<em>, i</em>)[<em>j</em>] = *d</strong><em class="_E_ (_i_ ⊕ <strong>s</strong>[0">,</em> <strong>m</strong>[<em>i</em> mod __J__mixbytes ]) mod __d__size__/J__hashbytes · <em>n</em></p>
</li>
</ol>
</div>
<div class="quoteblock data-line-5396">
<blockquote>
<div class="paragraph data-line-5397">
<p>+ <em>j</em>] ∀ <em>j &lt; n</em></p>
</div>
<div class="paragraph data-line-5399">
<p>ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER <strong>BERLIN VERSION</strong> 41</p>
</div>
<div class="paragraph data-line-5401">
<p>The mix is compressed as follows:</p>
</div>
</blockquote>
</div>
<div class="olist arabic data-line-5405">
<ol class="arabic" start="358">
<li class="data-line-5405">
<p><em>E</em></p>
</li>
</ol>
</div>
<div class="paragraph data-line-5407">
<p>compress</p>
</div>
<div class="paragraph data-line-5409">
<p>(<strong>m*<em>, i</em>) = *m</strong> if <em>i</em> ;;: ll<strong>m</strong>ll − 8</p>
</div>
<div class="quoteblock data-line-5411">
<blockquote>
<div class="paragraph data-line-5412">
<p><em>E</em>compress(<em>E</em>FNV(<em>E</em>FNV(<em>E</em>FNV(<strong>m</strong><em class="_i_ + 4">,</em> <strong>m</strong>[<em>i</em> + 5])<em>,</em> <strong>m</strong>[<em>i</em> + 6])<em>,</em> <strong>m</strong>[<em>i</em> + 7])<em>, i</em> + 8) otherwise</p>
</div>
<div class="paragraph data-line-5414">
<p>Appendix K. Anomalies on the Main Network</p>
</div>
<div class="paragraph data-line-5416">
<p>K.1. <strong>Deletion of an Account Despite Out-of-gas.</strong> At block 2675119, in the transaction 0xcf416c536ec1a19ed1fb89e 4ec7ffb3cf73aa413b3aa9b77d60e4fd81a4296ba, an account at address 0x03 was called and an out-of-gas occurred during the call. Against the equation <a href="#<em>bookmark120" data-href="#<em>bookmark120">(207),</a> this added 0x03 in the set of touched addresses, and this transaction turned <strong>_σ</em></strong>[0<em>x</em>03] into ∅.</p>
</div>
<div class="paragraph data-line-5418">
<p>Appendix L. List of mathematical symbols</p>
</div>
<div class="paragraph data-line-5420">
<p>Symbol Latex Command Description</p>
</div>
<div class="paragraph data-line-5422">
<p>\bigvee This is the least upper bound, supremum, or join of all elements operated on. Thus it is the greatest element of such elements <a href="#_bookmark88" data-href="#_bookmark88">(Davey and Priestley [2002</a>]).</p>
</div>
</blockquote>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-04-20 09:46:58 -0400
</div>
</div>
</body>
</html>